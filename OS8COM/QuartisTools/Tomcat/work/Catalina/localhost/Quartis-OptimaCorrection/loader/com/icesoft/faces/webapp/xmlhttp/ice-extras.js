var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(iterator){this.responders._each(iterator)},register:function(responder){if(!this.include(responder)){this.responders.push(responder)}},unregister:function(responder){this.responders=this.responders.without(responder)},dispatch:function(callback,request,transport,json){this.each(function(responder){if(Object.isFunction(responder[callback])){try{responder[callback].apply(responder,[request,transport,json])}catch(e){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(options){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,options||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters)){this.options.parameters=this.options.parameters.toQueryParams()}else{if(Object.isHash(this.options.parameters)){this.options.parameters=this.options.parameters.toObject()}}}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,url,options){$super(options);this.transport=Ajax.getTransport();this.request(url)},request:function(url){this.url=url;this.method=this.options.method;var params=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){params._method=this.method;this.method="post"}this.parameters=params;if(params=Object.toQueryString(params)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+params}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){params+="&_="}}}try{var response=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(response)}Ajax.Responders.dispatch("onCreate",this,response);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||params):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(e){this.dispatchException(e)}},onStateChange:function(){var readyState=this.transport.readyState;if(readyState>1&&!((readyState==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var headers={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){headers["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){headers.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var extras=this.options.requestHeaders;if(Object.isFunction(extras.push)){for(var i=0,length=extras.length;i<length;i+=2){headers[extras[i]]=extras[i+1]}}else{$H(extras).each(function(pair){headers[pair.key]=pair.value})}}for(var name in headers){this.transport.setRequestHeader(name,headers[name])}},success:function(){var status=this.getStatus();return !status||(status>=200&&status<300)},getStatus:function(){try{return this.transport.status||0}catch(e){return 0}},respondToReadyState:function(readyState){var state=Ajax.Request.Events[readyState],response=new Ajax.Response(this);if(state=="Complete"){try{this._complete=true;(this.options["on"+response.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(response,response.headerJSON)}catch(e){this.dispatchException(e)}var contentType=response.getHeader("Content-type");if(this.options.evalJS=="force"||(this.options.evalJS&&contentType&&contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))){this.evalResponse()}}try{(this.options["on"+state]||Prototype.emptyFunction)(response,response.headerJSON);Ajax.Responders.dispatch("on"+state,this,response,response.headerJSON)}catch(e){this.dispatchException(e)}if(state=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},getHeader:function(name){try{return this.transport.getResponseHeader(name)}catch(e){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(exception){(this.options.onException||Prototype.emptyFunction)(this,exception);Ajax.Responders.dispatch("onException",this,exception)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Response=Class.create({initialize:function(request){this.request=request;var transport=this.transport=request.transport,readyState=this.readyState=transport.readyState;if((readyState>2&&!Prototype.Browser.IE)||readyState==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(transport.responseText);this.headerJSON=this._getHeaderJSON()}if(readyState==4){var xml=transport.responseXML;this.responseXML=Object.isUndefined(xml)?null:xml;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(e){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(e){return null}},getResponseHeader:function(name){return this.transport.getResponseHeader(name)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var json=this.getHeader("X-JSON");if(!json){return null}json=decodeURIComponent(escape(json));try{return json.evalJSON(this.request.options.sanitizeJSON)}catch(e){this.request.dispatchException(e)}},_getResponseJSON:function(){var options=this.request.options;if(!options.evalJSON||(options.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json"))||this.responseText.blank()){return null}try{return this.responseText.evalJSON(options.sanitizeJSON)}catch(e){this.request.dispatchException(e)}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,container,url,options){this.container={success:(container.success||container),failure:(container.failure||(container.success?null:container))};options=Object.clone(options);var onComplete=options.onComplete;options.onComplete=(function(response,json){this.updateContent(response.responseText);if(Object.isFunction(onComplete)){onComplete(response,json)}}).bind(this);$super(url,options)},updateContent:function(responseText){var receiver=this.container[this.success()?"success":"failure"],options=this.options;if(!options.evalScripts){responseText=responseText.stripScripts()}if(receiver=$(receiver)){if(options.insertion){if(Object.isString(options.insertion)){var insertion={};insertion[options.insertion]=responseText;receiver.insert(insertion)}else{options.insertion(receiver,responseText)}}else{receiver.update(responseText)}}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,container,url,options){$super(options);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=container;this.url=url;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(response){if(this.options.decay){this.decay=(response.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=response.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});
function $(B){if(arguments.length>1){for(var A=0,D=[],C=arguments.length;A<C;A++){D.push($(arguments[A]));}return D;}if(Object.isString(B)){B=document.getElementById(B);}return Element.extend(B);}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(F,A){var C=[];var E=document.evaluate(F,$(A)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var B=0,D=E.snapshotLength;B<D;B++){C.push(Element.extend(E.snapshotItem(B)));}return C;};}if(!window.Node){var Node={};}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});}(function(){var A=this.Element;this.Element=function(D,C){C=C||{};D=D.toLowerCase();var B=Element.cache;if(Prototype.Browser.IE&&C.name){D="<"+D+' name="'+C.name+'">';delete C.name;return Element.writeAttribute(document.createElement(D),C);}if(!B[D]){B[D]=Element.extend(document.createElement(D));}return Element.writeAttribute(B[D].cloneNode(false),C);};Object.extend(this.Element,A||{});}).call(window);Element.cache={};Element.Methods={visible:function(A){return $(A).style.display!="none";},toggle:function(A){A=$(A);Element[Element.visible(A)?"hide":"show"](A);return A;},hide:function(A){$(A).style.display="none";return A;},show:function(A){$(A).style.display="";return A;},remove:function(A){A=$(A);A.parentNode.removeChild(A);return A;},update:function(A,B){A=$(A);if(B&&B.toElement){B=B.toElement();}if(Object.isElement(B)){return A.update().insert(B);}B=Object.toHTML(B);A.innerHTML=B.stripScripts();B.evalScripts.bind(B).defer();return A;},replace:function(B,C){B=$(B);if(C&&C.toElement){C=C.toElement();}else{if(!Object.isElement(C)){C=Object.toHTML(C);var A=B.ownerDocument.createRange();A.selectNode(B);C.evalScripts.bind(C).defer();C=A.createContextualFragment(C.stripScripts());}}B.parentNode.replaceChild(C,B);return B;},insert:function(C,E){C=$(C);if(Object.isString(E)||Object.isNumber(E)||Object.isElement(E)||(E&&(E.toElement||E.toHTML))){E={bottom:E};}var D,B,A;for(position in E){D=E[position];position=position.toLowerCase();B=Element._insertionTranslations[position];if(D&&D.toElement){D=D.toElement();}if(Object.isElement(D)){B.insert(C,D);continue;}D=Object.toHTML(D);A=C.ownerDocument.createRange();B.initializeRange(C,A);B.insert(C,A.createContextualFragment(D.stripScripts()));D.evalScripts.bind(D).defer();}return C;},wrap:function(B,C,A){B=$(B);if(Object.isElement(C)){$(C).writeAttribute(A||{});}else{if(Object.isString(C)){C=new Element(C,A);}else{C=new Element("div",C);}}if(B.parentNode){B.parentNode.replaceChild(C,B);}C.appendChild(B);return C;},inspect:function(B){B=$(B);var A="<"+B.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(F){var E=F.first(),C=F.last();var D=(B[E]||"").toString();if(D){A+=" "+C+"="+D.inspect(true);}});return A+">";},recursivelyCollect:function(A,C){A=$(A);var B=[];while(A=A[C]){if(A.nodeType==1){B.push(Element.extend(A));}}return B;},ancestors:function(A){return $(A).recursivelyCollect("parentNode");},descendants:function(A){return $(A).getElementsBySelector("*");},firstDescendant:function(A){A=$(A).firstChild;while(A&&A.nodeType!=1){A=A.nextSibling;}return $(A);},immediateDescendants:function(A){if(!(A=$(A).firstChild)){return[];}while(A&&A.nodeType!=1){A=A.nextSibling;}if(A){return[A].concat($(A).nextSiblings());}return[];},previousSiblings:function(A){return $(A).recursivelyCollect("previousSibling");},nextSiblings:function(A){return $(A).recursivelyCollect("nextSibling");},siblings:function(A){A=$(A);return A.previousSiblings().reverse().concat(A.nextSiblings());},match:function(B,A){if(Object.isString(A)){A=new Selector(A);}return A.match($(B));},up:function(B,D,A){B=$(B);if(arguments.length==1){return $(B.parentNode);}var C=B.ancestors();return D?Selector.findElement(C,D,A):C[A||0];},down:function(B,C,A){B=$(B);if(arguments.length==1){return B.firstDescendant();}var D=B.descendants();return C?Selector.findElement(D,C,A):D[A||0];},previous:function(B,D,A){B=$(B);if(arguments.length==1){return $(Selector.handlers.previousElementSibling(B));}var C=B.previousSiblings();return D?Selector.findElement(C,D,A):C[A||0];},next:function(C,D,B){C=$(C);if(arguments.length==1){return $(Selector.handlers.nextElementSibling(C));}var A=C.nextSiblings();return D?Selector.findElement(A,D,B):A[B||0];},select:function(){var A=$A(arguments),B=$(A.shift());return Selector.findChildElements(B,A);},adjacent:function(){var A=$A(arguments),B=$(A.shift());return Selector.findChildElements(B.parentNode,A).without(B);},identify:function(B){B=$(B);var C=B.readAttribute("id"),A=arguments.callee;if(C){return C;}do{C="anonymous_element_"+A.counter++;}while($(C));B.writeAttribute("id",C);return C;},readAttribute:function(C,A){C=$(C);if(Prototype.Browser.IE){var B=Element._attributeTranslations.read;if(B.values[A]){return B.values[A](C,A);}if(B.names[A]){A=B.names[A];}if(A.include(":")){return(!C.attributes||!C.attributes[A])?null:C.attributes[A].value;}}return C.getAttribute(A);},writeAttribute:function(E,C,F){E=$(E);var B={},D=Element._attributeTranslations.write;if(typeof C=="object"){B=C;}else{B[C]=Object.isUndefined(F)?true:F;}for(var A in B){C=D.names[A]||A;F=B[A];if(D.values[A]){C=D.values[A](E,F);}if(F===false||F===null){E.removeAttribute(C);}else{if(F===true){E.setAttribute(C,C);}else{E.setAttribute(C,F);}}}return E;},getHeight:function(A){return $(A).getDimensions().height;},getWidth:function(A){return $(A).getDimensions().width;},classNames:function(A){return new Element.ClassNames(A);},hasClassName:function(A,B){if(!(A=$(A))){return ;}var C=A.className;return(C.length>0&&(C==B||new RegExp("(^|\\s)"+B+"(\\s|$)").test(C)));},addClassName:function(A,B){if(!(A=$(A))){return ;}if(!A.hasClassName(B)){A.className+=(A.className?" ":"")+B;}return A;},removeClassName:function(A,B){if(!(A=$(A))){return ;}A.className=A.className.replace(new RegExp("(^|\\s+)"+B+"(\\s+|$)")," ").strip();return A;},toggleClassName:function(A,B){if(!(A=$(A))){return ;}return A[A.hasClassName(B)?"removeClassName":"addClassName"](B);},cleanWhitespace:function(B){B=$(B);var C=B.firstChild;while(C){var A=C.nextSibling;if(C.nodeType==3&&!/\S/.test(C.nodeValue)){B.removeChild(C);}C=A;}return B;},empty:function(A){return $(A).innerHTML.blank();},descendantOf:function(D,C){D=$(D),C=$(C);var F=C;if(D.compareDocumentPosition){return(D.compareDocumentPosition(C)&8)===8;}if(D.sourceIndex&&!Prototype.Browser.Opera){var E=D.sourceIndex,B=C.sourceIndex,A=C.nextSibling;if(!A){do{C=C.parentNode;}while(!(A=C.nextSibling)&&C.parentNode);}if(A){return(E>B&&E<A.sourceIndex);}}while(D=D.parentNode){if(D==F){return true;}}return false;},scrollTo:function(A){A=$(A);var B=A.cumulativeOffset();window.scrollTo(B[0],B[1]);return A;},getStyle:function(B,C){B=$(B);C=C=="float"?"cssFloat":C.camelize();var D=B.style[C];if(!D){var A=document.defaultView.getComputedStyle(B,null);D=A?A[C]:null;}if(C=="opacity"){return D?parseFloat(D):1;}return D=="auto"?null:D;},getOpacity:function(A){return $(A).getStyle("opacity");},setStyle:function(B,C){B=$(B);var E=B.style,A;if(Object.isString(C)){B.style.cssText+=";"+C;return C.include("opacity")?B.setOpacity(C.match(/opacity:\s*(\d?\.?\d*)/)[1]):B;}for(var D in C){if(D=="opacity"){B.setOpacity(C[D]);}else{E[(D=="float"||D=="cssFloat")?(Object.isUndefined(E.styleFloat)?"cssFloat":"styleFloat"):D]=C[D];}}return B;},setOpacity:function(A,B){A=$(A);A.style.opacity=(B==1||B==="")?"":(B<0.00001)?0:B;return A;},getDimensions:function(C){C=$(C);var G=$(C).getStyle("display");if(G!="none"&&G!=null){return{width:C.offsetWidth,height:C.offsetHeight};}var B=C.style;var F=B.visibility;var D=B.position;var A=B.display;B.visibility="hidden";B.position="absolute";B.display="block";var H=C.clientWidth;var E=C.clientHeight;B.display=A;B.position=D;B.visibility=F;return{width:H,height:E};},makePositioned:function(A){A=$(A);var B=Element.getStyle(A,"position");if(B=="static"||!B){A._madePositioned=true;A.style.position="relative";if(window.opera){A.style.top=0;A.style.left=0;}}return A;},undoPositioned:function(A){A=$(A);if(A._madePositioned){A._madePositioned=undefined;A.style.position=A.style.top=A.style.left=A.style.bottom=A.style.right="";}return A;},makeClipping:function(A){A=$(A);if(A._overflow){return A;}A._overflow=Element.getStyle(A,"overflow")||"auto";if(A._overflow!=="hidden"){A.style.overflow="hidden";}return A;},undoClipping:function(A){A=$(A);if(!A._overflow){return A;}A.style.overflow=A._overflow=="auto"?"":A._overflow;A._overflow=null;return A;},cumulativeOffset:function(B){var A=0,C=0;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;B=B.offsetParent;}while(B);return Element._returnOffset(C,A);},positionedOffset:function(B){var A=0,D=0;do{A+=B.offsetTop||0;D+=B.offsetLeft||0;B=B.offsetParent;if(B){if(B.tagName=="BODY"){break;}var C=Element.getStyle(B,"position");if(C=="relative"||C=="absolute"){break;}}}while(B);return Element._returnOffset(D,A);},absolutize:function(B){B=$(B);if(B.getStyle("position")=="absolute"){return ;}var D=B.positionedOffset();var F=D[1];var E=D[0];var C=B.clientWidth;var A=B.clientHeight;B._originalLeft=E-parseFloat(B.style.left||0);B._originalTop=F-parseFloat(B.style.top||0);B._originalWidth=B.style.width;B._originalHeight=B.style.height;B.style.position="absolute";B.style.top=F+"px";B.style.left=E+"px";B.style.width=C+"px";B.style.height=A+"px";return B;},relativize:function(A){A=$(A);if(A.getStyle("position")=="relative"){return ;}A.style.position="relative";var C=parseFloat(A.style.top||0)-(A._originalTop||0);var B=parseFloat(A.style.left||0)-(A._originalLeft||0);A.style.top=C+"px";A.style.left=B+"px";A.style.height=A._originalHeight;A.style.width=A._originalWidth;return A;},cumulativeScrollOffset:function(B){var A=0,C=0;do{A+=B.scrollTop||0;C+=B.scrollLeft||0;B=B.parentNode;}while(B);return Element._returnOffset(C,A);},getOffsetParent:function(A){if(A.offsetParent){return $(A.offsetParent);}if(A==document.body){return $(A);}while((A=A.parentNode)&&A!=document.body){if(Element.getStyle(A,"position")!="static"){return $(A);}}return $(document.body);},viewportOffset:function(D){var A=0,C=0;var B=D;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;if(B.offsetParent==document.body&&Element.getStyle(B,"position")=="absolute"){break;}}while(B=B.offsetParent);B=D;do{if(!Prototype.Browser.Opera||B.tagName=="BODY"){A-=B.scrollTop||0;C-=B.scrollLeft||0;}}while(B=B.parentNode);return Element._returnOffset(C,A);},clonePosition:function(B,D){var A=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});D=$(D);var E=D.viewportOffset();B=$(B);var F=[0,0];var C=null;if(Element.getStyle(B,"position")=="absolute"){C=B.getOffsetParent();F=C.viewportOffset();}if(C==document.body){F[0]-=document.body.offsetLeft;F[1]-=document.body.offsetTop;}if(A.setLeft){B.style.left=(E[0]-F[0]+A.offsetLeft)+"px";}if(A.setTop){B.style.top=(E[1]-F[1]+A.offsetTop)+"px";}if(A.setWidth){B.style.width=D.offsetWidth+"px";}if(A.setHeight){B.style.height=D.offsetHeight+"px";}return B;}};Element.Methods.identify.counter=1;Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(!document.createRange||Prototype.Browser.Opera){Element.Methods.insert=function(E,G){E=$(E);if(Object.isString(G)||Object.isNumber(G)||Object.isElement(G)||(G&&(G.toElement||G.toHTML))){G={bottom:G};}var D=Element._insertionTranslations,F,B,H,C;for(B in G){F=G[B];B=B.toLowerCase();H=D[B];if(F&&F.toElement){F=F.toElement();}if(Object.isElement(F)){H.insert(E,F);continue;}F=Object.toHTML(F);C=((B=="before"||B=="after")?E.parentNode:E).tagName.toUpperCase();if(D.tags[C]){var A=Element._getContentFromAnonymousElement(C,F.stripScripts());if(B=="top"||B=="after"){A.reverse();}A.each(H.insert.curry(E));}else{E.insertAdjacentHTML(H.adjacency,F.stripScripts());}F.evalScripts.bind(F).defer();}return E;};}if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(D,B,C){switch(C){case"left":case"top":case"right":case"bottom":if(D(B,"position")==="static"){return null;}case"height":case"width":if(!Element.visible(B)){return null;}var E=parseInt(D(B,C),10);if(E!==B["offset"+C.capitalize()]){return E+"px";}var A;if(C==="height"){A=["border-top-width","padding-top","padding-bottom","border-bottom-width"];}else{A=["border-left-width","padding-left","padding-right","border-right-width"];}return A.inject(E,function(F,G){var H=D(B,G);return H===null?F:F-parseInt(H,10);})+"px";default:return D(B,C);}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(C,A,B){if(B==="title"){return A.title;}return C(A,B);});}else{if(Prototype.Browser.IE){$w("positionedOffset getOffsetParent viewportOffset").each(function(A){Element.Methods[A]=Element.Methods[A].wrap(function(D,C){C=$(C);var B=C.getStyle("position");if(B!="static"){return D(C);}C.setStyle({position:"relative"});var E=D(C);C.setStyle({position:B});return E;});});Element.Methods.getStyle=function(A,B){A=$(A);B=(B=="float"||B=="cssFloat")?"styleFloat":B.camelize();var C=A.style[B];if(!C&&A.currentStyle){C=A.currentStyle[B];}if(B=="opacity"){if(C=(A.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(C[1]){return parseFloat(C[1])/100;}}return 1;}if(C=="auto"){if((B=="width"||B=="height")&&(A.getStyle("display")!="none")){return A["offset"+B.capitalize()]+"px";}return null;}return C;};Element.Methods.setOpacity=function(B,E){function F(G){return G.replace(/alpha\([^\)]*\)/gi,"");}B=$(B);var A=B.currentStyle;if((A&&!A.hasLayout)||(!A&&B.style.zoom=="normal")){B.style.zoom=1;}var D=B.getStyle("filter"),C=B.style;if(E==1||E===""){(D=F(D))?C.filter=D:C.removeAttribute("filter");return B;}else{if(E<0.00001){E=0;}}C.filter=F(D)+"alpha(opacity="+(E*100)+")";return B;};Element._attributeTranslations={read:{names:{"class":"className","for":"htmlFor"},values:{_getAttr:function(A,B){return A.getAttribute(B,2);},_getAttrNode:function(A,C){var B=A.getAttributeNode(C);return B?B.value:"";},_getEv:function(A,B){B=A.getAttribute(B);return B?B.toString().slice(23,-2):null;},_flag:function(A,B){return $(A).hasAttribute(B)?B:null;},style:function(A){return A.style.cssText.toLowerCase();},title:function(A){return A.title;}}}};Element._attributeTranslations.write={names:Object.clone(Element._attributeTranslations.read.names),values:{checked:function(A,B){A.checked=!!B;},style:function(A,B){A.style.cssText=B?B:"";}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc").each(function(A){Element._attributeTranslations.write.names[A.toLowerCase()]=A;Element._attributeTranslations.has[A.toLowerCase()]=A;});(function(A){Object.extend(A,{href:A._getAttr,src:A._getAttr,type:A._getAttr,action:A._getAttrNode,disabled:A._flag,checked:A._flag,readonly:A._flag,multiple:A._flag,onload:A._getEv,onunload:A._getEv,onclick:A._getEv,ondblclick:A._getEv,onmousedown:A._getEv,onmouseup:A._getEv,onmouseover:A._getEv,onmousemove:A._getEv,onmouseout:A._getEv,onfocus:A._getEv,onblur:A._getEv,onkeypress:A._getEv,onkeydown:A._getEv,onkeyup:A._getEv,onsubmit:A._getEv,onreset:A._getEv,onselect:A._getEv,onchange:A._getEv});})(Element._attributeTranslations.read.values);}else{if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(A,B){A=$(A);A.style.opacity=(B==1)?0.999999:(B==="")?"":(B<0.00001)?0:B;return A;};}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(A,B){A=$(A);A.style.opacity=(B==1||B==="")?"":(B<0.00001)?0:B;if(B==1){if(A.tagName=="IMG"&&A.width){A.width++;A.width--;}else{try{var D=document.createTextNode(" ");A.appendChild(D);A.removeChild(D);}catch(C){}}}return A;};Element.Methods.cumulativeOffset=function(B){var A=0,C=0;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;if(B.offsetParent==document.body){if(Element.getStyle(B,"position")=="absolute"){break;}}B=B.offsetParent;}while(B);return Element._returnOffset(C,A);};}}}}if(Prototype.Browser.IE||Prototype.Browser.Opera){Element.Methods.update=function(B,C){B=$(B);if(C&&C.toElement){C=C.toElement();}if(Object.isElement(C)){return B.update().insert(C);}C=Object.toHTML(C);var A=B.tagName.toUpperCase();if(A in Element._insertionTranslations.tags){$A(B.childNodes).each(function(D){B.removeChild(D);});Element._getContentFromAnonymousElement(A,C.stripScripts()).each(function(D){B.appendChild(D);});}else{B.innerHTML=C.stripScripts();}C.evalScripts.bind(C).defer();return B;};}if(document.createElement("div").outerHTML){Element.Methods.replace=function(C,E){C=$(C);if(E&&E.toElement){E=E.toElement();}if(Object.isElement(E)){C.parentNode.replaceChild(E,C);return C;}E=Object.toHTML(E);var D=C.parentNode,B=D.tagName.toUpperCase();if(Element._insertionTranslations.tags[B]){var F=C.next();var A=Element._getContentFromAnonymousElement(B,E.stripScripts());D.removeChild(C);if(F){A.each(function(G){D.insertBefore(G,F);});}else{A.each(function(G){D.appendChild(G);});}}else{C.outerHTML=E.stripScripts();}E.evalScripts.bind(E).defer();return C;};}Element._returnOffset=function(B,C){var A=[B,C];A.left=B;A.top=C;return A;};Element._getContentFromAnonymousElement=function(C,B){var D=new Element("div"),A=Element._insertionTranslations.tags[C];D.innerHTML=A[0]+B+A[1];A[2].times(function(){D=D.firstChild;});return $A(D.childNodes);};Element._insertionTranslations={before:{adjacency:"beforeBegin",insert:function(A,B){A.parentNode.insertBefore(B,A);},initializeRange:function(B,A){A.setStartBefore(B);}},top:{adjacency:"afterBegin",insert:function(A,B){A.insertBefore(B,A.firstChild);},initializeRange:function(B,A){A.selectNodeContents(B);A.collapse(true);}},bottom:{adjacency:"beforeEnd",insert:function(A,B){A.appendChild(B);}},after:{adjacency:"afterEnd",insert:function(A,B){A.parentNode.insertBefore(B,A.nextSibling);},initializeRange:function(B,A){A.setStartAfter(B);}},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){this.bottom.initializeRange=this.top.initializeRange;Object.extend(this.tags,{THEAD:this.tags.TBODY,TFOOT:this.tags.TBODY,TH:this.tags.TD});}).call(Element._insertionTranslations);Element.Methods.Simulated={hasAttribute:function(A,C){C=Element._attributeTranslations.has[C]||C;var B=$(A).getAttributeNode(C);return B&&B.specified;}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);if(!Prototype.BrowserFeatures.ElementExtensions&&document.createElement("div").__proto__){window.HTMLElement={};window.HTMLElement.prototype=document.createElement("div").__proto__;Prototype.BrowserFeatures.ElementExtensions=true;}Element.extend=(function(){if(Prototype.BrowserFeatures.SpecificElementExtensions){return Prototype.K;}var A={},B=Element.Methods.ByTag;var C=Object.extend(function(F){if(!F||F._extendedByPrototype||F.nodeType!=1||F==window){return F;}var D=Object.clone(A),E=F.tagName,H,G;if(B[E]){Object.extend(D,B[E]);}for(H in D){G=D[H];if(Object.isFunction(G)&&!(H in F)){F[H]=G.methodize();}}F._extendedByPrototype=Prototype.emptyFunction;return F;},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(A,Element.Methods);Object.extend(A,Element.Methods.Simulated);}}});C.refresh();return C;})();Element.hasAttribute=function(A,B){if(A.hasAttribute){return A.hasAttribute(B);}return Element.Methods.Simulated.hasAttribute(A,B);};Element.addMethods=function(C){var I=Prototype.BrowserFeatures,D=Element.Methods.ByTag;if(!C){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)});}if(arguments.length==2){var B=C;C=arguments[1];}if(!B){Object.extend(Element.Methods,C||{});}else{if(Object.isArray(B)){B.each(H);}else{H(B);}}function H(F){F=F.toUpperCase();if(!Element.Methods.ByTag[F]){Element.Methods.ByTag[F]={};}Object.extend(Element.Methods.ByTag[F],C);}function A(L,K,F){F=F||false;for(var N in L){var M=L[N];if(!Object.isFunction(M)){continue;}if(!F||!(N in K)){K[N]=M.methodize();}}}function E(L){var F;var K={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(K[L]){F="HTML"+K[L]+"Element";}if(window[F]){return window[F];}F="HTML"+L+"Element";if(window[F]){return window[F];}F="HTML"+L.capitalize()+"Element";if(window[F]){return window[F];}window[F]={};window[F].prototype=document.createElement(L).__proto__;return window[F];}if(I.ElementExtensions){A(Element.Methods,HTMLElement.prototype);A(Element.Methods.Simulated,HTMLElement.prototype,true);}if(I.SpecificElementExtensions){for(var J in Element.Methods.ByTag){var G=E(J);if(Object.isUndefined(G)){continue;}A(D[J],G.prototype);}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh();}Element.cache={};};document.viewport={getDimensions:function(){var A={};var C=Prototype.Browser;$w("width height").each(function(E){var B=E.capitalize();if(C.WebKit&&!document.evaluate){A[E]=self["inner"+B];}else{if(C.Opera&&parseFloat(window.opera.version())<9.5||!document.compatMode||document.compatMode!="CSS1Compat"){A[E]=document.body["client"+B];}else{A[E]=document.documentElement["client"+B];}}});return A;},getWidth:function(){return this.getDimensions().width;},getHeight:function(){return this.getDimensions().height;},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop);}};
var Selector=Class.create({initialize:function(A){this.expression=A.strip();this.compileMatcher();},shouldUseXPath:function(){if(!Prototype.BrowserFeatures.XPath){return false;}var A=this.expression;if(Prototype.Browser.WebKit&&(A.include("-of-type")||A.include(":empty"))){return false;}if((/(\[[\w-]*?:|:checked)/).test(this.expression)){return false;}return true;},compileMatcher:function(){if(this.shouldUseXPath()){return this.compileXPathMatcher();}var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m;if(Selector._cache[e]){this.matcher=Selector._cache[e];return ;}this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in ps){p=ps[i];if(m=e.match(p)){this.matcher.push(Object.isFunction(c[i])?c[i](m):new Template(c[i]).evaluate(m));e=e.replace(m[0],"");break;}}}this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join("\n"));Selector._cache[this.expression]=this.matcher;},compileXPathMatcher:function(){var E=this.expression,F=Selector.patterns,B=Selector.xpath,D,A;if(Selector._cache[E]){this.xpath=Selector._cache[E];return ;}this.matcher=[".//*"];while(E&&D!=E&&(/\S/).test(E)){D=E;for(var C in F){if(A=E.match(F[C])){this.matcher.push(Object.isFunction(B[C])?B[C](A):new Template(B[C]).evaluate(A));E=E.replace(A[0],"");break;}}}this.xpath=this.matcher.join("");Selector._cache[this.expression]=this.xpath;},findElements:function(A){A=A||document;if(this.xpath){return document._getElementsByXPath(this.xpath,A);}return this.matcher(A);},match:function(H){this.tokens=[];var L=this.expression,A=Selector.patterns,E=Selector.assertions;var B,D,F;while(L&&B!==L&&(/\S/).test(L)){B=L;for(var I in A){D=A[I];if(F=L.match(D)){if(E[I]){this.tokens.push([I,Object.clone(F)]);L=L.replace(F[0],"");}else{return this.findElements(document).include(H);}}}}var K=true,C,J;for(var I=0,G;G=this.tokens[I];I++){C=G[0],J=G[1];if(!Selector.assertions[C](H,J)){K=false;break;}}return K;},toString:function(){return this.expression;},inspect:function(){return"#<Selector:"+this.expression.inspect()+">";}});Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(A){if(A[1]=="*"){return"";}return"[local-name()='"+A[1].toLowerCase()+"' or local-name()='"+A[1].toUpperCase()+"']";},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(A){A[1]=A[1].toLowerCase();return new Template("[@#{1}]").evaluate(A);},attr:function(A){A[1]=A[1].toLowerCase();A[3]=A[5]||A[6];return new Template(Selector.xpath.operators[A[2]]).evaluate(A);},pseudo:function(A){var B=Selector.xpath.pseudos[A[1]];if(!B){return"";}if(Object.isFunction(B)){return B(A);}return new Template(Selector.xpath.pseudos[A[1]]).evaluate(A);},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]",empty:"[count(*) = 0 and (count(text()) = 0 or translate(text(), ' \t\r\n', '') = '')]",checked:"[@checked]",disabled:"[@disabled]",enabled:"[not(@disabled)]",not:function(B){var H=B[6],G=Selector.patterns,A=Selector.xpath,E,C;var F=[];while(H&&E!=H&&(/\S/).test(H)){E=H;for(var D in G){if(B=H.match(G[D])){C=Object.isFunction(A[D])?A[D](B):new Template(A[D]).evaluate(B);F.push("("+C.substring(1,C.length-1)+")");H=H.replace(B[0],"");break;}}}return"[not("+F.join(" and ")+")]";},"nth-child":function(A){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",A);},"nth-last-child":function(A){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",A);},"nth-of-type":function(A){return Selector.xpath.pseudos.nth("position() ",A);},"nth-last-of-type":function(A){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",A);},"first-of-type":function(A){A[6]="1";return Selector.xpath.pseudos["nth-of-type"](A);},"last-of-type":function(A){A[6]="1";return Selector.xpath.pseudos["nth-last-of-type"](A);},"only-of-type":function(A){var B=Selector.xpath.pseudos;return B["first-of-type"](A)+B["last-of-type"](A);},nth:function(E,C){var F,G=C[6],B;if(G=="even"){G="2n+0";}if(G=="odd"){G="2n+1";}if(F=G.match(/^(\d+)$/)){return"["+E+"= "+F[1]+"]";}if(F=G.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(F[1]=="-"){F[1]=-1;}var D=F[1]?Number(F[1]):1;var A=F[2]?Number(F[2]):0;B="[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(B).evaluate({fragment:E,a:D,b:A});}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);   c = false;',className:'n = h.className(n, r, "#{1}", c); c = false;',id:'n = h.id(n, r, "#{1}", c);        c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}"); c = false;',attr:function(A){A[3]=(A[5]||A[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}"); c = false;').evaluate(A);},pseudo:function(A){if(A[6]){A[6]=A[6].replace(/"/g,'\\"');}return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(A);},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:{laterSibling:/^\s*~\s*/,child:/^\s*>\s*/,adjacent:/^\s*\+\s*/,descendant:/^\s/,tagName:/^\s*(\*|[\w\-]+)(\b|$)?/,id:/^#([\w\-\*]+)(\b|$)/,className:/^\.([\w\-\*]+)(\b|$)/,pseudo:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s)|(?=:))/,attrPresence:/^\[([\w]+)\]/,attr:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/},assertions:{tagName:function(A,B){return B[1].toUpperCase()==A.tagName.toUpperCase();},className:function(A,B){return Element.hasClassName(A,B[1]);},id:function(A,B){return A.id===B[1];},attrPresence:function(A,B){return Element.hasAttribute(A,B[1]);},attr:function(B,C){var A=Element.readAttribute(B,C[1]);return Selector.operators[C[2]](A,C[3]);}},handlers:{concat:function(B,A){for(var C=0,D;D=A[C];C++){B.push(D);}return B;},mark:function(A){for(var B=0,C;C=A[B];B++){C._counted=true;}return A;},unmark:function(A){for(var B=0,C;C=A[B];B++){C._counted=undefined;}return A;},index:function(A,D,G){A._counted=true;if(D){for(var B=A.childNodes,E=B.length-1,C=1;E>=0;E--){var F=B[E];if(F.nodeType==1&&(!G||F._counted)){F.nodeIndex=C++;}}}else{for(var E=0,C=1,B=A.childNodes;F=B[E];E++){if(F.nodeType==1&&(!G||F._counted)){F.nodeIndex=C++;}}}},unique:function(B){if(B.length==0){return B;}var D=[],E;for(var C=0,A=B.length;C<A;C++){if(!(E=B[C])._counted){E._counted=true;D.push(Element.extend(E));}}return Selector.handlers.unmark(D);},descendant:function(A){var D=Selector.handlers;for(var C=0,B=[],E;E=A[C];C++){D.concat(B,E.getElementsByTagName("*"));}return B;},child:function(A){var E=Selector.handlers;for(var D=0,C=[],F;F=A[D];D++){for(var B=0,G;G=F.childNodes[B];B++){if(G.nodeType==1&&G.tagName!="!"){C.push(G);}}}return C;},adjacent:function(A){for(var C=0,B=[],E;E=A[C];C++){var D=this.nextElementSibling(E);if(D){B.push(D);}}return B;},laterSibling:function(A){var D=Selector.handlers;for(var C=0,B=[],E;E=A[C];C++){D.concat(B,Element.nextSiblings(E));}return B;},nextElementSibling:function(A){while(A=A.nextSibling){if(A.nodeType==1){return A;}}return null;},previousElementSibling:function(A){while(A=A.previousSibling){if(A.nodeType==1){return A;}}return null;},tagName:function(B,A,E,H){E=E.toUpperCase();var D=[],F=Selector.handlers;if(B){if(H){if(H=="descendant"){for(var C=0,G;G=B[C];C++){F.concat(D,G.getElementsByTagName(E));}return D;}else{B=this[H](B);}if(E=="*"){return B;}}for(var C=0,G;G=B[C];C++){if(G.tagName.toUpperCase()==E){D.push(G);}}return D;}else{return A.getElementsByTagName(E);}},id:function(B,A,H,F){var G=$(H),D=Selector.handlers;if(!G){return[];}if(!B&&A==document){return[G];}if(B){if(F){if(F=="child"){for(var C=0,E;E=B[C];C++){if(G.parentNode==E){return[G];}}}else{if(F=="descendant"){for(var C=0,E;E=B[C];C++){if(Element.descendantOf(G,E)){return[G];}}}else{if(F=="adjacent"){for(var C=0,E;E=B[C];C++){if(Selector.handlers.previousElementSibling(G)==E){return[G];}}}else{B=D[F](B);}}}}for(var C=0,E;E=B[C];C++){if(E==G){return[G];}}return[];}return(G&&Element.descendantOf(G,A))?[G]:[];},className:function(B,A,C,D){if(B&&D){B=this[D](B);}return Selector.handlers.byClassName(B,A,C);},byClassName:function(C,B,F){if(!C){C=Selector.handlers.descendant([B]);}var H=" "+F+" ";for(var E=0,D=[],G,A;G=C[E];E++){A=G.className;if(A.length==0){continue;}if(A==F||(" "+A+" ").include(H)){D.push(G);}}return D;},attrPresence:function(C,B,A){if(!C){C=B.getElementsByTagName("*");}var E=[];for(var D=0,F;F=C[D];D++){if(Element.hasAttribute(F,A)){E.push(F);}}return E;},attr:function(A,H,G,I,B){if(!A){A=H.getElementsByTagName("*");}var J=Selector.operators[B],D=[];for(var E=0,C;C=A[E];E++){var F=Element.readAttribute(C,G);if(F===null){continue;}if(J(F,I)){D.push(C);}}return D;},pseudo:function(B,C,E,A,D){if(B&&D){B=this[D](B);}if(!B){B=A.getElementsByTagName("*");}return Selector.pseudos[C](B,E,A);}},pseudos:{"first-child":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(Selector.handlers.previousElementSibling(E)){continue;}C.push(E);}return C;},"last-child":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(Selector.handlers.nextElementSibling(E)){continue;}C.push(E);}return C;},"only-child":function(B,G,A){var E=Selector.handlers;for(var D=0,C=[],F;F=B[D];D++){if(!E.previousElementSibling(F)&&!E.nextElementSibling(F)){C.push(F);}}return C;},"nth-child":function(B,C,A){return Selector.pseudos.nth(B,C,A);},"nth-last-child":function(B,C,A){return Selector.pseudos.nth(B,C,A,true);},"nth-of-type":function(B,C,A){return Selector.pseudos.nth(B,C,A,false,true);},"nth-last-of-type":function(B,C,A){return Selector.pseudos.nth(B,C,A,true,true);},"first-of-type":function(B,C,A){return Selector.pseudos.nth(B,"1",A,false,true);},"last-of-type":function(B,C,A){return Selector.pseudos.nth(B,"1",A,true,true);},"only-of-type":function(B,D,A){var C=Selector.pseudos;return C["last-of-type"](C["first-of-type"](B,D,A),D,A);},getIndices:function(B,A,C){if(B==0){return A>0?[A]:[];}return $R(1,C).inject([],function(D,E){if(0==(E-A)%B&&(E-A)/B>=0){D.push(E);}return D;});},nth:function(A,L,N,K,C){if(A.length==0){return[];}if(L=="even"){L="2n+0";}if(L=="odd"){L="2n+1";}var J=Selector.handlers,I=[],B=[],E;J.mark(A);for(var H=0,D;D=A[H];H++){if(!D.parentNode._counted){J.index(D.parentNode,K,C);B.push(D.parentNode);}}if(L.match(/^\d+$/)){L=Number(L);for(var H=0,D;D=A[H];H++){if(D.nodeIndex==L){I.push(D);}}}else{if(E=L.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(E[1]=="-"){E[1]=-1;}var O=E[1]?Number(E[1]):1;var M=E[2]?Number(E[2]):0;var P=Selector.pseudos.getIndices(O,M,A.length);for(var H=0,D,F=P.length;D=A[H];H++){for(var G=0;G<F;G++){if(D.nodeIndex==P[G]){I.push(D);}}}}}J.unmark(A);J.unmark(B);return I;},empty:function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.tagName=="!"||(E.firstChild&&!E.innerHTML.match(/^\s*$/))){continue;}C.push(E);}return C;},not:function(A,D,I){var G=Selector.handlers,J,C;var H=new Selector(D).findElements(I);G.mark(H);for(var F=0,E=[],B;B=A[F];F++){if(!B._counted){E.push(B);}}G.unmark(H);return E;},enabled:function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(!E.disabled){C.push(E);}}return C;},disabled:function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.disabled){C.push(E);}}return C;},checked:function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.checked){C.push(E);}}return C;}},operators:{"=":function(B,A){return B==A;},"!=":function(B,A){return B!=A;},"^=":function(B,A){return B.startsWith(A);},"$=":function(B,A){return B.endsWith(A);},"*=":function(B,A){return B.include(A);},"~=":function(B,A){return(" "+B+" ").include(" "+A+" ");},"|=":function(B,A){return("-"+B.toUpperCase()+"-").include("-"+A.toUpperCase()+"-");}},matchElements:function(F,G){var E=new Selector(G).findElements(),D=Selector.handlers;D.mark(E);for(var C=0,B=[],A;A=F[C];C++){if(A._counted){B.push(A);}}D.unmark(E);return B;},findElement:function(B,C,A){if(Object.isNumber(C)){A=C;C=false;}return Selector.matchElements(B,C||"*")[A||0];},findChildElements:function(E,G){var H=G.join(",");G=[];H.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(I){G.push(I[1].strip());});var D=[],F=Selector.handlers;for(var C=0,B=G.length,A;C<B;C++){A=new Selector(G[C].strip());F.concat(D,A.findElements(E));}return(B>1)?F.unique(D):D;}});if(Prototype.Browser.IE){Selector.handlers.concat=function(B,A){for(var C=0,D;D=A[C];C++){if(D.tagName!=="!"){B.push(D);}}return B;};}function $$(){return Selector.findChildElements(document,$A(arguments));}
if(!window.Event){var Event={};}Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{},relatedTarget:function(B){var A;switch(B.type){case"mouseover":A=B.fromElement;break;case"mouseout":A=B.toElement;break;default:return null;}return Element.extend(A);}});Event.Methods=(function(){var A;if(Prototype.Browser.IE){var B={0:1,1:4,2:2};A=function(D,C){return D.button==B[C];};}else{if(Prototype.Browser.WebKit){A=function(D,C){switch(C){case 0:return D.which==1&&!D.metaKey;case 1:return D.which==1&&D.metaKey;default:return false;}};}else{A=function(D,C){return D.which?(D.which===C+1):(D.button===C);};}}return{isLeftClick:function(C){return A(C,0);},isMiddleClick:function(C){return A(C,1);},isRightClick:function(C){return A(C,2);},element:function(D){var C=Event.extend(D).target;return Element.extend(C.nodeType==Node.TEXT_NODE?C.parentNode:C);},findElement:function(D,F){var C=Event.element(D);if(!F){return C;}var E=[C].concat(C.ancestors());return Selector.findElement(E,F,0);},pointer:function(C){return{x:C.pageX||(C.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)),y:C.pageY||(C.clientY+(document.documentElement.scrollTop||document.body.scrollTop))};},pointerX:function(C){return Event.pointer(C).x;},pointerY:function(C){return Event.pointer(C).y;},stop:function(C){Event.extend(C);C.preventDefault();C.stopPropagation();C.stopped=true;}};})();Event.extend=(function(){var A=Object.keys(Event.Methods).inject({},function(B,C){B[C]=Event.Methods[C].methodize();return B;});if(Prototype.Browser.IE){Object.extend(A,{stopPropagation:function(){this.cancelBubble=true;},preventDefault:function(){this.returnValue=false;},inspect:function(){return"[object Event]";}});return function(B){if(!B){return false;}if(B._extendedByPrototype){return B;}B._extendedByPrototype=Prototype.emptyFunction;var C=Event.pointer(B);Object.extend(B,{target:B.srcElement,relatedTarget:Event.relatedTarget(B),pageX:C.x,pageY:C.y});return Object.extend(B,A);};}else{Event.prototype=Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(Event.prototype,A);return Prototype.K;}})();Object.extend(Event,(function(){var B=Event.cache;function C(J){if(J._eventID){return J._eventID;}arguments.callee.id=arguments.callee.id||1;return J._eventID=++arguments.callee.id;}function G(J){if(J&&J.include(":")){return"dataavailable";}return J;}function A(J){return B[J]=B[J]||{};}function F(L,J){var K=A(L);return K[J]=K[J]||[];}function H(K,J,L){var O=C(K);var N=F(O,J);if(N.pluck("handler").include(L)){return false;}var M=function(P){if(!Event||!Event.extend||(P.eventName&&P.eventName!=J)){return false;}Event.extend(P);L.call(K,P);};M.handler=L;N.push(M);return M;}function I(M,J,K){var L=F(M,J);return L.find(function(N){return N.handler==K;});}function D(M,J,K){var L=A(M);if(!L[J]){return false;}L[J]=L[J].without(I(M,J,K));}function E(){for(var K in B){for(var J in B[K]){B[K][J]=null;}}}if(window.attachEvent){window.attachEvent("onunload",E);}return{observe:function(L,J,M){L=$(L);var K=G(J);var N=H(L,J,M);if(!N){return L;}if(L.addEventListener){L.addEventListener(K,N,false);}else{L.attachEvent("on"+K,N);}return L;},stopObserving:function(L,J,M){L=$(L);var O=C(L),K=G(J);if(!M&&J){F(O,J).each(function(P){L.stopObserving(J,P.handler);});return L;}else{if(!J){Object.keys(A(O)).each(function(P){L.stopObserving(P);});return L;}}var N=I(O,J,M);if(!N){return L;}if(L.removeEventListener){L.removeEventListener(K,N,false);}else{L.detachEvent("on"+K,N);}D(O,J,M);return L;},fire:function(L,K,J){L=$(L);if(L==document&&document.createEvent&&!L.dispatchEvent){L=document.documentElement;}if(document.createEvent){var M=document.createEvent("HTMLEvents");M.initEvent("dataavailable",true,true);}else{var M=document.createEventObject();M.eventType="ondataavailable";}M.eventName=K;M.memo=J||{};if(document.createEvent){L.dispatchEvent(M);}else{L.fireEvent(M.eventType,M);}return Event.extend(M);}};})());Object.extend(Event,Event.Methods);Element.addMethods({fire:Event.fire,observe:Event.observe,stopObserving:Event.stopObserving});Object.extend(document,{fire:Element.Methods.fire.methodize(),observe:Element.Methods.observe.methodize(),stopObserving:Element.Methods.stopObserving.methodize()});(function(){var C,B=false;function A(){if(B){return ;}if(C){window.clearInterval(C);}document.fire("dom:loaded");B=true;}if(document.addEventListener){if(Prototype.Browser.WebKit){C=window.setInterval(function(){if(/loaded|complete/.test(document.readyState)){A();}},0);Event.observe(window,"load",A);}else{document.addEventListener("DOMContentLoaded",A,false);}}else{document.write("<script id=__onDOMContentLoaded defer src=//:><\/script>");$("__onDOMContentLoaded").onreadystatechange=function(){if(this.readyState=="complete"){this.onreadystatechange=null;A();}};}})();
var Form={reset:function(form){$(form).reset();return form},serializeElements:function(elements,options){if(typeof options!="object"){options={hash:!!options}}else{if(Object.isUndefined(options.hash)){options.hash=true}}var key,value,submitted=false,submit=options.submit;var data=elements.inject({},function(result,element){if(!element.disabled&&element.name){key=element.name;value=$(element).getValue();if(value!=null&&(element.type!="submit"||(!submitted&&submit!==false&&(!submit||key==submit)&&(submitted=true)))){if(key in result){if(!Object.isArray(result[key])){result[key]=[result[key]]}result[key].push(value)}else{result[key]=value}}}return result});return options.hash?data:Object.toQueryString(data)}};Form.Methods={serialize:function(form,options){return Form.serializeElements(Form.getElements(form),options)},getElements:function(form){return $A($(form).getElementsByTagName("*")).inject([],function(elements,child){if(Form.Element.Serializers[child.tagName.toLowerCase()]){elements.push(Element.extend(child))}return elements})},getInputs:function(form,typeName,name){form=$(form);var inputs=form.getElementsByTagName("input");if(!typeName&&!name){return $A(inputs).map(Element.extend)}for(var i=0,matchingInputs=[],length=inputs.length;i<length;i++){var input=inputs[i];if((typeName&&input.type!=typeName)||(name&&input.name!=name)){continue}matchingInputs.push(Element.extend(input))}return matchingInputs},disable:function(form){form=$(form);Form.getElements(form).invoke("disable");return form},enable:function(form){form=$(form);Form.getElements(form).invoke("enable");return form},findFirstElement:function(form){var elements=$(form).getElements().findAll(function(element){return"hidden"!=element.type&&!element.disabled});var firstByIndex=elements.findAll(function(element){return element.hasAttribute("tabIndex")&&element.tabIndex>=0}).sortBy(function(element){return element.tabIndex}).first();return firstByIndex?firstByIndex:elements.find(function(element){return["input","select","textarea"].include(element.tagName.toLowerCase())})},focusFirstElement:function(form){form=$(form);form.findFirstElement().activate();return form},request:function(form,options){form=$(form),options=Object.clone(options||{});var params=options.parameters,action=form.readAttribute("action")||"";if(action.blank()){action=window.location.href}options.parameters=form.serialize(true);if(params){if(Object.isString(params)){params=params.toQueryParams()}Object.extend(options.parameters,params)}if(form.hasAttribute("method")&&!options.method){options.method=form.method}return new Ajax.Request(action,options)}};Form.Element={focus:function(element){$(element).focus();return element},select:function(element){$(element).select();return element}};Form.Element.Methods={serialize:function(element){element=$(element);if(!element.disabled&&element.name){var value=element.getValue();if(value!=undefined){var pair={};pair[element.name]=value;return Object.toQueryString(pair)}}return""},getValue:function(element){element=$(element);var method=element.tagName.toLowerCase();return Form.Element.Serializers[method](element)},setValue:function(element,value){element=$(element);var method=element.tagName.toLowerCase();Form.Element.Serializers[method](element,value);return element},clear:function(element){$(element).value="";return element},present:function(element){return $(element).value!=""},activate:function(element){element=$(element);try{element.focus();if(element.select&&(element.tagName.toLowerCase()!="input"||!["button","reset","submit"].include(element.type))){element.select()}}catch(e){}return element},disable:function(element){element=$(element);element.blur();element.disabled=true;return element},enable:function(element){element=$(element);element.disabled=false;return element}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(element,value){switch(element.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(element,value);default:return Form.Element.Serializers.textarea(element,value)}},inputSelector:function(element,value){if(Object.isUndefined(value)){return element.checked?element.value:null}else{element.checked=!!value}},textarea:function(element,value){if(Object.isUndefined(value)){return element.value}else{element.value=value}},select:function(element,index){if(Object.isUndefined(index)){return this[element.type=="select-one"?"selectOne":"selectMany"](element)}else{var opt,value,single=!Object.isArray(index);for(var i=0,length=element.length;i<length;i++){opt=element.options[i];value=this.optionValue(opt);if(single){if(value==index){opt.selected=true;return }}else{opt.selected=index.include(value)}}}},selectOne:function(element){var index=element.selectedIndex;return index>=0?this.optionValue(element.options[index]):null},selectMany:function(element){var values,length=element.length;if(!length){return null}for(var i=0,values=[];i<length;i++){var opt=element.options[i];if(opt.selected){values.push(this.optionValue(opt))}}return values},optionValue:function(opt){return Element.extend(opt).hasAttribute("value")?opt.value:opt.text}};Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,element,frequency,callback){$super(callback,frequency);this.element=$(element);this.lastValue=this.getValue()},execute:function(){var value=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(value)?this.lastValue!=value:String(this.lastValue)!=String(value)){this.callback(this.element,value);this.lastValue=value}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(element,callback){this.element=$(element);this.callback=callback;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var value=this.getValue();if(this.lastValue!=value){this.callback(this.element,value);this.lastValue=value}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(element){if(element.type){switch(element.type.toLowerCase()){case"checkbox":case"radio":Event.observe(element,"click",this.onElementEvent.bind(this));break;default:Event.observe(element,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});
Hashtable.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(A,B){return Element.insert(A,{before:B});},Top:function(A,B){return Element.insert(A,{top:B});},Bottom:function(A,B){return Element.insert(A,{bottom:B});},After:function(A,B){return Element.insert(A,{after:B});}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;},within:function(B,A,C){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(B,A,C);}this.xcomp=A;this.ycomp=C;this.offset=Element.cumulativeOffset(B);return(C>=this.offset[1]&&C<this.offset[1]+B.offsetHeight&&A>=this.offset[0]&&A<this.offset[0]+B.offsetWidth);},withinIncludingScrolloffsets:function(B,A,D){var C=Element.cumulativeScrollOffset(B);this.xcomp=A+C[0]-this.deltaX;this.ycomp=D+C[1]-this.deltaY;this.offset=Element.cumulativeOffset(B);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+B.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+B.offsetWidth);},overlap:function(B,A){if(!B){return 0;}if(B=="vertical"){return((this.offset[1]+A.offsetHeight)-this.ycomp)/A.offsetHeight;}if(B=="horizontal"){return((this.offset[0]+A.offsetWidth)-this.xcomp)/A.offsetWidth;}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(A){Position.prepare();return Element.absolutize(A);},relativize:function(A){Position.prepare();return Element.relativize(A);},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(B,C,A){A=A||{};return Element.clonePosition(C,B,A);}};if(!document.getElementsByClassName){document.getElementsByClassName=function(B){function A(C){return C.blank()?null:"[contains(concat(' ', @class, ' '), ' "+C+" ')]";}B.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(C,E){E=E.toString().strip();var D=/\s/.test(E)?$w(E).map(A).join(""):A(E);return D?document._getElementsByXPath(".//*"+D,C):[];}:function(E,F){F=F.toString().strip();var G=[],H=(/\s/.test(F)?$w(F):null);if(!H&&!F){return G;}var C=$(E).getElementsByTagName("*");F=" "+F+" ";for(var D=0,J,I;J=C[D];D++){if(J.className&&(I=" "+J.className+" ")&&(I.include(F)||(H&&H.all(function(K){return !K.toString().blank()&&I.include(" "+K+" ");})))){G.push(Element.extend(J));}}return G;};return function(D,C){return $(C||document.body).getElementsByClassName(D);};}(Element.Methods);}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(A){this.element=$(A);},_each:function(A){this.element.className.split(/\s+/).select(function(B){return B.length>0;})._each(A);},set:function(A){this.element.className=A;},add:function(A){if(this.include(A)){return ;}this.set($A(this).concat(A).join(" "));},remove:function(A){if(!this.include(A)){return ;}this.set($A(this).without(A).join(" "));},toString:function(){return $A(this).join(" ");}};Object.extend(Element.ClassNames.prototype,Enumerable);Element.addMethods();
var Builder={NODEMAP:{AREA:"map",CAPTION:"table",COL:"table",COLGROUP:"table",LEGEND:"fieldset",OPTGROUP:"select",OPTION:"select",PARAM:"object",TBODY:"table",TD:"table",TFOOT:"table",TH:"table",THEAD:"table",TR:"table"},node:function(A){A=A.toUpperCase();var F=this.NODEMAP[A]||"div";var B=document.createElement(F);try{B.innerHTML="<"+A+"></"+A+">";}catch(E){}var D=B.firstChild||null;if(D&&(D.tagName.toUpperCase()!=A)){D=D.getElementsByTagName(A)[0];}if(!D){D=document.createElement(A);}if(!D){return ;}if(arguments[1]){if(this._isStringOrNumber(arguments[1])||(arguments[1] instanceof Array)||arguments[1].tagName){this._children(D,arguments[1]);}else{var C=this._attributes(arguments[1]);if(C.length){try{B.innerHTML="<"+A+" "+C+"></"+A+">";}catch(E){}D=B.firstChild||null;if(!D){D=document.createElement(A);for(attr in arguments[1]){D[attr=="class"?"className":attr]=arguments[1][attr];}}if(D.tagName.toUpperCase()!=A){D=B.getElementsByTagName(A)[0];}}}}if(arguments[2]){this._children(D,arguments[2]);}return D;},_text:function(A){return document.createTextNode(A);},ATTR_MAP:{className:"class",htmlFor:"for"},_attributes:function(A){var B=[];for(attribute in A){B.push((attribute in this.ATTR_MAP?this.ATTR_MAP[attribute]:attribute)+'="'+A[attribute].toString().escapeHTML().gsub(/"/,"&quot;")+'"');}return B.join(" ");},_children:function(B,A){if(A.tagName){B.appendChild(A);return ;}if(typeof A=="object"){A.flatten().each(function(C){if(typeof C=="object"){B.appendChild(C);}else{if(Builder._isStringOrNumber(C)){B.appendChild(Builder._text(C));}}});}else{if(Builder._isStringOrNumber(A)){B.appendChild(Builder._text(A));}}},_isStringOrNumber:function(A){return(typeof A=="string"||typeof A=="number");},build:function(B){var A=this.node("div");$(A).update(B.strip());return A.down();},dump:function(B){if(typeof B!="object"&&typeof B!="function"){B=window;}var A=("A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR").split(/\s+/);A.each(function(C){B[C]=function(){return Builder.node.apply(Builder,[C].concat($A(arguments)));};});}};
String.prototype.parseColor=function(){var A="#";if(this.slice(0,4)=="rgb("){var C=this.slice(4,this.length-1).split(",");var B=0;do{A+=parseInt(C[B]).toColorPart();}while(++B<3);}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var B=1;B<4;B++){A+=(this.charAt(B)+this.charAt(B)).toLowerCase();}}if(this.length==7){A=this.toLowerCase();}}}return(A.length==7?A:(arguments[0]||this));};Element.collectTextNodes=function(A){return $A($(A).childNodes).collect(function(B){return(B.nodeType==3?B.nodeValue:(B.hasChildNodes()?Element.collectTextNodes(B):""));}).flatten().join("");};Element.collectTextNodesIgnoreClass=function(A,B){return $A($(A).childNodes).collect(function(C){return(C.nodeType==3?C.nodeValue:((C.hasChildNodes()&&!Element.hasClassName(C,B))?Element.collectTextNodesIgnoreClass(C,B):""));}).flatten().join("");};Element.setContentZoom=function(A,B){A=$(A);A.setStyle({fontSize:(B/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0);}return A;};Element.getInlineOpacity=function(A){return $(A).style.opacity||"";};Element.forceRerendering=function(A){try{A=$(A);var C=document.createTextNode(" ");A.appendChild(C);A.removeChild(C);}catch(B){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(A){return(-Math.cos(A*Math.PI)/2)+0.5;},reverse:function(A){return 1-A;},flicker:function(A){var A=((-Math.cos(A*Math.PI)/4)+0.75)+Math.random()/4;return A>1?1:A;},wobble:function(A){return(-Math.cos(A*Math.PI*(9*A))/2)+0.5;},pulse:function(B,A){A=A||5;return(((B%(1/A))*A).round()==0?((B*A*2)-(B*A*2).floor()):1-((B*A*2)-(B*A*2).floor()));},spring:function(A){return 1-(Math.cos(A*4.5*Math.PI)*Math.exp(-A*6));},none:function(A){return 0;},full:function(A){return 1;}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(A){var B="position:relative";if(Prototype.Browser.IE){B+=";zoom:1";}A=$(A);$A(A.childNodes).each(function(C){if(C.nodeType==3){C.nodeValue.toArray().each(function(D){A.insertBefore(new Element("span",{style:B}).update(D==" "?String.fromCharCode(160):D),C);});Element.remove(C);}});},multiple:function(B,C){var E;if(((typeof B=="object")||Object.isFunction(B))&&(B.length)){E=B;}else{E=$(B).childNodes;}var A=Object.extend({speed:0.1,delay:0},arguments[2]||{});var D=A.delay;$A(E).each(function(G,F){new C(G,Object.extend(A,{delay:F*A.speed+D}));});},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(B,C){B=$(B);C=(C||"appear").toLowerCase();var A=Object.extend({queue:{position:"end",scope:(B.id||"global"),limit:1}},arguments[2]||{});Effect[B.visible()?Effect.PAIRS[C][1]:Effect.PAIRS[C][0]](B,A);}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null;},_each:function(A){this.effects._each(A);},add:function(B){var C=new Date().getTime();var A=Object.isString(B.options.queue)?B.options.queue:B.options.queue.position;switch(A){case"front":this.effects.findAll(function(D){return D.state=="idle";}).each(function(D){D.startOn+=B.finishOn;D.finishOn+=B.finishOn;});break;case"with-last":C=this.effects.pluck("startOn").max()||C;break;case"end":C=this.effects.pluck("finishOn").max()||C;break;}B.startOn+=C;B.finishOn+=C;if(!B.options.queue.limit||(this.effects.length<B.options.queue.limit)){this.effects.push(B);}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15);}},remove:function(A){this.effects=this.effects.reject(function(B){return B==A;});if(this.effects.length==0){clearInterval(this.interval);this.interval=null;}},loop:function(){var C=new Date().getTime();for(var B=0,A=this.effects.length;B<A;B++){this.effects[B]&&this.effects[B].loop(C);}}});Effect.Queues={instances:$H(),get:function(A){if(!Object.isString(A)){return A;}return this.instances.get(A)||this.instances.set(A,new Effect.ScopedQueue());}};Effect.Queue=Effect.Queues.get("global");Effect.Base=Class.create({position:null,start:function(options){function codeForEvent(options,eventName){return((options[eventName+"Internal"]?"this.options."+eventName+"Internal(this);":"")+(options[eventName]?"this.options."+eventName+"(this);":""));}if(options&&options.transition===false){options.transition=Effect.Transitions.linear;}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;eval('this.render = function(pos){ if (this.state=="idle"){this.state="running";'+codeForEvent(this.options,"beforeSetup")+(this.setup?"this.setup();":"")+codeForEvent(this.options,"afterSetup")+'};if (this.state=="running"){pos=this.options.transition(pos)*'+this.fromToDelta+"+"+this.options.from+";this.position=pos;"+codeForEvent(this.options,"beforeUpdate")+(this.update?"this.update(pos);":"")+codeForEvent(this.options,"afterUpdate")+"}}");this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this);}},loop:function(C){if(C>=this.startOn){if(C>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish();}this.event("afterFinish");return ;}var B=(C-this.startOn)/this.totalTime,A=(B*this.totalFrames).round();if(A>this.currentFrame){this.render(B);this.currentFrame=A;}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this);}this.state="finished";},event:function(A){if(this.options[A+"Internal"]){this.options[A+"Internal"](this);}if(this.options[A]){this.options[A](this);}},inspect:function(){var A=$H();for(property in this){if(!Object.isFunction(this[property])){A.set(property,this[property]);}}return"#<Effect:"+A.inspect()+",options:"+$H(this.options).inspect()+">";}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(A){this.effects=A||[];this.start(arguments[1]);},update:function(A){this.effects.invoke("render",A);},finish:function(A){this.effects.each(function(B){B.render(1);B.cancel();B.event("beforeFinish");if(B.finish){B.finish(A);}B.event("afterFinish");});}});Effect.Tween=Class.create(Effect.Base,{initialize:function(C,F,E){C=Object.isString(C)?$(C):C;var B=$A(arguments),D=B.last(),A=B.length==5?B[3]:null;this.method=Object.isFunction(D)?D.bind(C):Object.isFunction(C[D])?C[D].bind(C):function(G){C[D]=G;};this.start(Object.extend({from:F,to:E},A||{}));},update:function(A){this.method(A);}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}));},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError);}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1});}var A=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(A);},update:function(A){this.element.setOpacity(A);}});Effect.Move=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError);}var A=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(A);},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop;}},update:function(A){this.element.setStyle({left:(this.options.x*A+this.originalLeft).round()+"px",top:(this.options.y*A+this.originalTop).round()+"px"});}});Effect.MoveBy=function(B,A,C){return new Effect.Move(B,Object.extend({x:C,y:A},arguments[3]||{}));};Effect.Scale=Class.create(Effect.Base,{initialize:function(B,C){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError);}var A=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:C},arguments[2]||{});this.start(A);},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(B){this.originalStyle[B]=this.element.style[B];}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var A=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(B){if(A.indexOf(B)>0){this.fontSize=parseFloat(A);this.fontSizeType=B;}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth];}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth];}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth];}},update:function(A){var B=(this.options.scaleFrom/100)+(this.factor*A);if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*B+this.fontSizeType});}this.setDimensions(this.dims[0]*B,this.dims[1]*B);},finish:function(A){if(this.restoreAfterFinish){this.element.setStyle(this.originalStyle);}},setDimensions:function(A,D){var E={};if(this.options.scaleX){E.width=D.round()+"px";}if(this.options.scaleY){E.height=A.round()+"px";}if(this.options.scaleFromCenter){var C=(A-this.dims[0])/2;var B=(D-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY){E.top=this.originalTop-C+"px";}if(this.options.scaleX){E.left=this.originalLeft-B+"px";}}else{if(this.options.scaleY){E.top=-C+"px";}if(this.options.scaleX){E.left=-B+"px";}}}this.element.setStyle(E);}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError);}var A=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(A);},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return ;}this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"});}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff");}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color");}this._base=$R(0,2).map(function(A){return parseInt(this.options.startcolor.slice(A*2+1,A*2+3),16);}.bind(this));this._delta=$R(0,2).map(function(A){return parseInt(this.options.endcolor.slice(A*2+1,A*2+3),16)-this._base[A];}.bind(this));},update:function(A){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(B,C,D){return B+((this._base[D]+(this._delta[D]*A)).round().toColorPart());}.bind(this))});},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}));}});Effect.ScrollTo=function(D){var C=arguments[1]||{},B=document.viewport.getScrollOffsets(),E=$(D).cumulativeOffset(),A=document.viewport.getScrollOffsets[0]-document.viewport.getHeight();if(C.offset){E[1]+=C.offset;}return new Effect.Tween(null,B.top,E[1]>A?A:E[1],C,function(F){scrollTo(B.left,F.round());});};Effect.Fade=function(C){C=$(C);var A=C.getInlineOpacity();var B=Object.extend({from:C.getOpacity()||1,to:0,afterFinishInternal:function(D){if(D.options.to!=0){return ;}D.element.hide().setStyle({opacity:A});}},arguments[1]||{});return new Effect.Opacity(C,B);};Effect.Appear=function(B){B=$(B);var A=Object.extend({from:(B.getStyle("display")=="none"?0:B.getOpacity()||0),to:1,afterFinishInternal:function(C){C.element.forceRerendering();},beforeSetup:function(C){C.element.setOpacity(C.options.from).show();}},arguments[1]||{});return new Effect.Opacity(B,A);};Effect.Puff=function(B){B=$(B);var A={opacity:B.getInlineOpacity(),position:B.getStyle("position"),top:B.style.top,left:B.style.left,width:B.style.width,height:B.style.height};return new Effect.Parallel([new Effect.Scale(B,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(B,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(C){Position.absolutize(C.effects[0].element);},afterFinishInternal:function(C){C.effects[0].element.hide().setStyle(A);}},arguments[1]||{}));};Effect.BlindUp=function(A){A=$(A);A.makeClipping();return new Effect.Scale(A,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(B){B.element.hide().undoClipping();}},arguments[1]||{}));};Effect.BlindDown=function(B){B=$(B);var A=B.getDimensions();return new Effect.Scale(B,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:A.height,originalWidth:A.width},restoreAfterFinish:true,afterSetup:function(C){C.element.makeClipping().setStyle({height:"0px"}).show();},afterFinishInternal:function(C){C.element.undoClipping();}},arguments[1]||{}));};Effect.SwitchOff=function(B){B=$(B);var A=B.getInlineOpacity();return new Effect.Appear(B,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(C){new Effect.Scale(C.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(D){D.element.makePositioned().makeClipping();},afterFinishInternal:function(D){D.element.hide().undoClipping().undoPositioned().setStyle({opacity:A});}});}},arguments[1]||{}));};Effect.DropOut=function(B){B=$(B);var A={top:B.getStyle("top"),left:B.getStyle("left"),opacity:B.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(B,{x:0,y:100,sync:true}),new Effect.Opacity(B,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(C){C.effects[0].element.makePositioned();},afterFinishInternal:function(C){C.effects[0].element.hide().undoPositioned().setStyle(A);}},arguments[1]||{}));};Effect.Shake=function(D){D=$(D);var B=Object.extend({distance:20,duration:0.5},arguments[1]||{});var E=parseFloat(B.distance);var C=parseFloat(B.duration)/10;var A={top:D.getStyle("top"),left:D.getStyle("left")};return new Effect.Move(D,{x:E,y:0,duration:C,afterFinishInternal:function(F){new Effect.Move(F.element,{x:-E*2,y:0,duration:C*2,afterFinishInternal:function(G){new Effect.Move(G.element,{x:E*2,y:0,duration:C*2,afterFinishInternal:function(H){new Effect.Move(H.element,{x:-E*2,y:0,duration:C*2,afterFinishInternal:function(I){new Effect.Move(I.element,{x:E*2,y:0,duration:C*2,afterFinishInternal:function(J){new Effect.Move(J.element,{x:-E,y:0,duration:C,afterFinishInternal:function(K){K.element.undoPositioned().setStyle(A);}});}});}});}});}});}});};Effect.SlideDown=function(C){C=$(C).cleanWhitespace();var A=C.down().getStyle("bottom");var B=C.getDimensions();return new Effect.Scale(C,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:B.height,originalWidth:B.width},restoreAfterFinish:true,afterSetup:function(D){D.element.makePositioned();D.element.down().makePositioned();if(window.opera){D.element.setStyle({top:""});}D.element.makeClipping().setStyle({height:"0px"}).show();},afterUpdateInternal:function(D){D.element.down().setStyle({bottom:(D.dims[0]-D.element.clientHeight)+"px"});},afterFinishInternal:function(D){D.element.undoClipping().undoPositioned();D.element.down().undoPositioned().setStyle({bottom:A});}},arguments[1]||{}));};Effect.SlideUp=function(C){C=$(C).cleanWhitespace();var A=C.down().getStyle("bottom");var B=C.getDimensions();return new Effect.Scale(C,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:B.height,originalWidth:B.width},restoreAfterFinish:true,afterSetup:function(D){D.element.makePositioned();D.element.down().makePositioned();if(window.opera){D.element.setStyle({top:""});}D.element.makeClipping().show();},afterUpdateInternal:function(D){D.element.down().setStyle({bottom:(D.dims[0]-D.element.clientHeight)+"px"});},afterFinishInternal:function(D){D.element.hide().undoClipping().undoPositioned();D.element.down().undoPositioned().setStyle({bottom:A});}},arguments[1]||{}));};Effect.Squish=function(A){return new Effect.Scale(A,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(B){B.element.makeClipping();},afterFinishInternal:function(B){B.element.hide().undoClipping();}});};Effect.Grow=function(C){C=$(C);var B=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var A={top:C.style.top,left:C.style.left,height:C.style.height,width:C.style.width,opacity:C.getInlineOpacity()};var G=C.getDimensions();var H,F;var E,D;switch(B.direction){case"top-left":H=F=E=D=0;break;case"top-right":H=G.width;F=D=0;E=-G.width;break;case"bottom-left":H=E=0;F=G.height;D=-G.height;break;case"bottom-right":H=G.width;F=G.height;E=-G.width;D=-G.height;break;case"center":H=G.width/2;F=G.height/2;E=-G.width/2;D=-G.height/2;break;}return new Effect.Move(C,{x:H,y:F,duration:0.01,beforeSetup:function(I){I.element.hide().makeClipping().makePositioned();},afterFinishInternal:function(I){new Effect.Parallel([new Effect.Opacity(I.element,{sync:true,to:1,from:0,transition:B.opacityTransition}),new Effect.Move(I.element,{x:E,y:D,sync:true,transition:B.moveTransition}),new Effect.Scale(I.element,100,{scaleMode:{originalHeight:G.height,originalWidth:G.width},sync:true,scaleFrom:window.opera?1:0,transition:B.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(J){J.effects[0].element.setStyle({height:"0px"}).show();},afterFinishInternal:function(J){J.effects[0].element.undoClipping().undoPositioned().setStyle(A);}},B));}});};Effect.Shrink=function(C){C=$(C);var B=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var A={top:C.style.top,left:C.style.left,height:C.style.height,width:C.style.width,opacity:C.getInlineOpacity()};var F=C.getDimensions();var E,D;switch(B.direction){case"top-left":E=D=0;break;case"top-right":E=F.width;D=0;break;case"bottom-left":E=0;D=F.height;break;case"bottom-right":E=F.width;D=F.height;break;case"center":E=F.width/2;D=F.height/2;break;}return new Effect.Parallel([new Effect.Opacity(C,{sync:true,to:0,from:1,transition:B.opacityTransition}),new Effect.Scale(C,window.opera?1:0,{sync:true,transition:B.scaleTransition,restoreAfterFinish:true}),new Effect.Move(C,{x:E,y:D,sync:true,transition:B.moveTransition})],Object.extend({beforeStartInternal:function(G){G.effects[0].element.makePositioned().makeClipping();},afterFinishInternal:function(G){G.effects[0].element.hide().undoClipping().undoPositioned().setStyle(A);}},B));};Effect.Pulsate=function(C){C=$(C);var B=arguments[1]||{};var A=C.getInlineOpacity();var E=B.transition||Effect.Transitions.sinoidal;var D=function(F){return E(1-Effect.Transitions.pulse(F,B.pulses));};D.bind(E);return new Effect.Opacity(C,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(F){F.element.setStyle({opacity:A});}},B),{transition:D}));};Effect.Fold=function(B){B=$(B);var A={top:B.style.top,left:B.style.left,width:B.style.width,height:B.style.height};B.makeClipping();return new Effect.Scale(B,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(C){new Effect.Scale(B,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(D){D.element.hide().undoClipping().setStyle(A);}});}},arguments[1]||{}));};Effect.Morph=Class.create(Effect.Base,{initialize:function(C){this.element=$(C);if(!this.element){throw (Effect._elementDoesNotExistError);}var A=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(A.style)){this.style=$H(A.style);}else{if(A.style.include(":")){this.style=A.style.parseStyle();}else{this.element.addClassName(A.style);this.style=$H(this.element.getStyles());this.element.removeClassName(A.style);var B=this.element.getStyles();this.style=this.style.reject(function(D){return D.value==B[D.key];});A.afterFinishInternal=function(D){D.element.addClassName(D.options.style);D.transforms.each(function(E){D.element.style[E.style]="";});};}}this.start(A);},setup:function(){function A(B){if(!B||["rgba(0, 0, 0, 0)","transparent"].include(B)){B="#ffffff";}B=B.parseColor();return $R(0,2).map(function(C){return parseInt(B.slice(C*2+1,C*2+3),16);});}this.transforms=this.style.map(function(G){var F=G[0],E=G[1],D=null;if(E.parseColor("#zzzzzz")!="#zzzzzz"){E=E.parseColor();D="color";}else{if(F=="opacity"){E=parseFloat(E);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1});}}else{if(Element.CSS_LENGTH.test(E)){var C=E.match(/^([\+\-]?[0-9\.]+)(.*)$/);E=parseFloat(C[1]);D=(C.length==3)?C[2]:null;}}}var B=this.element.getStyle(F);return{style:F.camelize(),originalValue:D=="color"?A(B):parseFloat(B||0),targetValue:D=="color"?A(E):E,unit:D};}.bind(this)).reject(function(B){return((B.originalValue==B.targetValue)||(B.unit!="color"&&(isNaN(B.originalValue)||isNaN(B.targetValue))));});},update:function(A){var D={},B,C=this.transforms.length;while(C--){D[(B=this.transforms[C]).style]=B.unit=="color"?"#"+(Math.round(B.originalValue[0]+(B.targetValue[0]-B.originalValue[0])*A)).toColorPart()+(Math.round(B.originalValue[1]+(B.targetValue[1]-B.originalValue[1])*A)).toColorPart()+(Math.round(B.originalValue[2]+(B.targetValue[2]-B.originalValue[2])*A)).toColorPart():(B.originalValue+(B.targetValue-B.originalValue)*A).toFixed(3)+(B.unit===null?"":B.unit);}this.element.setStyle(D,true);}});Effect.Transform=Class.create({initialize:function(A){this.tracks=[];this.options=arguments[1]||{};this.addTracks(A);},addTracks:function(A){A.each(function(B){B=$H(B);var C=B.values().first();this.tracks.push($H({ids:B.keys().first(),effect:Effect.Morph,options:{style:C}}));}.bind(this));return this;},play:function(){return new Effect.Parallel(this.tracks.map(function(A){var D=A.get("ids"),C=A.get("effect"),B=A.get("options");var E=[$(D)||$$(D)].flatten();return E.map(function(F){return new C(F,Object.extend({sync:true},B));});}).flatten(),this.options);}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");String.prototype.parseStyle=function(){var B,A=$H();if(Prototype.Browser.WebKit){B=new Element("div",{style:this}).style;}else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';B=String.__parseStyleElement.childNodes[0].style;}Element.CSS_PROPERTIES.each(function(C){if(B[C]){A.set(C,B[C]);}});if(Prototype.Browser.IE&&this.include("opacity")){A.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);}return A;};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(B){var A=document.defaultView.getComputedStyle($(B),null);return Element.CSS_PROPERTIES.inject({},function(C,D){C[D]=A[D];return C;});};}else{Element.getStyles=function(B){B=$(B);var A=B.currentStyle,C;C=Element.CSS_PROPERTIES.inject({},function(D,E){D[E]=A[E];return D;});if(!C.opacity){C.opacity=B.getOpacity();}return C;};}Effect.Methods={morph:function(A,B){A=$(A);new Effect.Morph(A,Object.extend({style:B},arguments[2]||{}));return A;},visualEffect:function(C,E,B){C=$(C);var D=E.dasherize().camelize(),A=D.charAt(0).toUpperCase()+D.substring(1);new Effect[A](C,B);return C;},highlight:function(B,A){B=$(B);new Effect.Highlight(B,A);return B;}};$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(A){Effect.Methods[A]=function(C,B){C=$(C);Effect[A.charAt(0).toUpperCase()+A.substring(1)](C,B);return C;};});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(A){Effect.Methods[A]=Element[A];});Element.addMethods(Effect.Methods);
if(Object.isUndefined(Effect)){throw ("dragdrop.js requires including script.aculo.us' effects.js library");}var Droppables={drops:[],remove:function(A){this.drops=this.drops.reject(function(B){return B.element==$(A);});},add:function(B){B=$(B);var A=Object.extend({greedy:true,hoverclass:null,tree:false,scrollid:null},arguments[1]||{});if(A.containment){A._containers=[];var C=A.containment;if(Object.isArray(C)){C.each(function(D){A._containers.push($(D));});}else{A._containers.push($(C));}}if(A.accept){A.accept=[A.accept].flatten();}Element.makePositioned(B);A.element=B;this.drops.push(A);},findDeepestChild:function(A){deepest=A[0];for(i=1;i<A.length;++i){if(Element.isParent(A[i].element,deepest.element)){deepest=A[i];}}return deepest;},isContained:function(B,A){var C;if(A.tree){C=B.treeNode;}else{C=B.parentNode;}return A._containers.detect(function(D){return C==D;});},isAffected:function(A,C,B){if(B.scrollid){Position.includeScrollOffsets=true;scrolling_element=$(B.scrollid);var D=Element.cumulativeOffset(scrolling_element);if(A[1]<D[1]||A[1]>Element.getHeight(scrolling_element)+D[1]){return false;}else{if(A[0]<D[0]||A[0]>Element.getWidth(scrolling_element)+D[0]){return false;}}}return((B.element!=C)&&((!B._containers)||this.isContained(C,B))&&((!B.accept)||(Element.classNames(C).detect(function(E){return B.accept.include(E);})))&&Position.within(B.element,A[0],A[1]));},deactivate:function(A){if(A.hoverclass){Element.removeClassName(A.element,A.hoverclass);}this.last_active=null;},activate:function(A){if(A.hoverclass){Element.addClassName(A.element,A.hoverclass);}this.last_active=A;},show:function(A,C){if(!this.drops.length){return ;}var B,D=[];this.drops.each(function(E){if(Droppables.isAffected(A,C,E)){D.push(E);}});if(D.length>0){B=Droppables.findDeepestChild(D);}if(this.last_active&&this.last_active!=B){this.deactivate(this.last_active);}if(B){Position.within(B.element,A[0],A[1]);if(B.onHover){B.onHover(C,B.element,Position.overlap(B.overlap,B.element));}if(B!=this.last_active){Droppables.activate(B);}}},fire:function(B,A){if(!this.last_active){return ;}Position.prepare();if(this.isAffected([Event.pointerX(B),Event.pointerY(B)],A,this.last_active)){if(this.last_active.onDrop){this.last_active.onDrop(A,this.last_active.element,B);return true;}}},reset:function(){if(this.last_active){this.deactivate(this.last_active);}}};var Draggables={drags:[],observers:[],register:function(A){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress);}this.drags.push(A);},unregister:function(A){this.drags=this.drags.reject(function(B){return B==A;});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress);}},activate:function(A){if(A.options.delay){this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=A;}.bind(this),A.options.delay);}else{window.focus();this.activeDraggable=A;}},deactivate:function(){this.activeDraggable=null;},updateDrag:function(A){if(!this.activeDraggable){return ;}var B=[Event.pointerX(A),Event.pointerY(A)];if(this._lastPointer&&(this._lastPointer.inspect()==B.inspect())){return ;}this._lastPointer=B;this.activeDraggable.updateDrag(A,B);},endDrag:function(A){if(this._timeout){clearTimeout(this._timeout);this._timeout=null;}if(!this.activeDraggable){return ;}this._lastPointer=null;this.activeDraggable.endDrag(A);this.activeDraggable=null;},keyPress:function(A){if(this.activeDraggable){this.activeDraggable.keyPress(A);}},addObserver:function(A){this.observers.push(A);this._cacheObserverCallbacks();},removeObserver:function(A){this.observers=this.observers.reject(function(B){return B.element==A;});this._cacheObserverCallbacks();},notify:function(B,A,C){if(this[B+"Count"]>0){this.observers.each(function(D){if(D[B]){D[B](B,A,C);}});}if(A.options[B]){A.options[B](A,C);}},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(A){Draggables[A+"Count"]=Draggables.observers.select(function(B){return B[A];}).length;});}};var Draggable=Class.create({initialize:function(B){var C={handle:false,reverteffect:function(F,E,D){var G=Math.sqrt(Math.abs(E^2)+Math.abs(D^2))*0.02;new Effect.Move(F,{x:-D,y:-E,duration:G,queue:{scope:"_draggable",position:"end"}});},endeffect:function(E){var D=Object.isNumber(E._opacity)?E._opacity:1;new Effect.Opacity(E,{duration:0.2,from:0.7,to:D,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[E]=false;}});},zindex:1000,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!arguments[1]||Object.isUndefined(arguments[1].endeffect)){Object.extend(C,{starteffect:function(D){D._opacity=Element.getOpacity(D);Draggable._dragging[D]=true;new Effect.Opacity(D,{duration:0.2,from:D._opacity,to:0.7});}});}var A=Object.extend(C,arguments[1]||{});this.element=$(B);if(A.handle&&Object.isString(A.handle)){this.handle=this.element.down("."+A.handle,0);}if(!this.handle){this.handle=$(A.handle);}if(!this.handle){this.handle=this.element;}if(A.scroll&&!A.scroll.scrollTo&&!A.scroll.outerHTML){A.scroll=$(A.scroll);this._isScrollChild=Element.childOf(this.element,A.scroll);}Element.makePositioned(this.element);this.options=A;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this);},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Draggables.unregister(this);},currentDelta:function(){return([parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")]);},initDrag:function(A){if(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element]){return ;}if(Event.isLeftClick(A)){var C=Event.element(A);if((tag_name=C.tagName.toUpperCase())&&(tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="OPTION"||tag_name=="BUTTON"||tag_name=="TEXTAREA")){return ;}var B=[Event.pointerX(A),Event.pointerY(A)];var D=Position.cumulativeOffset(this.element);this.offset=[0,1].map(function(E){return(B[E]-D[E]);});Draggables.activate(this);Event.stop(A);}},startDrag:function(B){this.dragging=true;if(!this.delta){this.delta=this.currentDelta();}if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0);this.element.style.zIndex=this.options.zindex;}if(this.options.ghosting){this._clone=this.element.cloneNode(true);this._originallyAbsolute=(this.element.getStyle("position")=="absolute");if(!this._originallyAbsolute){Position.absolutize(this.element);}this.element.parentNode.insertBefore(this._clone,this.element);}if(this.options.scroll){if(this.options.scroll==window){var A=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=A.left;this.originalScrollTop=A.top;}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop;}}Draggables.notify("onStart",this,B);if(this.options.starteffect){this.options.starteffect(this.element);}},hasOffsets:function(B){var A=B.parentNode;if(A==document||!A){return false;}if(A.scrollTop!=0){return true;}return this.hasOffsets(A);},updateDrag:function(event,pointer){if(!this.dragging){this.startDrag(event);}if(!this.options.quiet){Position.prepare();if(this.hasOffsets(this.element)){var windowOffset=document.viewport.getScrollOffsets();var realOffset=Position.realOffset(this.element);var dropOffset=new Array(pointer[0]+realOffset[0]-windowOffset[0],pointer[1]+realOffset[1]-windowOffset[1]);Droppables.show(dropOffset,this.element);}else{Droppables.show(pointer,this.element);}}Draggables.notify("onDrag",this,event);this.draw(pointer);if(this.options.change){this.options.change(this);}if(this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){p=[left,top,left+width,top+height];}}else{p=Position.page(this.options.scroll);p[0]+=this.options.scroll.scrollLeft+Position.deltaX;p[1]+=this.options.scroll.scrollTop+Position.deltaY;p.push(p[0]+this.options.scroll.offsetWidth);p.push(p[1]+this.options.scroll.offsetHeight);}var speed=[0,0];if(pointer[0]<(p[0]+this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[0]+this.options.scrollSensitivity);}if(pointer[1]<(p[1]+this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity);}if(pointer[0]>(p[2]-this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[2]-this.options.scrollSensitivity);}if(pointer[1]>(p[3]-this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity);}this.startScrolling(speed);}if(Prototype.Browser.WebKit){window.scrollBy(0,0);}Event.stop(event);},finishDrag:function(B,E){this.dragging=false;if(this.options.quiet){Position.prepare();var D=[Event.pointerX(B),Event.pointerY(B)];Droppables.show(D,this.element);}if(this.options.ghosting){if(!this._originallyAbsolute){Position.relativize(this.element);}delete this._originallyAbsolute;Element.remove(this._clone);this._clone=null;}var F=false;if(E){F=Droppables.fire(B,this.element);if(!F){F=false;}}if(F&&this.options.onDropped){this.options.onDropped(this.element);}Draggables.notify("onEnd",this,B);var A=this.options.revert;if(A&&Object.isFunction(A)){A=A(this.element);}var C=this.currentDelta();if(A&&this.options.reverteffect){if(F==0||A!="failure"){this.options.reverteffect(this.element,C[1]-this.delta[1],C[0]-this.delta[0]);}}else{this.delta=C;}if(this.options.zindex){this.element.style.zIndex=this.originalZ;}if(this.options.endeffect){this.options.endeffect(this.element);}Draggables.deactivate(this);Droppables.reset();},keyPress:function(A){if(A.keyCode!=Event.KEY_ESC){return ;}this.finishDrag(A,false);Event.stop(A);},endDrag:function(A){if(!this.dragging){return ;}this.stopScrolling();this.finishDrag(A,true);Event.stop(A);},draw:function(A){var F=Position.cumulativeOffset(this.element);if(this.options.ghosting){var C=Position.realOffset(this.element);F[0]+=C[0]-Position.deltaX;F[1]+=C[1]-Position.deltaY;}var E=this.currentDelta();F[0]-=E[0];F[1]-=E[1];if(this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)){F[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;F[1]-=this.options.scroll.scrollTop-this.originalScrollTop;}var D=[0,1].map(function(G){return(A[G]-F[G]-this.offset[G]);}.bind(this));if(this.options.snap){if(Object.isFunction(this.options.snap)){D=this.options.snap(D[0],D[1],this);}else{if(Object.isArray(this.options.snap)){D=D.map(function(G,H){return(G/this.options.snap[H]).round()*this.options.snap[H];}.bind(this));}else{D=D.map(function(G){return(G/this.options.snap).round()*this.options.snap;}.bind(this));}}}var B=this.element.style;if((!this.options.constraint)||(this.options.constraint=="horizontal")){B.left=D[0]+"px";}if((!this.options.constraint)||(this.options.constraint=="vertical")){B.top=D[1]+"px";}if(B.visibility=="hidden"){B.visibility="";}},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null;}},startScrolling:function(A){if(!(A[0]||A[1])){return ;}this.scrollSpeed=[A[0]*this.options.scrollSpeed,A[1]*this.options.scrollSpeed];this.lastScrolled=new Date();this.scrollInterval=setInterval(this.scroll.bind(this),10);},scroll:function(){var current=new Date();var delta=current-this.lastScrolled;this.lastScrolled=current;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1000;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1]);}}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1000;this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1000;}Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);if(this._isScrollChild){Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1000;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1000;if(Draggables._lastScrollPointer[0]<0){Draggables._lastScrollPointer[0]=0;}if(Draggables._lastScrollPointer[1]<0){Draggables._lastScrollPointer[1]=0;}this.draw(Draggables._lastScrollPointer);}if(this.options.change){this.options.change(this);}},_getWindowScroll:function(w){var T,L,W,H;with(w.document){if(w.document.documentElement&&documentElement.scrollTop){T=documentElement.scrollTop;L=documentElement.scrollLeft;}else{if(w.document.body){T=body.scrollTop;L=body.scrollLeft;}}if(w.innerWidth){W=w.innerWidth;H=w.innerHeight;}else{if(w.document.documentElement&&documentElement.clientWidth){W=documentElement.clientWidth;H=documentElement.clientHeight;}else{W=body.offsetWidth;H=body.offsetHeight;}}}return{top:T,left:L,width:W,height:H};}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(B,A){this.element=$(B);this.observer=A;this.lastValue=Sortable.serialize(this.element);},onStart:function(){this.lastValue=Sortable.serialize(this.element);},onEnd:function(){Sortable.unmark();if(this.lastValue!=Sortable.serialize(this.element)){this.observer(this.element);}}});var Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(A){while(A.tagName.toUpperCase()!="BODY"){if(A.id&&Sortable.sortables[A.id]){return A;}A=A.parentNode;}},options:function(A){A=Sortable._findRootElement($(A));if(!A){return ;}return Sortable.sortables[A.id];},destroy:function(A){var B=Sortable.options(A);if(B){Draggables.removeObserver(B.element);B.droppables.each(function(C){Droppables.remove(C);});B.draggables.invoke("destroy");delete Sortable.sortables[B.element.id];}},create:function(C){C=$(C);var B=Object.extend({element:C,tag:"li",dropOnEmpty:false,tree:false,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:C,handle:false,only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(C);var A={revert:true,quiet:B.quiet,scroll:B.scroll,scrollSpeed:B.scrollSpeed,scrollSensitivity:B.scrollSensitivity,delay:B.delay,ghosting:B.ghosting,constraint:B.constraint,handle:B.handle};if(B.starteffect){A.starteffect=B.starteffect;}if(B.reverteffect){A.reverteffect=B.reverteffect;}else{if(B.ghosting){A.reverteffect=function(F){F.style.top=0;F.style.left=0;};}}if(B.endeffect){A.endeffect=B.endeffect;}if(B.zindex){A.zindex=B.zindex;}var D={overlap:B.overlap,containment:B.containment,tree:B.tree,hoverclass:B.hoverclass,onHover:Sortable.onHover};var E={onHover:Sortable.onEmptyHover,overlap:B.overlap,containment:B.containment,hoverclass:B.hoverclass};Element.cleanWhitespace(C);B.draggables=[];B.droppables=[];if(B.dropOnEmpty||B.tree){Droppables.add(C,E);B.droppables.push(C);}(B.elements||this.findElements(C,B)||[]).each(function(H,F){var G=B.handles?$(B.handles[F]):(B.handle?$(H).select("."+B.handle)[0]:H);B.draggables.push(new Draggable(H,Object.extend(A,{handle:G})));Droppables.add(H,D);if(B.tree){H.treeNode=C;}B.droppables.push(H);});if(B.tree){(Sortable.findTreeElements(C,B)||[]).each(function(F){Droppables.add(F,E);F.treeNode=C;B.droppables.push(F);});}this.sortables[C.id]=B;Draggables.addObserver(new SortableObserver(C,B.onUpdate));},findElements:function(B,A){return Element.findChildren(B,A.only,A.tree?true:false,A.tag);},findTreeElements:function(B,A){return Element.findChildren(B,A.only,A.tree?true:false,A.treeTag);},onHover:function(E,D,A){if(Element.isParent(D,E)){return ;}if(A>0.33&&A<0.66&&Sortable.options(D).tree){return ;}else{if(A>0.5){Sortable.mark(D,"before");if(D.previousSibling!=E){var B=E.parentNode;E.style.visibility="hidden";D.parentNode.insertBefore(E,D);if(D.parentNode!=B){Sortable.options(B).onChange(E);}Sortable.options(D.parentNode).onChange(E);}}else{Sortable.mark(D,"after");var C=D.nextSibling||null;if(C!=E){var B=E.parentNode;E.style.visibility="hidden";D.parentNode.insertBefore(E,C);if(D.parentNode!=B){Sortable.options(B).onChange(E);}Sortable.options(D.parentNode).onChange(E);}}}},onEmptyHover:function(E,G,H){var I=E.parentNode;var A=Sortable.options(G);if(!Element.isParent(G,E)){var F;var C=Sortable.findElements(G,{tag:A.tag,only:A.only});var B=null;if(C){var D=Element.offsetSize(G,A.overlap)*(1-H);for(F=0;F<C.length;F+=1){if(D-Element.offsetSize(C[F],A.overlap)>=0){D-=Element.offsetSize(C[F],A.overlap);}else{if(D-(Element.offsetSize(C[F],A.overlap)/2)>=0){B=F+1<C.length?C[F+1]:null;break;}else{B=C[F];break;}}}}G.insertBefore(E,B);Sortable.options(I).onChange(E);A.onChange(E);}},unmark:function(){if(Sortable._marker){Sortable._marker.hide();}},mark:function(B,A){var D=Sortable.options(B.parentNode);if(D&&!D.ghosting){return ;}if(!Sortable._marker){Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"});document.getElementsByTagName("body").item(0).appendChild(Sortable._marker);}var C=Position.cumulativeOffset(B);Sortable._marker.setStyle({left:C[0]+"px",top:C[1]+"px"});if(A=="after"){if(D.overlap=="horizontal"){Sortable._marker.setStyle({left:(C[0]+B.clientWidth)+"px"});}else{Sortable._marker.setStyle({top:(C[1]+B.clientHeight)+"px"});}}Sortable._marker.show();},_tree:function(E,B,F){var D=Sortable.findElements(E,B)||[];for(var C=0;C<D.length;++C){var A=D[C].id.match(B.format);if(!A){continue;}var G={id:encodeURIComponent(A?A[1]:null),element:E,parent:F,children:[],position:F.children.length,container:$(D[C]).down(B.treeTag)};if(G.container){this._tree(G.container,B,G);}F.children.push(G);}return F;},tree:function(D){D=$(D);var C=this.options(D);var B=Object.extend({tag:C.tag,treeTag:C.treeTag,only:C.only,name:D.id,format:C.format},arguments[1]||{});var A={id:null,parent:null,children:[],container:D,position:0};return Sortable._tree(D,B,A);},_constructIndex:function(B){var A="";do{if(B.id){A="["+B.position+"]"+A;}}while((B=B.parent)!=null);return A;},sequence:function(B){B=$(B);var A=Object.extend(this.options(B),arguments[1]||{});return $(this.findElements(B,A)||[]).map(function(C){return C.id.match(A.format)?C.id.match(A.format)[1]:"";});},setSequence:function(B,C){B=$(B);var A=Object.extend(this.options(B),arguments[2]||{});var D={};this.findElements(B,A).each(function(E){if(E.id.match(A.format)){D[E.id.match(A.format)[1]]=[E,E.parentNode];}E.parentNode.removeChild(E);});C.each(function(E){var F=D[E];if(F){F[1].appendChild(F[0]);delete D[E];}});},serialize:function(C){C=$(C);var B=Object.extend(Sortable.options(C),arguments[1]||{});var A=encodeURIComponent((arguments[1]&&arguments[1].name)?arguments[1].name:C.id);if(B.tree){return Sortable.tree(C,arguments[1]).children.map(function(D){return[A+Sortable._constructIndex(D)+"[id]="+encodeURIComponent(D.id)].concat(D.children.map(arguments.callee));}).flatten().join("&");}else{return Sortable.sequence(C,arguments[1]).map(function(D){return A+"[]="+encodeURIComponent(D);}).join("&");}}};Element.isParent=function(B,A){if(!B.parentNode||B==A){return false;}if(B.parentNode==A){return true;}return Element.isParent(B.parentNode,A);};Element.findChildren=function(D,B,A,C){if(!D.hasChildNodes()){return null;}C=C.toUpperCase();if(B){B=[B].flatten();}var E=[];$A(D.childNodes).each(function(G){if(G.tagName&&G.tagName.toUpperCase()==C&&(!B||(Element.classNames(G).detect(function(H){return B.include(H);})))){E.push(G);}if(A){var F=Element.findChildren(G,B,A,C);if(F){E.push(F);}}});return(E.length>0?E.flatten():[]);};Element.offsetSize=function(A,B){return A["offset"+((B=="vertical"||B=="height")?"Height":"Width")];};
if(typeof Effect=="undefined"){throw ("controls.js requires including script.aculo.us' effects.js library")}var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(element,update,options){element=$(element);this.element=element;this.update=$(update);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions){this.setOptions(options)}else{this.options=options||{}}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(element,update){if(!update.style.position||update.style.position=="absolute"){update.style.position="absolute";Position.clone(element,update,{setHeight:false,offsetTop:element.offsetHeight})}Effect.Appear(update,{duration:0.15})};this.options.onHide=this.options.onHide||function(element,update){new Effect.Fade(update,{duration:0.15})};if(typeof (this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens)}if(!this.options.tokens.include("\n")){this.options.tokens.push("\n")}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update)}if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix")}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50)}},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update)}if(this.iefix){Element.hide(this.iefix)}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator)}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator)}},onKeyPress:function(event){if(this.active){switch(event.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(event);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(event);return ;case Event.KEY_LEFT:case Event.KEY_RIGHT:return ;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(event);return ;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(event);return }}else{if(event.keyCode==Event.KEY_TAB||event.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&event.keyCode==0)){return }}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(event){var element=Event.findElement(event,"LI");if(this.index!=element.autocompleteIndex){this.index=element.autocompleteIndex;this.render()}Event.stop(event)},onClick:function(event){var element=Event.findElement(event,"LI");this.index=element.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(event){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var i=0;i<this.entryCount;i++){this.index==i?Element.addClassName(this.getEntry(i),"selected"):Element.removeClassName(this.getEntry(i),"selected")}if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.getEntry(this.index).scrollIntoView(true)},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}this.getEntry(this.index).scrollIntoView(false)},getEntry:function(index){return this.update.firstChild.childNodes[index]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},updateElement:function(selectedElement){if(this.options.updateElement){this.options.updateElement(selectedElement);return }var value="";if(this.options.select){var nodes=$(selectedElement).select("."+this.options.select)||[];if(nodes.length>0){value=Element.collectTextNodes(nodes[0],this.options.select)}}else{value=Element.collectTextNodesIgnoreClass(selectedElement,"informal")}var bounds=this.getTokenBounds();if(bounds[0]!=-1){var newValue=this.element.value.substr(0,bounds[0]);var whitespace=this.element.value.substr(bounds[0]).match(/^\s+/);if(whitespace){newValue+=whitespace[0]}this.element.value=newValue+value+this.element.value.substr(bounds[1])}else{this.element.value=value}this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,selectedElement)}},updateChoices:function(choices){if(!this.changed&&this.hasFocus){this.update.innerHTML=choices;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var i=0;i<this.entryCount;i++){var entry=this.getEntry(i);entry.autocompleteIndex=i;this.addObservers(entry)}}else{this.entryCount=0}this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},addObservers:function(element){Event.observe(element,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(element,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices()}else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var bounds=this.getTokenBounds();return this.element.value.substring(bounds[0],bounds[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds){return this.tokenBounds}var value=this.element.value;if(value.strip().empty()){return[-1,0]}var diff=arguments.callee.getFirstDifferencePos(value,this.oldElementValue);var offset=(diff==this.oldElementValue.length?1:0);var prevTokenPos=-1,nextTokenPos=value.length;var tp;for(var index=0,l=this.options.tokens.length;index<l;++index){tp=value.lastIndexOf(this.options.tokens[index],diff+offset-1);if(tp>prevTokenPos){prevTokenPos=tp}tp=value.indexOf(this.options.tokens[index],diff+offset);if(-1!=tp&&tp<nextTokenPos){nextTokenPos=tp}}return(this.tokenBounds=[prevTokenPos+1,nextTokenPos])}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(newS,oldS){var boundary=Math.min(newS.length,oldS.length);for(var index=0;index<boundary;++index){if(newS[index]!=oldS[index]){return index}}return boundary};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(element,update,url,options){this.baseInitialize(element,update,options);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=url},getUpdatedChoices:function(){this.startIndicator();var entry=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,entry):entry;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(request){this.updateChoices(request.responseText)}});Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(element,update,array,options){this.baseInitialize(element,update,options);this.options.array=array},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(options){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(instance){var ret=[];var partial=[];var entry=instance.getToken();var count=0;for(var i=0;i<instance.options.array.length&&ret.length<instance.options.choices;i++){var elem=instance.options.array[i];var foundPos=instance.options.ignoreCase?elem.toLowerCase().indexOf(entry.toLowerCase()):elem.indexOf(entry);while(foundPos!=-1){if(foundPos==0&&elem.length!=entry.length){ret.push("<li><strong>"+elem.substr(0,entry.length)+"</strong>"+elem.substr(entry.length)+"</li>");break}else{if(entry.length>=instance.options.partialChars&&instance.options.partialSearch&&foundPos!=-1){if(instance.options.fullSearch||/\s/.test(elem.substr(foundPos-1,1))){partial.push("<li>"+elem.substr(0,foundPos)+"<strong>"+elem.substr(foundPos,entry.length)+"</strong>"+elem.substr(foundPos+entry.length)+"</li>");break}}}foundPos=instance.options.ignoreCase?elem.toLowerCase().indexOf(entry.toLowerCase(),foundPos+1):elem.indexOf(entry,foundPos+1)}}if(partial.length){ret=ret.concat(partial.slice(0,instance.options.choices-ret.length))}return"<ul>"+ret.join("")+"</ul>"}},options||{})}});Field.scrollFreeActivate=function(field){setTimeout(function(){Field.activate(field)},1)};Ajax.InPlaceEditor=Class.create({initialize:function(element,url,options){this.url=url;this.element=element=$(element);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(options);Object.extend(this.options,options||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId)){this.options.formId=""}}if(this.options.externalControl){this.options.externalControl=$(this.options.externalControl)}if(!this.options.externalControl){this.options.externalControlOnly=false}this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(e){if(!this._editing||e.ctrlKey||e.altKey||e.shiftKey){return }if(Event.KEY_ESC==e.keyCode){this.handleFormCancellation(e)}else{if(Event.KEY_RETURN==e.keyCode){this.handleFormSubmission(e)}}},createControl:function(mode,handler,extraClasses){var control=this.options[mode+"Control"];var text=this.options[mode+"Text"];if("button"==control){var btn=document.createElement("input");btn.type="submit";btn.value=text;btn.className="editor_"+mode+"_button";if("cancel"==mode){btn.onclick=this._boundCancelHandler}this._form.appendChild(btn);this._controls[mode]=btn}else{if("link"==control){var link=document.createElement("a");link.href="#";link.appendChild(document.createTextNode(text));link.onclick="cancel"==mode?this._boundCancelHandler:this._boundSubmitHandler;link.className="editor_"+mode+"_link";if(extraClasses){link.className+=" "+extraClasses}this._form.appendChild(link);this._controls[mode]=link}}},createEditField:function(){var text=(this.options.loadTextURL?this.options.loadingText:this.getText());var fld;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){fld=document.createElement("input");fld.type="text";var size=this.options.size||this.options.cols||0;if(0<size){fld.size=size}}else{fld=document.createElement("textarea");fld.rows=(1>=this.options.rows?this.options.autoRows:this.options.rows);fld.cols=this.options.cols||40}fld.name=this.options.paramName;fld.value=text;fld.className="editor_field";if(this.options.submitOnBlur){fld.onblur=this._boundSubmitHandler}this._controls.editor=fld;if(this.options.loadTextURL){this.loadExternalText()}this._form.appendChild(this._controls.editor)},createForm:function(){var ipe=this;function addText(mode,condition){var text=ipe.options["text"+mode+"Controls"];if(!text||condition===false){return }ipe._form.appendChild(document.createTextNode(text))}this._form=$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if("textarea"==this._controls.editor.tagName.toLowerCase()){this._form.appendChild(document.createElement("br"))}if(this.options.onFormCustomization){this.options.onFormCustomization(this,this._form)}addText("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);addText("Between",this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");addText("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML}this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(e){if(this._saving||this._editing){return }this._editing=true;this.triggerCallback("onEnterEditMode");if(this.options.externalControl){this.options.externalControl.hide()}this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL){this.postProcessEditField()}if(e){Event.stop(e)}},enterHover:function(e){if(this.options.hoverClassName){this.element.addClassName(this.options.hoverClassName)}if(this._saving){return }this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML},handleAJAXFailure:function(transport){this.triggerCallback("onFailure",transport);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(e){this.wrapUp();if(e){Event.stop(e)}},handleFormSubmission:function(e){var form=this._form;var value=$F(this._controls.editor);this.prepareSubmission();var params=this.options.callback(form,value)||"";if(Object.isString(params)){params=params.toQueryParams()}params.editorId=this.element.id;if(this.options.htmlResponse){var options=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(options,{parameters:params,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,options)}else{var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:params,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,options)}if(e){Event.stop(e)}},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl){this.options.externalControl.show()}this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(e){if(this.options.hoverClassName){this.element.removeClassName(this.options.hoverClassName)}if(this._saving){return }this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){this._form.removeClassName(this.options.loadingClassName);var text=transport.responseText;if(this.options.stripLoadedTextTags){text=text.stripTags()}this._controls.editor.value=text;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,options)},postProcessEditField:function(){var fpc=this.options.fieldPostCreation;if(fpc){$(this._controls.editor)["focus"==fpc?"focus":"activate"]()}},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(defs){Object.extend(this.options,defs)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var listener;$H(Ajax.InPlaceEditor.Listeners).each(function(pair){listener=this[pair.value].bind(this);this._listeners[pair.key]=listener;if(!this.options.externalControlOnly){this.element.observe(pair.key,listener)}if(this.options.externalControl){this.options.externalControl.observe(pair.key,listener)}}.bind(this))},removeForm:function(){if(!this._form){return }this._form.remove();this._form=null;this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(cbName,arg){if("function"==typeof this.options[cbName]){this.options[cbName](this,arg)}},unregisterListeners:function(){$H(this._listeners).each(function(pair){if(!this.options.externalControlOnly){this.element.stopObserving(pair.key,pair.value)}if(this.options.externalControl){this.options.externalControl.stopObserving(pair.key,pair.value)}}.bind(this))},wrapUp:function(transport){this.leaveEditMode();this._boundComplete(transport,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,element,url,options){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(element,url,options)},createEditField:function(){var list=document.createElement("select");list.name=this.options.paramName;list.size=1;this._controls.editor=list;this._collection=this.options.collection||[];if(this.options.loadCollectionURL){this.loadCollection()}else{this.checkForExternalText()}this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js)){throw"Server returned an invalid collection representation."}this._collection=eval(js);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(text){this._controls.editor.disabled=true;var tempOption=this._controls.editor.firstChild;if(!tempOption){tempOption=document.createElement("option");tempOption.value="";this._controls.editor.appendChild(tempOption);tempOption.selected=true}tempOption.update((text||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();if(this.options.loadTextURL){this.loadExternalText()}else{this.buildOptionList()}},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){this._text=transport.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,options)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(entry){return 2===entry.length?entry:[entry,entry].flatten()});var marker=("value" in this.options)?this.options.value:this._text;var textFound=this._collection.any(function(entry){return entry[0]==marker}.bind(this));this._controls.editor.update("");var option;this._collection.each(function(entry,index){option=document.createElement("option");option.value=entry[0];option.selected=textFound?entry[0]==marker:0==index;option.appendChild(document.createTextNode(entry[1]));this._controls.editor.appendChild(option)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(options){if(!options){return }function fallback(name,expr){if(name in options||expr===undefined){return }options[name]=expr}fallback("cancelControl",(options.cancelLink?"link":(options.cancelButton?"button":options.cancelLink==options.cancelButton==false?false:undefined)));fallback("okControl",(options.okLink?"link":(options.okButton?"button":options.okLink==options.okButton==false?false:undefined)));fallback("highlightColor",options.highlightcolor);fallback("highlightEndColor",options.highlightendcolor)};Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(form){return Form.serialize(form)},onComplete:function(transport,element){new Effect.Highlight(element,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(ipe){ipe.element.style.backgroundColor=ipe.options.highlightColor;if(ipe._effect){ipe._effect.cancel()}},onFailure:function(transport,ipe){alert("Error communication with the server: "+transport.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(ipe){ipe._effect=new Effect.Highlight(ipe.element,{startcolor:ipe.options.highlightColor,endcolor:ipe.options.highlightEndColor,restorecolor:ipe._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};Form.Element.DelayedObserver=Class.create({initialize:function(element,delay,callback){this.delay=delay||0.5;this.element=$(element);this.callback=callback;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(event){if(this.lastValue==$F(this.element)){return }if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element))}});
if(!Control){var Control={};}Control.Slider=Class.create({initialize:function(D,A,B){var C=this;if(Object.isArray(D)){this.handles=D.collect(function(E){return $(E);});}else{this.handles=[$(D)];}this.track=$(A);this.options=B||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0;});this.spans=this.options.spans?this.options.spans.map(function(E){return $(E);}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled();}this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max();}this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(F,E){E=C.handles.length-1-E;C.setValue(parseFloat((Object.isArray(C.options.sliderValue)?C.options.sliderValue[E]:C.options.sliderValue)||C.range.start),E);F.makePositioned().observe("mousedown",C.eventMouseDown);});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=true;},dispose:function(){var A=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(B){Event.stopObserving(B,"mousedown",A.eventMouseDown);});},setDisabled:function(){this.disabled=true;},setEnabled:function(){this.disabled=false;},getNearestValue:function(A){if(this.allowedValues){if(A>=this.allowedValues.max()){return(this.allowedValues.max());}if(A<=this.allowedValues.min()){return(this.allowedValues.min());}var C=Math.abs(this.allowedValues[0]-A);var B=this.allowedValues[0];this.allowedValues.each(function(D){var E=Math.abs(D-A);if(E<=C){B=D;C=E;}});return B;}if(A>this.range.end){return this.range.end;}if(A<this.range.start){return this.range.start;}return A;},setValue:function(B,A){if(!this.active){this.activeHandleIdx=A||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles();}A=A||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((A>0)&&(B<this.values[A-1])){B=this.values[A-1];}if((A<(this.handles.length-1))&&(B>this.values[A+1])){B=this.values[A+1];}}B=this.getNearestValue(B);this.values[A]=B;this.value=this.values[0];this.handles[A].style[this.isVertical()?"top":"left"]=this.translateToPx(B);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished();}},setValueBy:function(B,A){this.setValue(this.values[A||this.activeHandleIdx||0]+B,A||this.activeHandleIdx||0);},translateToPx:function(A){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(A-this.range.start))+"px";},translateToValue:function(A){return((A/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start);},getRange:function(B){var A=this.values.sortBy(Prototype.K);B=B||0;return $R(A[B],A[B+1]);},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX);},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX);},isVertical:function(){return(this.axis=="vertical");},drawSpans:function(){var A=this;if(this.spans){$R(0,this.spans.length-1).each(function(B){A.setSpan(A.spans[B],A.getRange(B));});}if(this.options.startSpan){this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value));}if(this.options.endSpan){this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum));}},setSpan:function(B,A){if(this.isVertical()){B.style.top=this.translateToPx(A.start);B.style.height=this.translateToPx(A.end-A.start+this.range.start);}else{B.style.left=this.translateToPx(A.start);B.style.width=this.translateToPx(A.end-A.start+this.range.start);}},updateStyles:function(){this.handles.each(function(A){Element.removeClassName(A,"selected");});Element.addClassName(this.activeHandle,"selected");},startDrag:function(C){if(Event.isLeftClick(C)){if(!this.disabled){this.active=true;var D=Event.element(C);var E=[Event.pointerX(C),Event.pointerY(C)];var A=D;if(A==this.track){var B=Position.cumulativeOffset(this.track);this.event=C;this.setValue(this.translateToValue((this.isVertical()?E[1]-B[1]:E[0]-B[0])-(this.handleLength/2)));var B=Position.cumulativeOffset(this.activeHandle);this.offsetX=(E[0]-B[0]);this.offsetY=(E[1]-B[1]);}else{while((this.handles.indexOf(D)==-1)&&D.parentNode){D=D.parentNode;}if(this.handles.indexOf(D)!=-1){this.activeHandle=D;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var B=Position.cumulativeOffset(this.activeHandle);this.offsetX=(E[0]-B[0]);this.offsetY=(E[1]-B[1]);}}}Event.stop(C);}},update:function(A){if(this.active){if(!this.dragging){this.dragging=true;}this.draw(A);if(Prototype.Browser.WebKit){window.scrollBy(0,0);}Event.stop(A);}},draw:function(B){var C=[Event.pointerX(B),Event.pointerY(B)];var A=Position.cumulativeOffset(this.track);C[0]-=this.offsetX+A[0];C[1]-=this.offsetY+A[1];this.event=B;this.setValue(this.translateToValue(this.isVertical()?C[1]:C[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this);}},endDrag:function(A){if(this.active&&this.dragging){this.finishDrag(A,true);Event.stop(A);}this.active=false;this.dragging=false;},finishDrag:function(A,B){this.active=false;this.dragging=false;this.updateFinished();},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this);}this.event=null;}});
Sound={tracks:{},_enabled:true,template:new Template('<embed style="height:0" id="sound_#{track}_#{id}" src="#{url}" loop="false" autostart="true" hidden="true"/>'),enable:function(){Sound._enabled=true;},disable:function(){Sound._enabled=false;},play:function(B){if(!Sound._enabled){return ;}var A=Object.extend({track:"global",url:B,replace:false},arguments[1]||{});if(A.replace&&this.tracks[A.track]){$R(0,this.tracks[A.track].id).each(function(D){var C=$("sound_"+A.track+"_"+D);C.Stop&&C.Stop();C.remove();});this.tracks[A.track]=null;}if(!this.tracks[A.track]){this.tracks[A.track]={id:0};}else{this.tracks[A.track].id++;}A.id=this.tracks[A.track].id;$$("body")[0].insert(Prototype.Browser.IE?new Element("bgsound",{id:"sound_"+A.track+"_"+A.id,src:A.url,loop:1,autostart:true}):Sound.template.evaluate(A));}};if(Prototype.Browser.Gecko&&navigator.userAgent.indexOf("Win")>0){if(navigator.plugins&&$A(navigator.plugins).detect(function(A){return A.name.indexOf("QuickTime")!=-1;})){Sound.template=new Template('<object id="sound_#{track}_#{id}" width="0" height="0" type="audio/mpeg" data="#{url}"/>');}else{Sound.play=function(){};}}
Ice.DnD=Class.create();var IceLoaded=false;Ice.DnD.logger=Class.create();Ice.DnD.logger={debug:function(){},warn:function(){},error:function(){}};Ice.DnD={log:function(A){Ice.DnD.logger.debug(A);},DRAG_START:1,DRAG_CANCEL:2,DROPPED:3,HOVER_START:4,HOVER_END:5,init:function(){Ice.DnD.logger=window.logger.child("dragDrop");Ice.StateMon.logger=window.logger.child("stateMon");Ice.StateMon.destroyAll();IceLoaded=true;},elementReplaced:function(B){var A=$(B.id);return A!=null&&A!=B;},check:function(){Ice.StateMon.checkAll();},alreadyDrag:function(B){B=$(B);var A=false;$A(Draggables.drags).each(function(C){if(C.element&&C.element.id==B.id){A=true;}});return A;},sortableDraggable:function(B){B=$(B);var A=false;$A(Draggables.drags).each(function(C){if(C.element&&C.element.id==B.id){if(C.options.sort){A=true;}}});return A;},alreadyDrop:function(B){B=$(B);var A=false;$(Droppables.drops).each(function(C){if(C&&C.element.id==B.id){A=true;}});return A;},alreadySort:function(B){var A=Sortable.options(B);if(A){return true;}return false;}};Ice.PanelCollapsible={fire:function(A,E,B,G){var F=document.getElementById(A);var D=document.getElementById(E);try{if(Element.visible(F)){D.className=Ice.PanelCollapsible.getStyleClass(B,G,"ColpsdHdr");Ice.PanelCollapsible.collapse(A);}else{D.className=Ice.PanelCollapsible.getStyleClass(B,G,"Hdr");Ice.PanelCollapsible.expand(A);}}catch(C){console.log("Error in panel collapsible ["+C+"]");}},expand:function(A){var B=document.getElementById(A);if(!Element.visible(B)){Effect.SlideDown(A,{uploadCSS:true,submit:true,duration:0.5});}},collapse:function(A){var B=document.getElementById(A);if(Element.visible(B)){Effect.SlideUp(A,{uploadCSS:true,submit:true,duration:0.5});}},getStyleClass:function(A,C,D){var B=A+D;if(C!=null){B+=" "+C+D;}return B;}};Ice.tableRowClicked=function(A,B,C,M,K,G){var E=document.getElementsByName(K+"ctrKy");var I=document.getElementsByName(K+"sftKy");if(E.length>0){E=E[0];}else{E=null;}if(I.length>0){I=I[0];}else{I=null;}if(E&&A){E.value=A.ctrlKey||A.metaKey;}if(I&&A){I.value=A.shiftKey;}try{if(B){var J;if(!A){var A=window.event;}if(A.target){J=A.target;}else{if(A.srcElement){J=A.srcElement;}}if(J.nodeType==3){J=J.parentNode;}while(true){var O=J.tagName.toLowerCase();if(O=="tr"){break;}if(O=="input"||O=="select"||O=="option"||O=="a"||O=="textarea"){return ;}if(J.parentNode){J=J.parentNode;}else{break;}}}var L=Event.extend(A);var N=L.element();if(N.tagName.toLowerCase()!="tr"){N=L.element().up("tr[onclick*='Ice.tableRowClicked']");}if(N){if(G){N.className=G;N.onmouseover=Prototype.emptyFunction;N.onmouseout=Prototype.emptyFunction;}}var F=document.forms[M][K];F.value=C;var D=new Object();iceSubmitPartial(null,F,D);setFocus("");}catch(H){console.log("Error in rowSelector["+H+"]");}};Ice.clickEvents={};Ice.registerClick=function(F,A,E,D,J,G,K,B,C,I,H){if(!Ice.clickEvents[F.id]){Ice.clickEvents[F.id]=new Ice.clickEvent(F,A,E,D,J,G,K,B,C,I,H);}};Ice.registerDblClick=function(A){if(document.selection){document.selection.empty();}if(Ice.clickEvents[A.id]){Ice.clickEvents[A.id].submit(2);}};Ice.clickEvent=Class.create({initialize:function(F,A,E,D,J,G,K,B,C,I,H){this.elem=F;this.hdnClkRow=A;this.hdnClkCount=E;this.rowid=D;this.formId=J;if(G<0){this.delay=0;}else{if(G>1000){this.delay=1000;}else{this.delay=G;}}this.toggleOnClick=K;if(this.toggleOnClick){this.event=Object.clone(B);this.useEvent=C;this.hdnFld=I;this.toggleClassNames=H;}this.timer=setTimeout(this.submit.bind(this,1),this.delay);},submit:function(B){clearTimeout(this.timer);Ice.clickEvents[this.elem.id]=null;var A=document.forms[this.formId][this.hdnClkRow];A.value=this.rowid;var D=document.forms[this.formId][this.hdnClkCount];D.value=B;if(this.toggleOnClick){Ice.tableRowClicked(this.event,this.useEvent,this.rowid,this.formId,this.hdnFld,this.toggleClassNames);}else{var C=new Object();iceSubmitPartial(null,A,C);}}});Ice.preventTextSelection=function(A){if(Ice.isEventSourceInputElement(A)){return true;}else{Ice.disableTxtSelection(document.body);return false;}};Ice.disableTxtSelection=function(A){A.onselectstart=function(){return false;};A.onmousedown=function(B){return false;};};Ice.enableTxtSelection=function(A){A.onselectstart=function(){return true;};A.onmousedown=function(B){return true;};};Ice.txtAreaMaxLen=function(B,A){if(A>=0&&B.value.length>A){B.value=B.value.substring(0,A);}};Ice.isEventSourceInputElement=function(D){var B=D||window.event;var B=Event.extend(B);var C=B.element();var A=C.tagName.toLowerCase();if(A=="input"||A=="select"||A=="option"||A=="a"||A=="textarea"){return true;}else{return false;}};Ice.tabNavigator=function(D){var E=Event.element(D);var B=D.keyCode;switch(B){case 37:case 38:var A=E.up(".icePnlTb").previousSibling;if(A){var F=A.down(".icePnlTbLblLnk");if(F){F.focus();}}if(E.up(".icePnlTb")){if(D.preventDefault){D.preventDefault();}else{if(D.returnValue){D.returnValue=false;}}}break;case 39:case 40:var C=E.up(".icePnlTb").nextSibling;if(C&&Element.hasClassName(C,"icePnlTb")){var F=C.down(".icePnlTbLblLnk");if(F){F.focus();}}if(E.up(".icePnlTb")){if(D.preventDefault){D.preventDefault();}else{if(D.returnValue){D.returnValue=false;}}}break;}};Ice.pnlTabOnFocus=function(B,C,A){setFocus(B.id);if(A){Event.observe(B,"keydown",Ice.tabNavigator);}if(!C){return ;}Ice.simulateFocus(B.parentNode,B);};Ice.pnlTabOnBlur=function(B,C,A){if(A){Event.stopObserving(B,"keydown",Ice.tabNavigator);}if(!C){return ;}setFocus("");Ice.simulateBlur(B.parentNode,B);};Ice.pnlClpFocus=function(B){var A=B.parentNode;Ice.simulateFocus(A,B);A.style.padding="0px";};Ice.pnlClpBlur=function(B){var A=B.parentNode;Ice.simulateBlur(A,B);A.style.padding="1px";};Ice.simulateFocus=function(B,A){if(!document.all){A.style.visibility="hidden";}A.style.borderStyle="none";A.style.outlineStyle="none";A.style.borderWidth="0px";A.style.outlineWidth="0px";A.style.margin="0px";B._borderStyle=B.style.borderStyle;B.style.borderStyle="dotted";B._borderWidth=B.style.borderWidth;B.style.borderWidth="1px 1px 1px 1px";B._borderColor=B.style.borderColor;B.style.borderColor="black";};Ice.simulateBlur=function(B,A){if(!document.all){A.style.visibility="visible";}B.style.borderStyle=B._borderStyle;B.style.borderWidth=B._borderWidth;B.style.borderColor=B._borderColor;};Ice.DataExporterOpenWindow=function(A,G,B,C){var F=window.open(G);if(!F||typeof (F)=="undefined"){var E=$(A+"container").firstChild;var D=C=="null"?B:C;E.onclick=function(){window.open(G);};if(E.tagName=="INPUT"){E.value=D;}else{if(E.firstChild.tagName=="IMG"){E.firstChild.title=D;}else{E.innerHTML=D;}}}new Effect.Highlight(A+"container",{startcolor:"#fda505",endcolor:"#ffffff"});};
Ice.util=Class.create();Ice.util={findForm:function(A){var B=A.nodeName.toLowerCase();if(B=="form"){return A;}return this.findForm(A.parentNode);},adjustMyPosition:function(D,J){var E=$(D).getHeight();var F=Element.cumulativeOffset($(D)).top;var H=document.viewport.getScrollOffsets().top+document.viewport.getHeight();var I=Element.cumulativeOffset($(J)).top;var G=F-I;var A=F+$(D).getHeight();var B=E+G;if(H<A&&B<H&&E<I){$(D).parentNode.style.position="absolute";$(D).parentNode.style.top="-"+B+"px";var C=$(D).up().next("iframe");if(C){C.clonePosition(D);}}},radioCheckboxEnter:function(C,B,A){if(A.keyCode==Event.KEY_RETURN){iceSubmit(C,B,A);}}};var IE=(Try.these(function(){new ActiveXObject("Msxml2.XMLHTTP");return true;},function(){new ActiveXObject("Microsoft.XMLHTTP");return true;})||false);
Ice.StateMon=Class.create();Ice.StateMon={logger:null,monitors:Array(),add:function(A){this.logger.debug("Added monitor for ["+A.id+"] type ["+A.type+"]");this.monitors.push(A);},checkAll:function(){var D=0;var A=null;var C=this.monitors.length;for(D=0;D<C;D++){A=this.monitors[D];try{if(A.changeDetected()){this.logger.debug("Monitor ["+A.id+"] has been replaced");A.rebuildMe=true;}else{this.logger.debug("Monitor ["+A.id+"] has not been replaced");A.rebuildMe=false;}if(!this.elementExists(A.id)){this.logger.debug("Monitor ["+A.id+"] no longer exists in dom");A.destroyMe=true;}}catch(B){this.logger.error("Error checking monitor ["+A.id+"] Msg ["+B+"]");}}this.destroy();this.rebuild();},removeMonitors:function(B){var A=Array();var C=0;for(C=0;C<this.monitors.length;C++){if(!this.monitors[C].removeMe){A.push(this.monitors[C]);}}this.monitors=A;},destroy:function(){var D=0;var A=null;var E=Array();for(D=0;D<this.monitors.length;D++){A=this.monitors[D];try{if(!A.destroyMe){E.push(A);}else{try{this.logger.debug("Destroyed monitor ["+A.id+"]");A.destroy();}catch(C){this.logger.warn("Monitor ["+A.id+"] destroyed with exception ["+C+"]");}A=null;}}catch(B){this.logger.error("Error destroying monitor ["+A.id+"] Msg ["+B+"]");}}this.monitors=E;},destroyAll:function(){var C=0;var A=null;var D=Array();for(C=0;C<this.monitors.length;C++){A=this.monitors[C];try{if(A!=null){this.logger.debug("Destroyed monitor ["+A.id+"]");A.destroy();}}catch(B){this.logger.warn("Monitor ["+A.id+"] destroyed with exception ["+B+"]");}A=null;}this.monitors=Array();},rebuild:function(){var B=this.monitors.length;try{for(i=0;i<B;i++){monitor=this.monitors[i];if(monitor.rebuildMe){this.logger.debug("Rebuilding ["+monitor.id+"]");try{monitor.destroy();}catch(C){this.logger.warn("Could not destroy monitor before rebuilding ID["+monitor.id+"] msg ["+C+"]");}monitor.rebuild();monitor.rebuildMe=false;monitor.removeMe=true;}else{this.logger.debug("Not rebuilding ["+monitor.id+"] type ["+monitor.type+"]");}}this.removeMonitors();}catch(A){this.logger.error("Error rebuilding monitors ["+A+"]");}},elementExists:function(B){var A=$(B);if(!A){return false;}return true;},elementReplaced:function(B){if(B&&!B.id){return false;}var A=$(B.id);if(!A){this.logger.debug("Element not found id["+B.id+"] element["+B+"] type ["+B.nodeName+"]");}if(A!=null&&A!=B){this.logger.debug("Element replaced");return true;}}};Ice.MonitorBase=Class.create();Ice.MonitorBase.prototype={object:null,id:null,htmlElement:null,rebuildMe:false,rebuild:function(){},createOptions:null,options:null,destroyMe:false,destroy:function(){},type:"Base",initialize:function(){},changeDetected:function(){return Ice.StateMon.elementReplaced(this.htmlElement);},removeMe:false};Ice.SortableMonitor=Class.create();Ice.SortableMonitor.prototype=Object.extend(new Ice.MonitorBase(),{initialize:function(B,A){this.type="Sortable";this.object=null;this.id=B.id;this.htmlElement=B;this.createOptions=A;},destroy:function(){Sortable.destroy(this.htmlElement);},rebuild:function(){Ice.StateMon.logger.debug("Rebuilding Sortable ID["+this.id+"] Options["+this.createOptions+"]");Sortable.create(this.id,this.createOptions);},changeDetected:function(){return true;}});Ice.DraggableMonitor=Class.create();Ice.DraggableMonitor.prototype=Object.extend(new Ice.MonitorBase(),{initialize:function(B,A){this.type="Draggable";this.object=null;this.id=B.id;this.htmlElement=B;this.createOptions=A;},destroy:function(){this.object.destroy();Ice.StateMon.logger.debug("Destroyed Draggable ["+this.id+"]");$A(Draggables.drags).each(function(A){Ice.StateMon.logger.debug("Draggable ["+A.element.id+"] not destroyed");});},rebuild:function(){Ice.StateMon.logger.debug("Rebuilding Draggable ID["+this.id+"] Options["+this.createOptions+"]");var A=new Draggable(this.id,this.createOptions);Ice.StateMon.logger.debug("Rebuilding Draggable ID["+this.id+"] Options["+this.createOptions+"] Complete");}});Ice.DroppableMonitor=Class.create();Ice.DroppableMonitor.prototype=Object.extend(new Ice.MonitorBase,{initialize:function(B,A){this.type="Droppable";this.object=null;this.id=B.id;this.htmlElement=B;this.createOptions=A;},destroy:function(){Droppables.remove(this.htmlElement);},rebuild:function(){Ice.StateMon.logger.debug("Rebuilding Droppables ID["+this.id+"] Options["+this.createOptions+"]");Droppables.add(this.id,this.createOptions);}});Ice.AutocompleterMonitor=Class.create();Ice.AutocompleterMonitor.prototype=Object.extend(new Ice.MonitorBase,{initialize:function(D,E,C,A,B){this.type="Autocompleter";this.object=null;this.id=D.id;this.htmlElement=D;this.createOptions=C;this.update=E;this.rowClass=A;this.selectedRowClass=B;},destroy:function(){this.object.dispose();},rebuild:function(){Ice.StateMon.logger.debug("Rebuilding Autocompleter ID["+this.id+"] Options["+this.createOptions+"]");return new Ice.Autocompleter(this.id,this.update.id,this.createOptions,this.rowClass,this.selectedRowClass);}});
Ice.DnD.StyleReader=Class.create();Ice.DnD.StyleReader={styles:"position,top,left,display",buildStyle:function(B){var A="";Ice.DnD.StyleReader.styles.split(",").each(function(C){A+=C+":"+Ice.DnD.StyleReader.getStyle(B,C)+";";});return A;},getStyle:function(B,A){if(B.currentStyle){var C=B.currentStyle[A];}else{if(window.getComputedStyle){var C=document.defaultView.getComputedStyle(B,null).getPropertyValue(A);}else{var C=B.style[A];}}return C;},findCssField:function(E,D){if(!D){D=Ice.util.findForm(E);}var B=D.getElementsByTagName("input");var A=null;var C=0;for(C=0;C<B.length;C++){if(B[C].type=="hidden"&&B[C].name=="icefacesCssUpdates"){A=B[C];break;}}return A;},upload:function(E,D){var A=Ice.DnD.StyleReader.findCssField(E);if(A){var F=A.value;var B=Ice.DnD.StyleReader.buildStyle(E);Ice.DnD.logger.debug("Update CSS ID["+E.id+"] CSS["+B+"] form filed name = ["+A.name+"]");A.value=F+E.id+"{"+B+"}";if(D){var C=Ice.util.findForm(E);iceSubmitPartial(C,E,null);}}}};Ice.modal=Class.create();Ice.modal={running:false,target:null,ids:[],tabindexValues:[],zIndexCount:25000,start:function(F,C,B,H){var E=document.getElementById(F);E.style.visibility="hidden";E.style.position="absolute";var D=document.getElementById("iceModalFrame"+F);if(!D){D=document.createElement("iframe");D.title="Ice Modal Frame";D.frameborder="0";D.id="iceModalFrame"+F;D.src=C;D.style.zIndex=Ice.modal.zIndexCount;Ice.modal.zIndexCount+=3;D.style.opacity=0.5;D.style.filter="alpha(opacity=50)";D.style.position="absolute";D.style.visibility="hidden";D.style.backgroundColor="black";D.style.borderWidth="0";D.style.top="0";D.style.left="0";E.parentNode.insertBefore(D,E);var G=document.createElement("div");G.style.position="absolute";G.style.zIndex=parseInt(D.style.zIndex)+1;G.style.backgroundColor="transparent";E.parentNode.insertBefore(G,E);var A=function(){var J=document.getElementById("iceModalFrame"+F);if(J){var K=J.style.display;J.style.display="none";var Q=document.documentElement.scrollWidth;var P=document.body.scrollWidth;var T=document.documentElement.scrollHeight;var S=document.body.scrollHeight;var I=(P>Q?P:Q);var R=(S>T?S:T);var M=document.viewport.getHeight();if(R<M){R=M;}J.style.width=I+"px";J.style.height=R+"px";J.style.visibility="visible";var N=100;var L=100;try{N=Element.getWidth(E);L=Element.getHeight(E);}catch(O){}N=parseInt(N)/2;L=parseInt(L)/2;if(!H){E.style.top=(parseInt(R)/2)-L+"px";E.style.left=(parseInt(I)/2)-N+"px";}J.style.display=K;$(J.nextSibling).clonePosition(J);}};A();window.onResize(A);window.onScroll(A);}var E=document.getElementById(F);E.style.zIndex=parseInt(D.style.zIndex)+2;Ice.modal.target=E;Ice.modal.ids.push(F);if(!Ice.modal.running){Ice.modal.disableTabindex();}Ice.modal.running=true;E.style.visibility="visible";if(B){Ice.modal.trigger=B;$(B).blur();setFocus("");}},stop:function(B){if(Ice.modal.ids.last()==B){var A=document.getElementById("iceModalFrame"+B);if(A){A.parentNode.removeChild(A.nextSibling);A.parentNode.removeChild(A);logger.debug("removed modal iframe for : "+B);}Ice.modal.ids.pop();Ice.modal.zIndexCount-=3;Ice.modal.running=false;if(Ice.modal.trigger){Ice.Focus.setFocus(Ice.modal.trigger);Ice.modal.trigger="";}Ice.modal.restoreTabindex();}},disableTabindex:function(){var F={};F.a=document.getElementsByTagName("a");F.area=document.getElementsByTagName("area");F.button=document.getElementsByTagName("button");F.input=document.getElementsByTagName("input");F.object=document.getElementsByTagName("object");F.select=document.getElementsByTagName("select");F.textarea=document.getElementsByTagName("textarea");var A=[];for(listName in F){var D=F[listName];for(var B=0;B<D.length;B++){var C=D[B];if(!Ice.modal.containedInId(C,Ice.modal.ids.last())){var E={};E.element=C;E.tabIndex=C.tabIndex?C.tabIndex:"";C.tabIndex="-1";A.push(E);}}}Ice.modal.tabindexValues=A;},restoreTabindex:function(){Ice.modal.tabindexValues.each(function(A){A.element.tabIndex=A.tabIndex;});Ice.modal.tabindexValues=[];},containedInId:function(B,C){if(B.id==C){return true;}var A=B.parentNode;if(A){return Ice.modal.containedInId(A,C);}return false;}};Ice.autoCentre=Class.create();Ice.autoCentre={ids:[],centerAll:function(){Ice.autoCentre.ids.each(Ice.autoCentre.keepCentred);},keepCentred:function(F){var C=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft;var B=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop;var E=document.getElementById(F);if(E){var A=Math.round((Element.getWidth(document.body)-Element.getWidth(E))/2+C);if(A<0){A=0;}var D=Math.round(((window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)-Element.getHeight(E))/2+B);if(D<0){D=0;}A=A+"px";D=D+"px";Element.setStyle(E,{position:"absolute"});Element.setStyle(E,{left:A});Element.setStyle(E,{top:D});}},start:function(A){Ice.autoCentre.keepCentred(A);if(Ice.autoCentre.ids.size()==0){Event.observe(window,"resize",Ice.autoCentre.centerAll);Event.observe(window,"scroll",Ice.autoCentre.centerAll);}if(Ice.autoCentre.ids.indexOf(A)<0){Ice.autoCentre.ids.push(A);}},stop:function(A){Ice.autoCentre.ids=Ice.autoCentre.ids.without(A);if(Ice.autoCentre.ids.size()==0){Event.stopObserving(window,"resize",Ice.autoCentre.centerAll);Event.stopObserving(window,"scroll",Ice.autoCentre.centerAll);}}};Ice.autoPosition=Class.create();Ice.autoPosition={id:null,xPos:null,yPos:null,keepPositioned:function(){var C=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft;var B=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop;var E=document.getElementById(Ice.autoPosition.id);if(E){var A=Math.round(Ice.autoPosition.xPos+C)+"px";var D=Math.round(Ice.autoPosition.yPos+B)+"px";Element.setStyle(E,{position:"absolute"});Element.setStyle(E,{left:A});Element.setStyle(E,{top:D});}},start:function(C,A,D){Ice.autoPosition.id=C;Ice.autoPosition.xPos=A;Ice.autoPosition.yPos=D;var B=document.getElementById(C).style;if(!Prototype.Browser.IE){B.visibility="hidden";}Ice.autoPosition.keepPositioned();if(!Prototype.Browser.IE){B.visibility="visible";}Event.observe(window,"scroll",Ice.autoPosition.keepPositioned);},stop:function(A){if(Ice.autoPosition.id==A){Event.stopObserving(window,"scroll",Ice.autoPosition.keepPositioned);}}};Ice.iFrameFix=Class.create();Ice.iFrameFix={start:function(B,D){var C=navigator.userAgent.indexOf("MSIE");if(C==-1){return ;}var A=parseFloat(navigator.userAgent.substring(C+5));if(A>=7){return ;}var E=document.getElementById(B);if(!E){return ;}var F=document.getElementById(B+":iframe");if(!F){F=document.createElement("iframe");F.src=D;F.setAttribute("id",B+":iframe");E.appendChild(F);}F.style.position="absolute";F.style.zIndex=-1;F.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=0)";F.style.left="0px";F.style.top="0px";F.style.width=E.offsetWidth+"px";F.style.height=E.offsetHeight+"px";}};Ice.DnD.adjustPosition=function(H){var C=$(H);var F=document.viewport.getDimensions();var B=C.getDimensions();var A=C.viewportOffset();var E=C.positionedOffset();var D=F.width-A.left-B.width;var G=F.height-A.top-B.height;if(A.left<0){C.style.left=E.left-A.left+"px";}else{if(D<0){C.style.left=E.left+D+"px";}}if(A.top<0){C.style.top=E.top-A.top+"px";}else{if(G<0){C.style.top=E.top+G+"px";}}};
Ice.Initializer=Class.create();Ice.Initializer={queuedCalls:new Array(),ranCalls:new Array(),loaded:false,addCall:function(id,call){if(Ice.Initializer.loaded){Ice.DnD.logger.debug("Call Ran");eval(call);}else{rapper=new Object();rapper.call=call;rapper.id=id;Ice.Initializer.queuedCalls[Ice.Initializer.queuedCalls.length]=rapper;Ice.DnD.logger.debug("Call Queued");}},runQueuedCalls:function(){Ice.Initializer.loaded=true;ar=Ice.Initializer.queuedCalls;var i=0;for(i=0;i<ar.length;i++){eval(ar[i].call);Ice.Initializer.ranCalls[ar[i].id]=true;}Ice.DnD.logger.debug("Run Queued Calls");}};
Ice.delimitedProperties=Class.create({initialize:function(){this.props={};},set:function(A,B){this.props[A]=B;},get:function(A){this.props[A];},deleteAll:function(){for(p in this.props){delete this.props[p];}},getPropsAsString:function(){var A="";for(p in this.props){A+=p+"!"+this.props[p]+",";}return A;},getPropsAsObject:function(){return this.props;}});
var DropRegions={init:false,SCALE:10,map:[],register:function(A){var B=A.element;var J=Position.cumulativeOffset(B);var C=[J[0]+B.offsetWidth,J[1]+B.offsetHeight];var H=Math.round(J[0]/this.SCALE);var G=Math.round(J[1]/this.SCALE);var I=Math.round(C[0]/this.SCALE)+1;var F=Math.round(C[1]/this.SCALE)+1;var E=0;var D=0;for(E=H;E<I;E++){for(D=G;D<F;D++){if(this.map[E]==null){this.map[E]=[];}if(this.map[E][D]==null){this.map[E][D]=[];}this.map[E][D].push(A);}}},drops:function(B){var A=Math.round(B[0]/DropRegions.SCALE);var C=Math.round(B[1]/DropRegions.SCALE);if(this.map[A]==null){return[];}if(this.map[A][C]==null){return[];}return this.map[A][C];}};Ice.DndEvent=Class.create();Ice.DndEvent.lastEvent=null;Ice.DndEvent.prototype={drag:null,drop:null,eventType:null,dragFire:null,dropFire:null,submitInfo:new Ice.delimitedProperties(),initialize:function(){},submit:function(){var J=this.drag.element;var F=document.getElementById("iceModalFrame"+J.id);if(F){J.style.zIndex=parseInt(F.style.zIndex)+2;}if(this.drag.options.sort==true){return ;}thisEv=J.id+"-"+this.eventType;try{Ice.DndEvent.lastEvent=thisEv;ignoreDrag=this.ignoreEvent(this.drag.options.mask);if(ignoreDrag){Ice.DnD.logger.debug("Drag Type ["+this.eventType+"] Ignored. Mask ["+this.drag.options.mask+"]");}ignoreDrop=true;if(this.drop){ignoreDrop=this.ignoreEvent(this.drop.mask);}if(this.drop){Ice.DnD.logger.debug("Drop Mask ["+this.drop.mask+"] Ignored ["+ignoreDrop+"]");}if(ignoreDrag&&ignoreDrop){return ;}if(this.drop&&ignoreDrop){Ice.DnD.logger.debug("Drop Type ["+this.eventType+"] Ignored. Mask ["+this.drop.mask+"]");}var A=false;if(this.drag.options.revert==true){A=true;}if(this.drag.options.dragGhost==true){A=true;}if(this.eventType==4||this.eventType==5||this.eventType==1){A=true;}Ice.DnD.logger.debug("DnD Event ["+this.eventType+"] ignoreCss["+A+"] value ["+Ice.DnD.StyleReader.buildStyle(J)+"]");if(!ignoreDrag){Ice.DnD.logger.debug("Drag CSS");this.populateDrag(J,A);if(this.drag.dragGhost==true){this.populateDrag(this.drag._original,A);}}if(!ignoreDrop){Ice.DnD.logger.debug("Drop CSS");this.populateDrop(this.drop.element,A);}var G=$(J.id+"clientOnly");if((!ignoreDrag||!ignoreDrop)&&!G){Ice.DnD.logger.debug("DnD Event ["+this.eventType+"] Sent");var C=Ice.util.findForm(J);var H=C.id;var D=new Object();var B=Ice.DnD.StyleReader.findCssField(J,C);Ice.DnD.logger.debug("Submitting  drag form ID["+C.id+"] CssUpdate ["+B.value+"]!");this.serializeSubmitInfo(C);try{iceSubmitPartial(C,J,D);}catch(E){Ice.DnD.logger.error("error submitting dnd event",E);}Ice.DnD.logger.debug("drag form ID["+C.id+"] submitted");if(!ignoreDrop){C=Ice.util.findForm(this.drop.element);if(C.id!=H){Ice.DnD.logger.debug("Diff ["+C.id+"]!=["+H+"] Submitting");iceSubmitPartial(C,this.drop.element,D);}}this.resetSubmitInfo(C);}}catch(I){Ice.DnD.logger.error("Could not find form in drag drop",I);}return ;},populateDrag:function(B,A){this.submitInfo.set(B.id+"status",this.eventType);if(this.drop){this.submitInfo.set(B.id+"dropID",this.drop.element.id);}if(!A){Ice.DnD.StyleReader.upload(B);}return true;},populateDrop:function(B,A){this.submitInfo.set(B.id+"status",this.eventType);this.submitInfo.set(B.id+"dropID",this.drag.element.id);if(!A){Ice.DnD.StyleReader.upload(B);}return true;},ignoreEvent:function(B){if(!B){return false;}var A=false;if(B){if(B.indexOf(this.eventType)!=-1){A=true;}}return A;},serializeSubmitInfo:function(B){var C=this.submitInfo.getPropsAsString();var A=this.getHiddenField(B);if(A){A.value=C.substring(0,C.length-1);}},resetSubmitInfo:function(B){this.submitInfo.deleteAll();var A=this.getHiddenField(B);if(A){A.value="";}},getHiddenField:function(C){var B=C.id+":iceDND";var A=document.getElementsByName(B)[0];if(A){return A;}else{Ice.DnD.logger.debug("Data field not found");}return null;}};Ice.SortEvent=Class.create();Ice.SortEvent.prototype={start:function(){Ice.DnD.logger.debug("Starting Sort Event");},end:function(){Ice.DnD.logger.debug("Ending Sort Event");}};
Draggable.prototype.dragGhost=false;Draggable.prototype.ORIGINAL_initialize=Draggable.prototype.initialize;Draggable.prototype.initialize=function(C){var B=Ice.StateMon.monitors;for(i=0;i<B.length;i++){A=B[i];if(A.id==C&&A.type=="Draggable"){Ice.DnD.logger.debug("Draggable ["+$(C).id+"] has already been created");return ;}}this.element=$(C);var D=arguments[1];if(D.dragGhost==true){this.dragGhost=true;}if(!D.starteffect){D.starteffect=function(){};}if(!D.endeffect){D.endeffect=function(){};}if(D.handle){D.handle=$(D.handle);D.handle=$(D.handle.id);}this.ORIGINAL_initialize(this.element,D);if(!D.sort){Ice.DnD.logger.debug("Draggable Created ID["+this.element.id+"]");var A=new Ice.DraggableMonitor(this.element,D);A.object=this;Ice.StateMon.add(A);}Ice.DnD.logger.debug("Draggable ["+this.element.id+"] created");};Draggable.prototype.ORIGINAL_startDrag=Draggable.prototype.startDrag;Draggable.prototype.startDrag=function(C){this.dragging=true;if(this.dragGhost==true){Ice.DnD.logger.debug("Init Drag Ghost ID["+this.element.id+"]");Draggables.register(this);try{this._ghost=this.element.cloneNode(true);var B=Ice.util.findForm(this.element);B.appendChild(this._ghost);Position.absolutize(this._ghost);Element.makePositioned(this._ghost);this._original=this.element;Position.clone(this._original,this._ghost);var D=parseInt(this._original.style.zIndex);this._ghost.style.left=Event.pointerX(C)+"px";this._ghost.style.zIndex=++D;this.element=this._ghost;this.eventResize=this.resize.bindAsEventListener(this);Event.observe(window,"resize",this.eventResize);}catch(A){Ice.DnD.logger.error("Error init DragGhost  ID["+this.element.id+"]",A);}}if(this.options.dragCursor){this._cursor=this.element.cloneNode(true);document.body.appendChild(this._cursor);Position.absolutize(this._cursor);var D=1+this.element.style.zIndex;this._cursor.style.zIndex=D;Ice.DnD.logger.debug("clone created");}this.ORIGINAL_startDrag(C);};Draggable.prototype.ORIGINAL_draw=Draggable.prototype.draw;Draggable.prototype.draw=function(A){if(!this.options.dragCursor){return this.ORIGINAL_draw(A);}var E=Position.cumulativeOffset(this.element);var D=this.currentDelta();E[0]-=D[0];E[1]-=D[1];var C=A;if(this.options.snap){if(typeof this.options.snap=="function"){C=this.options.snap(C[0],C[1]);}else{if(this.options.snap instanceof Array){C=C.map(function(F,G){return Math.round(F/this.options.snap[G])*this.options.snap[G];}.bind(this));}else{C=C.map(function(F){return Math.round(F/this.options.snap)*this.options.snap;}.bind(this));}}}var B=this._cursor.style;if((!this.options.constraint)||(this.options.constraint=="horizontal")){B.left=C[0]+"px";}if((!this.options.constraint)||(this.options.constraint=="vertical")){B.top=C[1]+"px";}if(B.visibility=="hidden"){B.visibility="";}};Draggable.prototype.resize=function(A){};Draggable.removeMe=function(D){$(D).undoPositioned();var C=Ice.StateMon.monitors;var F=Array();for(i=0;i<C.length;i++){monitor=C[i];try{if(monitor.id==D&&monitor.type=="Draggable"){if(monitor.object.dragging){return ;}try{var E=$(D+"clientOnly");if(!E){monitor.destroyMe=true;monitor.destroy();}}catch(B){logger.warn("Monitor ["+monitor.id+"] destroyed with exception ["+B+"]");}}else{F.push(monitor);}}catch(A){logger.error("Error destroying monitor ["+monitor.id+"] Msg ["+A+"]");}}Ice.StateMon.monitors=F;};Draggable.prototype.ORIGINAL_updateDrag=Draggable.prototype.updateDrag;Draggable.prototype.updateDrag=function(F,G){Droppables.affectedDrop=null;this.ORIGINAL_updateDrag(F,G);ad=Droppables.affectedDrop;iceEv=new Ice.DndEvent();iceEv.drag=this;if(this.dragGhost==true){var A=parseInt(this.element.offsetHeight);var C=parseInt(Element.getStyle(this.element,"top").split("px")[0]);if(Prototype.Browser.IE){C=this.element.cumulativeOffset().top;}var B=Event.pointerY(F);var E=A+C;var D=(B>C&&B<E);if(!D){this.element.style.top=B+"px";}}if(this.hoveringDrop&&!ad){iceEv.eventType=Ice.DnD.HOVER_END;}if(ad&&(!this.hoveringDrop||this.hoveringDrop.element.id!=ad.element.id)){iceEv.eventType=Ice.DnD.HOVER_START;iceEv.drop=ad;}this.hoveringDrop=(ad!=null)?ad:null;if(!iceEv.eventType){iceEv.eventType=Ice.DnD.DRAG_START;}iceEv.submit();};Draggable.prototype.ORIGINAL_finishDrag=Draggable.prototype.finishDrag;Draggable.prototype.finishDrag=function(D,E){if(!this.options.sort){this.dragging=false;if(E){iceEv=new Ice.DndEvent();iceEv.drag=this;if(this.hoveringDrop){iceEv.drop=this.hoveringDrop;iceEv.eventType=Ice.DnD.DROPPED;}else{iceEv.eventType=Ice.DnD.DRAG_CANCEL;}iceEv.submit();if(this.dragGhost==true){this.element=this._original;Element.remove(this._ghost);this._ghost=null;}if(this.options.dragCursor){Element.remove(this._cursor);this._cursor=null;}Draggable.removeMe(this.element.id);}}this.ORIGINAL_finishDrag(D,E);DropRegions.init=false;DropRegions.map=[];if(this.options.sort&&E){try{var C=Ice.util.findForm(this.element);var B=new Object();Ice.DnD.logger.debug("Submitting Sortable ["+this.element+"]");iceSubmit(C,this.element,B);}catch(A){Ice.DnD.logger.error("error submiting sortable element["+this.element+"] Err Msg["+A+"]");}}};
Droppables.affectedDrop=null;Droppables.ORIGINAL_show=Droppables.show;Droppables.show=function(A,B){if(!this.drops.length){return ;}if(this.last_active){this.deactivate(this.last_active);}var C=this.drops;if(DropRegions.init&&this.drops.all(function(D){return !D.scrollid;})){C=DropRegions.drops(A);}C.each(function(D){if(Position.within(D.element,A[0],A[1])){if(Droppables.isAffected(A,B,D)){Droppables.affectedDrop=D;if(D.onHover){D.onHover(B,D.element,Position.overlap(D.overlap,D.element));}if(D.greedy){Droppables.activate(D);}}}if(!DropRegions.init){DropRegions.register(D);}});DropRegions.init=true;};Droppables.ORIGINAL_isAffected=Droppables.isAffected;Droppables.isAffected=function(B,D,C){var A=false;A=Droppables.ORIGINAL_isAffected(B,D,C);if(A&&C.sort){if(!Ice.DnD.sortableDraggable(D)){A=false;}}return A;};Droppables.ORIGINAL_add=Droppables.add;Droppables.add=function(D,B){var C=Ice.StateMon.monitors;for(i=0;i<C.length;i++){A=C[i];if(A.id==D&&A.type=="Droppable"){return ;}}Droppables.ORIGINAL_add(D,B);if(B&&!B.sort){var A=new Ice.DroppableMonitor($(D),B);Ice.StateMon.add(A);}};
var SortableObserver=Class.create();SortableObserver.prototype={initialize:function(B,A){this.element=$(B);this.observer=A;this.lastValue=Sortable.serialize(this.element);},onStart:function(B,C){this.lastValue=Sortable.serialize(this.element);var A=Sortable.options(this.element);A.lastDrag=C;A.lastDrag=C.element.id;},onEnd:function(){Sortable.unmark();var B=Sortable.serialize(this.element);var A=Sortable.options(this.element);A.serializeValue=B;if(this.lastValue!=B){this.observer(this.element);}}};var Sortable={sortables:{},sortableElements:Array(),kids:null,_findRootElement:function(A){while(A.tagName!="BODY"){if(A.id&&Sortable.sortables[A.id]){return A;}A=A.parentNode;}},options:function(A){A=Sortable._findRootElement($(A));if(!A){return ;}return Sortable.sortables[A.id];},destroy:function(B){var C=Sortable.options(B);if(C){Draggables.removeObserver(C.element);C.droppables.each(function(E){Droppables.remove(E);});C.draggables.invoke("destroy");delete Sortable.sortables[C.element.id];var A=0;var D=Array();for(A=0;A<Sortable.sortableElements.length;A++){if(Sortable.sortableElements[A]&&Sortable.sortableElements[A].id!=C.element.id){D.push(Sortable.sortableElements[A]);}}Sortable.sortableElements=D;}},create:function(F,H,E){F=$(F);if(Ice.DnD.alreadySort(F)){Ice.DnD.logger.debug("Sort ID ["+F.id+"] already created");return ;}var B=new Ice.SortableMonitor(F,H);var D=Object.extend({element:F,tag:"li",dropOnEmpty:false,overlap:"vertical",constraint:"vertical",containment:F,handle:false,only:false,hoverclass:null,ghosting:false,format:null,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(F);var A={revert:true,ghosting:D.ghosting,constraint:D.constraint,handle:D.handle,sort:true};if(D.starteffect){A.starteffect=D.starteffect;}if(D.reverteffect){A.reverteffect=D.reverteffect;}else{if(D.ghosting){A.reverteffect=function(I){I.style.top=0;I.style.left=0;};}}if(D.endeffect){A.endeffect=D.endeffect;}if(D.zindex){A.zindex=D.zindex;}var G={overlap:D.overlap,containment:D.containment,hoverclass:D.hoverclass,onHover:Sortable.onHover,greedy:!D.dropOnEmpty,sort:true};Element.cleanWhitespace(F);D.draggables=[];D.droppables=[];if(D.dropOnEmpty){Droppables.add(F,{containment:D.containment,onHover:Sortable.onEmptyHover,greedy:false,sort:true});D.droppables.push(F);}(D.elements||this.findElements(F,D)||[]).each(function(K,I){var J=D.handles?$(D.handles[I]):(D.handle?$(K).select("."+D.handle)[0]:K);D.draggables.push(new Draggable(K,Object.extend(A,{handle:J})));Droppables.add(K,G);if(D.tree){K.treeNode=F;}D.droppables.push(K);});this.sortables[F.id]=D;this.sortableElements.push(F);B.options=D;Ice.StateMon.add(B);var C=new SortableObserver(F,D.onUpdate);Draggables.addObserver(C);},findElements:function(B,A){if(!B.hasChildNodes()){return null;}var C=[];$A(B.childNodes).each(function(D){if(D.tagName&&D.tagName.toUpperCase()==A.tag.toUpperCase()&&(!A.only||(Element.hasClassName(D,A.only)))){C.push(D);}});return(C.length>0?C.flatten():null);},onHover:function(E,D,A){if(A>0.5){Sortable.mark(D,"before");if(D.previousSibling!=E){var B=E.parentNode;E.style.visibility="hidden";D.parentNode.insertBefore(E,D);if(D.parentNode!=B){Sortable.options(B).onChange(E);}Sortable.options(D.parentNode).onChange(E);}}else{Sortable.mark(D,"after");var C=D.nextSibling||null;if(C!=E){var B=E.parentNode;E.style.visibility="hidden";D.parentNode.insertBefore(E,C);if(D.parentNode!=B){Sortable.options(B).onChange(E);}Sortable.options(D.parentNode).onChange(E);}}},onEmptyHover:function(C,B){if(C.parentNode!=B){var A=C.parentNode;B.appendChild(C);Sortable.options(A).onChange(C);Sortable.options(B).onChange(C);}},unmark:function(){if(Sortable._marker){Element.hide(Sortable._marker);}},mark:function(B,A){var D=Sortable.options(B.parentNode);if(!D){return ;}if(D&&!D.ghosting){return ;}if(!Sortable._marker){Sortable._marker=$("dropmarker")||document.createElement("DIV");Element.hide(Sortable._marker);Element.addClassName(Sortable._marker,"dropmarker");Sortable._marker.style.position="absolute";document.getElementsByTagName("body").item(0).appendChild(Sortable._marker);}var C=Position.cumulativeOffset(B);Sortable._marker.style.left=C[0]+"px";Sortable._marker.style.top=C[1]+"px";if(A=="after"){if(D.overlap=="horizontal"){Sortable._marker.style.left=(C[0]+B.clientWidth)+"px";}else{Sortable._marker.style.top=(C[1]+B.clientHeight)+"px";}}Element.show(Sortable._marker);},serialize:function(C){C=$(C);var B=Sortable.options(C);var A=Object.extend({tag:B.tag,only:B.only,name:C.id,format:B.format||/^[^_]*_(.*)$/},arguments[1]||{});return"first;"+B.lastDrag+";changed;"+$(this.findElements(C,A)||[]).map(function(D){return D.id;}).join(";");}};
var Autocompleter={};Autocompleter.Finder={list:new Array(),add:function(B,A){this.list[B.id]=A;},find:function(A){return this.list[A];}};Autocompleter.Base=function(){};Autocompleter.Base.prototype={baseInitialize:function(D,E,C,A,B){this.element=$(D);this.update=$(E);this.hasFocus=false;this.changed=false;this.active=false;this.index=-1;this.entryCount=0;this.rowClass=A;this.selectedRowClass=B;if(this.setOptions){this.setOptions(C);}else{this.options=C||{};}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(F,G){if(!G.style.position||G.style.position=="absolute"){G.style.position="absolute";Position.clone(F,G,{setHeight:false,offsetTop:F.offsetHeight});G.clonePosition(F.parentNode,{setTop:false,setWidth:false,setHeight:false,offsetLeft:F.offsetLeft-F.parentNode.offsetLeft});}Effect.Appear(G,{duration:0.15});};this.options.onHide=this.options.onHide||function(F,G){new Effect.Fade(G,{duration:0.15});};if(typeof (this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens);}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keypress",this.onKeyPress.bindAsEventListener(this));if(Prototype.Browser.IE||Prototype.Browser.WebKit){Event.observe(this.element,"keydown",this.onKeyDown.bindAsEventListener(this));}if(Prototype.Browser.IE||Prototype.Browser.WebKit){Event.observe(this.element,"paste",this.onPaste.bindAsEventListener(this));}},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update);}if(!this.iefix&&(navigator.appVersion.indexOf("MSIE")>0)&&(navigator.userAgent.indexOf("Opera")<0)&&(Element.getStyle(this.update,"position")=="absolute")){var A=Ice.ElementModel.Element.adaptToElement(this.element).findConnection().sendURI;var B=A.substring(0,A.indexOf("block/send-receive-updates"));new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" title="IE6_Fix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="'+B+'xmlhttp/blank" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix");}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50);}this.element.focus();},fixIEOverlapping:function(){Position.clone(this.update,this.iefix);this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix);},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update);}if(this.iefix){Element.hide(this.iefix);}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator);}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator);}},onKeyPress:function(B){if(!this.active){Ice.Autocompleter.logger.debug("Key press ignored. Not active.");switch(B.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.getUpdatedChoices(true,B,-1);return ;case Event.KEY_DOWN:this.getUpdatedChoices(false,B,-1);return ;}}Ice.Autocompleter.logger.debug("Key Press");if(this.active){switch(B.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.hidden=true;var A=this.selectEntry();Ice.Autocompleter.logger.debug("Getting updated choices on enter");this.getUpdatedChoices(true,B,A);this.hide();Event.stop(B);return ;case Event.KEY_ESC:this.hide();this.active=false;Event.stop(B);return ;case Event.KEY_LEFT:case Event.KEY_RIGHT:return ;case Event.KEY_UP:if(!(Prototype.Browser.IE||Prototype.Browser.WebKit)){this.markPrevious();this.render();Event.stop(B);return ;}case Event.KEY_DOWN:if(!(Prototype.Browser.IE||Prototype.Browser.WebKit)){this.markNext();this.render();Event.stop(B);return ;}}}else{if(B.keyCode==Event.KEY_TAB||B.keyCode==Event.KEY_RETURN){return ;}}this.changed=true;this.hasFocus=true;this.index=-1;this.skip_mouse_hover=true;if(this.active){this.render();}if(this.observer){clearTimeout(this.observer);}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000);},onKeyDown:function(A){if(!this.active){switch(A.keyCode){case Event.KEY_DOWN:this.getUpdatedChoices(false,A,-1);return ;case Event.KEY_BACKSPACE:case Event.KEY_DELETE:if(this.observer){clearTimeout(this.observer);}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000);return ;}}else{if(this.active){switch(A.keyCode){case Event.KEY_UP:this.markPrevious();this.render();Event.stop(A);return ;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(A);return ;case Event.KEY_ESC:if(Prototype.Browser.WebKit){this.hide();this.active=false;Event.stop(A);return ;}case Event.KEY_BACKSPACE:case Event.KEY_DELETE:if(this.observer){clearTimeout(this.observer);}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000);return ;}}}},activate:function(){this.changed=false;this.hasFocus=true;},onHover:function(B){var A=Event.findElement(B,"DIV");if(this.index!=A.autocompleteIndex){if(!this.skip_mouse_hover){this.index=A.autocompleteIndex;}this.render();}Event.stop(B);},onMove:function(A){if(this.skip_mouse_hover){this.skip_mouse_hover=false;this.onHover(A);}},onClick:function(C){this.hidden=true;var B=Event.findElement(C,"DIV");this.index=B.autocompleteIndex;var A=B.autocompleteIndex;this.selectEntry();this.getUpdatedChoices(true,C,A);this.hide();},onBlur:function(C){if(navigator.userAgent.indexOf("MSIE")>=0){var B=document.compatMode&&document.compatMode=="CSS1Compat";var A=B?document.documentElement:document.body;if(C.clientX>A.clientLeft+A.clientWidth||C.clientY>A.clientTop+A.clientHeight){this.element.focus();return ;}}setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false;},onPaste:function(A){this.changed=true;this.hasFocus=true;this.index=-1;this.skip_mouse_hover=true;if(this.active){this.render();}if(this.observer){clearTimeout(this.observer);}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000);return ;},render:function(){if(this.entryCount>0){for(var B=0;B<this.entryCount;B++){if(this.index==B){ar=this.rowClass.split(" ");for(var A=0;A<ar.length;A++){Element.removeClassName(this.getEntry(B),ar[A]);}ar=this.selectedRowClass.split(" ");for(var A=0;A<ar.length;A++){Element.addClassName(this.getEntry(B),ar[A]);}}else{ar=this.selectedRowClass.split(" ");for(var A=0;A<ar.length;A++){Element.removeClassName(this.getEntry(B),ar[A]);}ar=this.rowClass.split(" ");for(var A=0;A<ar.length;A++){Element.addClassName(this.getEntry(B),ar[A]);}}}if(this.hasFocus){this.show();this.active=true;}}else{this.active=false;this.hide();}},markPrevious:function(){if(this.index>0){this.index--;}else{this.index=this.entryCount-1;}},markNext:function(){if(this.index==-1){this.index++;return ;}if(this.index<this.entryCount-1){this.index++;}else{this.index=0;}},getEntry:function(B){try{return this.update.firstChild.childNodes[B];}catch(A){return null;}},getCurrentEntry:function(){return this.getEntry(this.index);},selectEntry:function(){var A=-1;this.active=false;if(this.index>=0){A=this.index;this.updateElement(this.getCurrentEntry());this.index=-1;}return A;},updateElement:function(F){if(this.options.updateElement){this.options.updateElement(F);return ;}var C="";if(this.options.select){var A=document.getElementsByClassName(this.options.select,F)||[];if(A.length>0){C=Element.collectTextNodes(A[0],this.options.select);}}else{C=Element.collectTextNodesIgnoreClass(F,"informal");}var E=this.findLastToken();if(E!=-1){var D=this.element.value.substr(0,E+1);var B=this.element.value.substr(E+1).match(/^\s+/);if(B){D+=B[0];}this.element.value=D+C;}else{this.element.value=C;}this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,F);}},updateChoices:function(C){if(!this.changed&&this.hasFocus){this.update.innerHTML=C;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.firstChild);if(this.update.firstChild&&this.update.firstChild.childNodes){this.entryCount=this.update.firstChild.childNodes.length;for(var A=0;A<this.entryCount;A++){var B=this.getEntry(A);B.autocompleteIndex=A;this.addObservers(B);}}else{this.entryCount=0;}this.stopIndicator();this.index=-1;this.render();}else{Ice.Autocompleter.logger.debug("Not updating choices Not Changed["+this.changed+"] hasFocus["+this.hasFocus+"]");}},addObservers:function(A){Event.observe(A,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(A,"click",this.onClick.bindAsEventListener(this));Event.observe(A,"mousemove",this.onMove.bindAsEventListener(this));},dispose:function(){for(var A=0;A<this.entryCount;A++){var B=this.getEntry(A);B.autocompleteIndex=A;Event.stopObserving(B,"mouseover",this.onHover);Event.stopObserving(B,"click",this.onClick);Event.stopObserving(B,"mousemove",this.onMove);}Event.stopObserving(this.element,"mouseover",this.onHover);Event.stopObserving(this.element,"click",this.onClick);Event.stopObserving(this.element,"mousemove",this.onMove);Event.stopObserving(this.element,"blur",this.onBlur);Event.stopObserving(this.element,"keypress",this.onKeyPress);if(Prototype.Browser.IE||Prototype.Browser.WebKit){Event.stopObserving(this.element,"keydown",this.onKeyDown);}Autocompleter.Finder.list[this.element.id]=null;Ice.Autocompleter.logger.debug("Destroyed autocomplete ["+this.element.id+"]");},onObserverEvent:function(){this.changed=false;if(this.getToken().length>=this.options.minChars){this.startIndicator();this.getUpdatedChoices(false,undefined,-1);}else{this.active=false;this.hide();this.getUpdatedChoices(false,undefined,-1);}},getToken:function(){var B=this.findLastToken();if(B!=-1){var A=this.element.value.substr(B+1).replace(/^\s+/,"").replace(/\s+$/,"");}else{var A=this.element.value;}return/\n/.test(A)?"":A;},findLastToken:function(){var C=-1;for(var B=0;B<this.options.tokens.length;B++){var A=this.element.value.lastIndexOf(this.options.tokens[B]);if(A>C){C=A;}}return C;}};Ajax.Autocompleter=Class.create();Object.extend(Object.extend(Ajax.Autocompleter.prototype,Autocompleter.Base.prototype),{initialize:function(C,D,B,A){this.baseInitialize(C,D,A);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=B;},getUpdatedChoices:function(){entry=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,entry):entry;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams;}new Ajax.Request(this.url,this.options);},onComplete:function(A){this.updateChoices(A.responseText);}});Ice.Autocompleter=Class.create();Object.extend(Object.extend(Ice.Autocompleter.prototype,Autocompleter.Base.prototype),{initialize:function(H,F,C,B,E){Ice.Autocompleter.logger.debug("Building Ice Autocompleter ID ["+H+"]");var G=Autocompleter.Finder.list[H];if(G&&!G.monitor.changeDetected()){return ;}if(C){C.minChars=0;}else{C={minChars:0};}var D=$(H);var A=$(F);this.baseInitialize(D,A,C,B,E);this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.monitor=new Ice.AutocompleterMonitor(D,A,C,B,E);this.monitor.object=this;Ice.StateMon.add(this.monitor);Autocompleter.Finder.add(this.element,this);Ice.Autocompleter.logger.debug("Done building Ice Autocompleter");if(this.monitor.changeDetected()){Ice.Autocompleter.logger.debug("Change has been detected");}},getUpdatedChoices:function(B,D,A){if(!D){D=new Object();}entry=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,entry):entry;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams;}var C=Ice.util.findForm(this.element);if(A>-1){var E=this.element.id+"_idx";C[E].value=A;}if(B){Ice.Autocompleter.logger.debug("Sending submit");iceSubmit(C,this.element,D);}else{Ice.Autocompleter.logger.debug("Sending partial submit");iceSubmitPartial(C,this.element,D);}},onComplete:function(A){this.updateChoices(A.responseText);},updateNOW:function(A){if(this.hidden){this.hidden=false;return ;}this.hasFocus=true;Element.cleanWhitespace(this.update);this.updateChoices(A);this.show();this.render();}});
Effect.Highlight.prototype.ORIGINAL_setup=Effect.Highlight.prototype.setup;Effect.Highlight.prototype.setup=function(){if(this.element.highlighting){this.cancel();return ;}this.ORIGINAL_setup();this.element.highlighting=true;};Effect.Highlight.prototype.ORIGINAL_finish=Effect.Highlight.prototype.finish;Effect.Highlight.prototype.finish=function(){this.ORIGINAL_finish();this.element.highlighting=false;};Object.extend(Effect.DefaultOptions,{afterFinish:function(A){if(this.uploadCSS!=null){Ice.DnD.StyleReader.upload(A.element,A.options.submit);}if(A.options.iceFinish){A.options.iceFinish(A);}}});function blankEffect(){}Effect.Grow=function(C){C=$(C);var B=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var A={top:C.style.top,left:C.style.left,height:C.style.height,width:C.style.width,opacity:C.getInlineOpacity()};var G=C.getDimensions();var H,F;var E,D;switch(B.direction){case"top-left":H=F=E=D=0;break;case"top-right":H=G.width;F=D=0;E=-G.width;break;case"bottom-left":H=E=0;F=G.height;D=-G.height;break;case"bottom-right":H=G.width;F=G.height;E=-G.width;D=-G.height;break;case"center":H=G.width/2;F=G.height/2;E=-G.width/2;D=-G.height/2;break;}return new Effect.Move(C,{x:H,y:F,duration:0.01,beforeSetup:function(I){I.element.hide().makeClipping().makePositioned();},afterFinishInternal:function(I){new Effect.Parallel([new Effect.Opacity(I.element,{sync:true,to:1,from:0,transition:B.opacityTransition}),new Effect.Move(I.element,{x:E,y:D,sync:false,transition:B.moveTransition}),new Effect.Scale(I.element,100,{scaleMode:{originalHeight:G.height,originalWidth:G.width},sync:false,scaleFrom:window.opera?1:0,transition:B.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(J){J.effects[0].element.setStyle({height:"10px"},{width:"10px"}).show();},afterFinishInternal:function(J){J.effects[0].element.undoClipping().undoPositioned().setStyle(A);}},B));}});};
try{Ice.DnD.init();Ice.Autocompleter.logger=logger.child("autocomplete");Ice.StateMon.checkAll();Ice.StateMon.rebuild();}catch(ee){alert("Error in extras bootstrap ["+ee+"]");}window.onUnload(function(){try{Ice.StateMon.destroyAll();Autocompleter.Finder.list=new Array();}catch(A){Ice.DnD.logger.debug("Unload Error ["+A+"]");}});
var GMapRepository=new Array();var GMapWrapper=Class.create();GMapWrapper.prototype={initialize:function(A,B){this.eleId=A;this.realGMap=B;this.controls=new Object();this.overlays=new Object();this.geoMarker=new Object();this.geoMarkerAddress;this.geoMarkerSet=false;},getElementId:function(){return this.eleId;},getRealGMap:function(){return this.realGMap;},getControlsArray:function(){return this.controls;}};Ice.GoogleMap=Class.create();Ice.GoogleMap={getGeocoder:function(B){var A=GMapRepository[B+"geo"];if(A==null){GMapRepository[B+"geo"]=new GClientGeocoder();return GMapRepository[B+"geo"];}else{return A;}},getGDirection:function(E,C){var B=GMapRepository[E+"dir"];if(B==null){var D=Ice.GoogleMap.getGMapWrapper(E).getRealGMap();var A=document.getElementById(C);GMapRepository[E+"dir"]=new GDirections(D,A);return GMapRepository[E+"dir"];}else{return B;}},getGMapWrapper:function(C){var A=GMapRepository[C];if(A){var B=document.getElementById(C);if(!B.hasChildNodes()){A=Ice.GoogleMap.recreate(C,A);}}else{A=Ice.GoogleMap.create(C);}return A;},loadDirection:function(F,B,C){var E=GMapRepository[F+"dir"];var D=Ice.GoogleMap.getGMapWrapper(F).getRealGMap();if(E==null){var A=document.getElementById(B);E=new GDirections(D,A);GMapRepository[F+"dir"]=E;}E.load(C);},addOverlay:function(ele,overlayId,ovrLay){var gmapWrapper=Ice.GoogleMap.getGMapWrapper(ele);var overlay=gmapWrapper.overlays[overlayId];if(overlay==null){overlay=eval(ovrLay);gmapWrapper.getRealGMap().addOverlay(overlay);gmapWrapper.overlays[overlayId]=overlay;}},removeOverlay:function(D,C){var A=Ice.GoogleMap.getGMapWrapper(D);var B=A.overlays[C];if(B!=null){A.getRealGMap().removeOverlay(B);}else{return ;}var E=new Object();for(overlayObj in A.overlays){if(C!=overlayObj){E[overlayObj]=A.overlays[overlayObj];}}A.overlays=E;},locateAddress:function(A,B){var D=function(E){if(!E){alert(B+" not found");}else{var G=Ice.GoogleMap.getGMapWrapper(A);if(G){G.getRealGMap().setCenter(E,13);var F=new GMarker(E);G.getRealGMap().addOverlay(F);F.openInfoWindowHtml(B);G.geoMarker=F;G.geoMarkerAddress=B;Ice.GoogleMap.submitEvent(A,G.getRealGMap(),"geocoder");}else{}}};var C=Ice.GoogleMap.getGeocoder(A);C.getLatLng(B,D);},create:function(D){var B=new GMapWrapper(D,new GMap2(document.getElementById(D)));var A=document.getElementById(D+"hdn");var C=false;GEvent.addListener(B.getRealGMap(),"zoomend",function(F,E){if(F!=null){Ice.GoogleMap.submitEvent(D,B.getRealGMap(),"zoomend",E);}});GEvent.addListener(B.getRealGMap(),"dragend",function(){Ice.GoogleMap.submitEvent(D,B.getRealGMap(),"dragend");});GEvent.addListener(B.getRealGMap(),"maptypechanged",function(){if(C){var E=$(D+"type");E.value=B.getRealGMap().getCurrentMapType().getName();Ice.GoogleMap.submitEvent(D,B.getRealGMap(),"maptypechanged");}C=true;});initializing=false;GMapRepository[D]=B;return B;},submitEvent:function(M,B,G,F){try{var A=B.getCenter();var J=$(M+"lat");var K=$(M+"lng");var C=$(M+"event");var L=$(M+"zoom");var I=$(M+"type");J.value=A.lat();K.value=A.lng();C.value=G;if(F==null){L.value=B.getZoom();}else{L.value=F;if(L.value==B.getZoom()){return ;}}var D=Ice.util.findForm(J);var E=new Object();iceSubmitPartial(D,J,E);C.value="";}catch(H){}},recreate:function(F,B){Ice.GoogleMap.remove(F);var C=B.controls;var E=B.geoMarker;var A=B.geoMarkerAddress;B=Ice.GoogleMap.create(F);B.geoMarker=E;B.geoMarkerAddress=A;B.geoMarkerSet="true";var D=new Object();for(control in C){if(D[control]==null){Ice.GoogleMap.removeControl(F,control);Ice.GoogleMap.addControl(F,control);}}return B;},addControl:function(ele,controlName){var gmapWrapper=Ice.GoogleMap.getGMapWrapper(ele);var control=gmapWrapper.controls[controlName];if(control==null){control=eval("new "+controlName+"()");gmapWrapper.getRealGMap().addControl(control);gmapWrapper.controls[controlName]=control;}},removeControl:function(C,E){var A=Ice.GoogleMap.getGMapWrapper(C);var D=A.controls[E];if(D!=null){A.getRealGMap().removeControl(D);}var B=new Object();for(D in A.controls){if(E!=D){B[D]=A.controls[D];}}A.controls=B;},remove:function(B){var A=new Array();for(map in GMapRepository){if(map!=B){A[map]=GMapRepository[map];}}GMapRepository=A;},setMapType:function(C,B){var A=Ice.GoogleMap.getGMapWrapper(C);if(A.geoMarkerSet&&A.geoMarker!=null&&A.geoMarkerAddress!=null){A.getRealGMap().addOverlay(A.geoMarker);A.geoMarker.openInfoWindowHtml(A.geoMarkerAddress);A.geoMarkerSet=false;}if(A.getRealGMap().getCurrentMapType()!=null){if(A.getRealGMap().getCurrentMapType().getName()!=B){switch(B){case"Satellite":A.getRealGMap().setMapType(G_SATELLITE_MAP);break;case"Hybrid":A.getRealGMap().setMapType(G_HYBRID_MAP);break;case"Map":A.getRealGMap().setMapType(G_NORMAL_MAP);break;}}}}};
var JSObjects=new Array();Ice.Repository=Class.create();Ice.Repository={obj:null,getInstance:function(_id){if(JSObjects[_id]==null){JSObjects[_id]=eval(this.obj);}return JSObjects[_id];},register:function(A,B){this.obj=B;if(JSObjects[A]==null){JSObjects[A]=this.obj;}return this.obj;},remove:function(B){var A=new Array();for(key in JSObjects){if(key==B){continue;}A[key]=JSObjects[key];}JSObjects=A;},getAll:function(){var B=new Array();var A=0;for(key in JSObjects){if(key.indexOf(":")>0){B[A++]=JSObjects[key];}}return B;}};
var visibleTooltipList=new Array();ToolTipPanelPopup=Class.create({initialize:function(I,K,A,D,E,C,J,F,H,G,B){this.src=I;this.delay=E||500;this.dynamic=(C=="true");this.tooltipCompId=K;this.srcCompId=I.id;this.hideOn=D;this.x=Event.pointerX(A);this.y=Event.pointerY(A);this.formId=J;this.ctxValue=F;this.iFrameUrl=H;this.moveWithMouse=B;A.cancelBubble=true;if(this.hideOn=="mousedown"){this.hideEvent=this.hidePopupOnMouseClick.bindAsEventListener(this);}else{if(this.hideOn=="mouseout"){this.hideEvent=this.hidePopupOnMouseOut.bindAsEventListener(this);}else{this.hideOn="none";}}this.eventMouseMove=this.updateCordinate.bindAsEventListener(this);this.clearTimerEvent=this.clearTimer.bindAsEventListener(this);Event.observe(document,"mouseout",this.clearTimerEvent);Event.observe(document,this.hideOn,this.hideEvent);Event.observe(document,"mousemove",this.eventMouseMove);if(G=="hover"){this.timer=setTimeout(this.showPopup.bind(this),parseInt(this.delay));}else{this.showPopup.bind(this)();Event.extend(A).stop();}},showPopup:function(){if(this.isTooltipVisible()){return ;}if(this.dynamic){var B=this.getTooltip();if(B){B.style.visibility="hidden";var A=B.childNodes[0];if(A){B.removeChild(A);}}this.submit("show");if(this.hideOn=="none"){this.populateFields(true);}}else{var B=this.getTooltip();B.style.visibility="visible";B.style.position="absolute";B.style.display="";B.style.top=this.y-B.offsetHeight-4+"px";B.style.left=this.x+4+"px";ToolTipPanelPopupUtil.adjustPosition(B);Ice.iFrameFix.start(this.tooltipCompId,this.iFrameUrl);}this.addToVisibleList();},hidePopupOnMouseOut:function(A){if(!this.isTooltipVisible()){return ;}if(Position.within($(this.tooltipCompId),Event.pointerX(A),Event.pointerY(A))){return ;}this.hidePopup(A);this.state="hide";this.populateFields();if(this.hideOn=="mouseout"){this.removedFromVisibleList();}this.dispose(A);},hidePopupOnMouseClick:function(A){if(!this.isTooltipVisible()||!Event.isLeftClick(A)){return ;}var B=Event.element(A);if(this.srcOrchildOfSrcElement(B)){return ;}else{this.hidePopup(A);}if(this.hideOn=="mousedown"){this.removedFromVisibleList();}this.dispose(A);},dispose:function(A){Event.stopObserving(document,this.hideOn,this.hideEvent);Event.stopObserving(document,"mousemove",this.eventMouseMove);},hidePopup:function(A){if(this.dynamic){this.submit("hide");}else{tooltip=this.getTooltip();tooltip.style.visibility="hidden";tooltip.style.display="none";}},submit:function(D,C){if(!C){C=new Object();}this.state=D;this.populateFields();var A=$(this.srcCompId);try{var B=Ice.util.findForm(A);iceSubmitPartial(B,A,C);}catch(E){logger.info("Form not found"+E);}},clearTimer:function(){Event.stopObserving(document,"mouseout",this.clearTimerEvent);clearTimeout(this.timer);},updateCordinate:function(A){if(Event.element(A)!=this.src&&!A.element().descendantOf(this.src)){return ;}this.x=Event.pointerX(A);this.y=Event.pointerY(A);if(!this.isTooltipVisible()||!this.moveWithMouse){return ;}var B=this.getTooltip();B.style.top=this.y-B.offsetHeight-4+"px";B.style.left=this.x+4+"px";ToolTipPanelPopupUtil.adjustPosition(B);Ice.iFrameFix.start(this.tooltipCompId,this.iFrameUrl);},srcOrchildOfSrcElement:function(B){var A=this.getTooltip();if(A==B){return true;}while(B.parentNode){B=B.parentNode;if(A==B){return true;}}},getTooltip:function(){return $(this.tooltipCompId);},populateFields:function(B){var A=$(this.formId);if(A==null){return ;}var C=A.getElements().find(function(D){if(D.id=="iceTooltipInfo"){return D;}});if(!C){C=document.createElement("input");C.id="iceTooltipInfo";C.name="iceTooltipInfo";C.type="hidden";A.appendChild(C);}else{}if(B){C.value="";}else{C.value="tooltip_id="+this.tooltipCompId+"; tooltip_src_id="+this.src.id+"; tooltip_state="+this.state+"; tooltip_x="+this.x+"; tooltip_y="+this.y+"; cntxValue="+this.ctxValue;}},addToVisibleList:function(){if(!this.isTooltipVisible()){this.removedFromVisibleList("all");visibleTooltipList[parseInt(visibleTooltipList.length)]={tooltipId:this.tooltipCompId,srcCompId:this.srcCompId};}else{}},removedFromVisibleList:function(C){if(this.isTooltipVisible()||C){var B=new Array();var A=-1;for(i=0;i<visibleTooltipList.length;i++){if(visibleTooltipList[i].tooltipId!=this.tooltipCompId){A=parseInt(A)+1;B[A]=visibleTooltipList[i];}else{}}visibleTooltipList=B;}else{}},isTooltipVisible:function(A){for(i=0;i<visibleTooltipList.length;i++){if(A){if(visibleTooltipList[i].tooltipId==this.tooltipCompId){return true;}}else{if(visibleTooltipList[i].tooltipId==this.tooltipCompId&&visibleTooltipList[i].srcCompId==this.srcCompId){return true;}}}return false;}});ToolTipPanelPopupUtil={removeFromVisibleList:function(C){var B=new Array();var A=-1;for(i=0;i<visibleTooltipList.length;i++){if(visibleTooltipList[i].tooltipId!=C){A=parseInt(A)+1;B[A]=visibleTooltipList[i];}else{}}visibleTooltipList=B;},adjustPosition:function(H){var B=$(H);var E=document.viewport.getDimensions();var F=document.viewport.getScrollOffsets();var A=B.getDimensions();var D=B.cumulativeOffset();var C=B.positionedOffset();var G=0;if(D.left<F.left){G=F.left-D.left;}else{if(D.left+A.width>F.left+E.width){G=(D.left+A.width)-(F.left+E.width);G=-Math.min(G,(D.left-F.left));}}B.style.left=C.left+G+"px";G=0;if(D.top<F.top){G=F.top-D.top;}else{if(D.top+A.height>F.top+E.height){G=(D.top+A.height)-(F.top+E.height);G=-Math.min(G,(D.top-F.top));}}B.style.top=C.top+G+"px";},showPopup:function(B){var A=$(B);A.style.top=parseInt(A.style.top)-A.offsetHeight-4+"px";A.style.left=parseInt(A.style.left)+4+"px";ToolTipPanelPopupUtil.adjustPosition(B);}};
Ice.Resizable=Class.create({initialize:function(B,A){this.source=Event.element(B);this.horizontal=A;if(this.horizontal){this.pointerLocation=parseInt(Event.pointerY(B));}else{this.pointerLocation=parseInt(Event.pointerX(B));}this.eventMouseMove=this.resize.bindAsEventListener(this);this.eventMouseUp=this.detachEvent.bindAsEventListener(this);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"mouseup",this.eventMouseUp);this.origionalHeight=this.source.style.height;this.disableTextSelection();this.getGhost().style.position="absolute";this.deadPoint=20;},print:function(A){logger.info(A);},getPreviousElement:function(){},getContainerElement:function(){},getNextElement:function(){},getGhost:function(){return this.source;},finalize:function(A){this.source.style.position="";this.source.style.left=Event.pointerX(A)+"px";},resize:function(A){this.getGhost().style.visibility="";if(this.deadEnd(A)){return ;}if(this.horizontal){this.getGhost().style.cursor="n-resize";var C=Event.pointerY(A)-this.getGhost().getOffsetParent().cumulativeOffset().top;this.getGhost().style.top=C+"px";}else{this.getGhost().style.cursor="e-resize";var B=Event.pointerX(A)-this.getGhost().getOffsetParent().cumulativeOffset().left;this.getGhost().style.left=B+"px";}},detachEvent:function(A){this.source.style.height=this.origionalHeight;if(this.getDifference(A)>0&&!this.deadEnd(A)){this.adjustPosition(A);}Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"mouseup",this.eventMouseUp);this.enableTextSelection();this.finalize(A);},adjustPosition:function(C){var E=Element.getWidth(this.getPreviousElement());var B=Element.getWidth(this.getNextElement());var A=Element.getWidth(this.getContainerElement());var D=this.getDifference(C);if(this.resizeAction=="inc"){this.getPreviousElement().style.width=(E+D)+"px";this.getNextElement().style.width=(B-D)+"px";this.print("Diff "+D);this.print("Td width "+E+this.getPreviousElement().id);this.print("Table width "+A);}else{this.getPreviousElement().style.width=(E-D)+"px";this.getNextElement().style.width=(B+D)+"px";}},getDifference:function(B){var A;if(this.horizontal){A=parseInt(Event.pointerY(B));}else{A=parseInt(Event.pointerX(B));}if(this.pointerLocation>A){this.resizeAction="dec";return this.pointerLocation-A;}else{this.resizeAction="inc";return A-this.pointerLocation;}},deadEnd:function(B){var C=this.getDifference(B);if(this.resizeAction=="dec"){var D;if(this.horizontal){D=Element.getHeight(this.getPreviousElement());}else{D=Element.getWidth(this.getPreviousElement());}if((D-C)<this.deadPoint){return true;}}else{var A;if(this.horizontal){A=Element.getHeight(this.getNextElement());}else{A=Element.getWidth(this.getNextElement());}if((A-C)<this.deadPoint){return true;}}return false;},disableTextSelection:function(){this.getContainerElement().onselectstart=function(){return false;};this.source.style.unselectable="on";this.source.style.MozUserSelect="none";this.source.style.KhtmlUserSelect="none";},enableTextSelection:function(){this.getContainerElement().onselectstart=function(){return true;};this.source.style.unselectable="";this.source.style.MozUserSelect="";this.source.style.KhtmlUserSelect="";}});Ice.ResizableGrid=Class.create(Ice.Resizable,{initialize:function($super,A){$super(A);logger.info(">>>>>>>>>>>>>>>>>>> ");this.cntHght=(Element.getHeight(this.getContainerElement()))+"px";this.source.style.height=this.cntHght;this.getGhost().style.left=Event.pointerX(A)+"px";this.source.style.backgroundColor="#CCCCCC";}});Ice.ResizableGrid.addMethods({getDifference:function($super,A){return $super(A);},getContainerElement:function(){return this.source.parentNode.parentNode.parentNode.parentNode;},getPreviousElement:function(){if(this.source.parentNode.previousSibling.tagName=="TH"){return this.source.parentNode.previousSibling.firstChild;}else{return this.source.parentNode.previousSibling.previousSibling.firstChild;}},getNextElement:function(){if(this.source.parentNode.nextSibling.tagName=="TH"){return this.source.parentNode.nextSibling.firstChild;}else{return this.source.parentNode.nextSibling.nextSibling.firstChild;}},resize:function($super,A){this.source.style.height=this.cntHght;this.getGhost().style.height=this.cntHght;$super(A);this.source.style.height=this.cntHght;this.getGhost().style.height=this.cntHght;},finalize:function($super,C){$super(C);this.source.style.height="1px";this.source.style.backgroundColor="transparent";this.getGhost().style.height="1px";var A=$(this.getContainerElement().id+"clientOnly");if(A){A.value=this.getAllColumnsWidth();var B=Ice.util.findForm(A);iceSubmitPartial(B,A,C);}},getAllColumnsWidth:function(){var A=this.getContainerElement();var B=A.firstChild.firstChild.childNodes;var D=2;if(Prototype.Browser.Gecko){D+=2;}var C="";for(i=0;i<B.length;i++){if(i%D==0){C+=Element.getStyle(B[i].firstChild,"width")+",";}}return C;}});Ice.PanelDivider=Class.create(Ice.Resizable,{initialize:function($super,A,B){$super(A,B);this.deadPoint=20;if(this.horizontal){var H=Element.getHeight(this.source);var G=Event.pointerY(A);this.getGhost().style.top=(G-(H))+"px";this.getGhost().style.width=(Element.getWidth(this.getContainerElement()))+"px";}else{var C=Element.getWidth(this.source);var D=parseInt(Element.getStyle(this.source,"border-left-width"));var E=parseInt(Element.getStyle(this.source,"border-right-width"));if(D&&D>=1){C-=D;}if(E&&E>=1){C-=E;}var F=Event.pointerX(A);this.getGhost().style.left=(F-(C))+"px";this.getGhost().style.width=C+"px";this.getGhost().style.height=(Element.getHeight(this.getContainerElement()))+"px";}}});Ice.PanelDivider.addMethods({getDifference:function($super,A){return $super(A);},getContainerElement:function(){return this.source.parentNode.parentNode;},getPreviousElement:function(){if(this.source.previousSibling.tagName=="DIV"){return this.source.previousSibling;}else{return this.source.previousSibling.previousSibling;}},getNextElement:function(){if(this.source.nextSibling.tagName=="DIV"){return this.source.nextSibling;}else{return this.source.nextSibling.nextSibling;}},getGhost:function(){if(!this.ghost){this.ghost=this.source.cloneNode(true);this.ghost.id=this.source.id+":ghost";this.ghost.onmousedown=null;this.source.parentNode.appendChild(this.ghost);this.ghost.style.width=Element.getWidth(this.source)+"px";this.getGhost().style.visibility="hidden";}this.ghost.setStyle({width:this.source.getStyle("width")});return this.ghost;},finalize:function(A){Element.remove(this.ghost);},adjustPosition:function(A){logger.info("<<<<<<<<<<<<<<<<<<<<< ADJUST POSTITITITITITI >>>>>>>>>>>>>>>>");var D=this.getNextElement().style.visibility;this.getNextElement().style.visibility="hidden";if(this.horizontal){var H=(Element.getHeight(this.getPreviousElement()));var C=(Element.getHeight(this.getNextElement()));var B=Element.getHeight(this.getContainerElement());var I=(parseInt(H)+parseInt(C));var J=this.getDifference(A);var M;if(this.resizeAction=="inc"){M=(H+J)/B;topInPercent=Math.round(M*100);bottomInPercent=99-topInPercent;this.getPreviousElement().style.height=(topInPercent)+"%";}else{M=(H-J)/B;topInPercent=Math.round(M*100);bottomInPercent=99-topInPercent;this.getPreviousElement().style.height=(topInPercent)+"%";}}else{var L=(Element.getWidth(this.getPreviousElement()));var G=(Element.getWidth(this.getNextElement()));var K=(Element.getWidth(this.source));var F=Element.getWidth(this.getContainerElement());var E=(parseInt(L)+parseInt(G));var J=this.getDifference(A);if(this.resizeAction=="inc"){M=(L+J)/F;leftInPercent=Math.round(M*100);rightInPercent=100-leftInPercent;this.getPreviousElement().style.width=leftInPercent+"%";}else{M=(L-J)/F;leftInPercent=Math.round(M*100);rightInPercent=100-leftInPercent;this.getPreviousElement().style.width=leftInPercent+"%";}}Ice.PanelDivider.adjustSecondPaneSize(this.source,this.horizontal);this.getNextElement().style.visibility=D;M=M+0.01;this.submitInfo(A,M);},submitInfo:function(D,B){var C=Ice.util.findForm(this.source);var A=this.getContainerElement().id;var F=$(A+"FirstPane");var G=$(A+"SecondPane");var E=$(A+"InPercent");F.value=this.getPreviousElement().style.cssText;G.value=this.getNextElement().style.cssText;E.value=Math.round(B*100);iceSubmitPartial(C,this.source,D);}});Ice.PanelDivider.adjustSecondPaneSize=function(C,E){C=$(C);var B=$(C.parentNode);var A=$(Ice.PanelDivider.prototype.getPreviousElement.call({source:C}));var D=$(Ice.PanelDivider.prototype.getNextElement.call({source:C}));if(E){D.style.height=B.clientHeight-A.offsetHeight-C.offsetHeight+"px";}else{D.style.width=B.clientWidth-A.offsetWidth-C.offsetWidth-1+"px";}};Ice.PanelDivider.dividerHash=$H();Ice.PanelDivider.onWindowResize=function(){Ice.PanelDivider.dividerHash.each(function(A){if(!$(A.key)){Ice.PanelDivider.dividerHash.unset(A.key);return ;}Ice.PanelDivider.adjustSecondPaneSize(A.key,A.value);});};Ice.PanelDivider.onLoad=function(A,B){Event.stopObserving(window,"resize",Ice.PanelDivider.onWindowResize);Ice.PanelDivider.dividerHash.set(A,B);Event.observe(window,"resize",Ice.PanelDivider.onWindowResize);Ice.PanelDivider.adjustSecondPaneSize(A,B);Ice.PanelDivider.adjustPercentBasedHeight(A,B);};ResizableUtil={adjustHeight:function(D){var A=Element.getHeight(D);var B=parseInt(Element.getStyle(D,"padding-top"));var C=parseInt(Element.getStyle(D,"padding-top"));if(B&&B>1){A-=B;}if(C&&C>1){A-=C;}D.firstChild.style.height=(A-1)+"px";}};Ice.PanelDivider.adjustPercentBasedHeight=function(C,F){if(F){return ;}var E=C.replace("Divider","");var A=$(E);var B=Element.getStyle(A,"height");var D=null;if(B&&B.indexOf("%")>0){D=B.split("%")[0];}if(D){parentHeight=Ice.PanelDivider.getParentHeight(A);newVal=Math.round(parentHeight*(D/100));A.style.height=newVal+"px";$(C).style.height=newVal+"px";}};Ice.PanelDivider.getParentHeight=function(B){if(B.tagName=="BODY"){var C=document.viewport.getHeight();if(Prototype.Browser.WebKit&&typeof window.innerHeight!="undefined"){C=window.innerHeight;}return(C-4);}var A=Element.getStyle(B,"height");if(A.indexOf("%")>0){return Ice.PanelDivider.getParentHeight(B.parentNode);}else{A=Element.getHeight(B);if(A=="2"){return Ice.PanelDivider.getParentHeight(B.parentNode);}}return A;};
Ice.KeyNavigator=Class.create({initialize:function(A){this.component=$(A);this.component.onkeydown=this.keydown.bindAsEventListener(this);},keydown:function(A){this.srcElement=Event.element(A);switch(A.keyCode){case Event.KEY_RETURN:this.showMenu(A);break;case Event.KEY_UP:this.goNorth(A);Event.stop(A);break;case Event.KEY_DOWN:this.goSouth(A);Event.stop(A);break;case Event.KEY_LEFT:this.goWest(A);Event.stop(A);break;case Event.KEY_RIGHT:this.goEast(A);Event.stop(A);break;}},goNorth:function(A){},goSouth:function(A){},goWest:function(A){},goEast:function(A){}});Ice.MenuBarKeyNavigator=Class.create(Ice.KeyNavigator,{initialize:function($super,A,B){$super(A);this.displayOnClick=B;this.component.onclick=this.hideAll.bindAsEventListener(this);document.onclick=this.hideAllDocument.bindAsEventListener(this);if(Element.hasClassName(this.component,"iceMnuBarVrt")){this.vertical=true;}else{this.vertical=false;}this.clicked=true;this.configureRootItems();}});Ice.MenuBarKeyNavigator.addMethods({goEast:function(A){this.applyFocus("e");},goWest:function(A){this.applyFocus("w");},goSouth:function(A){this.applyFocus("s");},goNorth:function(A){this.applyFocus("n");},focusMenuItem:function(B,E,G){var D=this.srcElement.up(B);if(D){if(G=="e"){var F=$(D.id+"_sub");this.focusAnchor(F);return ;}if(G=="w"){var A=$(D.id.substring(0,D.id.length-6));if(A){this.focusAnchor(A);}else{this.focusAnchor($(D.id.substring(0,D.id.lastIndexOf(":"))));}return ;}var C=null;if(E){C=D.next(B);}else{C=D.previous(B);if(!C&&G=="n"){this.focusAnchor($(D.id.substring(0,D.id.lastIndexOf(":"))));return ;}}this.focusAnchor(C);}},focusSubMenuItem:function(A){if(A){var B=$(A.id+"_sub");this.focusAnchor(B);}},focusAnchor:function(B){if(B){try{var A=B.down("a");A.focus();}catch(C){}}},applyFocus:function(E){var C=this.srcElement.parentNode;var B=Element.hasClassName(C,this.getPopupMenuClass());var D=Element.hasClassName(C,this.getMenuBarItemClass());var A=Element.hasClassName(C,this.getMenuItemClass());if(D){switch(E){case"s":if(this.vertical){this.focusMenuItem("."+this.getMenuBarItemClass(),true);}else{this.focusSubMenuItem(C);}break;case"e":if(this.vertical){this.focusSubMenuItem(C);}else{this.focusMenuItem("."+this.getMenuBarItemClass(),true);}break;case"w":this.focusMenuItem("."+this.getMenuBarItemClass());break;case"n":if(this.vertical){this.focusMenuItem("."+this.getMenuBarItemClass());}break;}}else{if(A){this.focusMenuItem("."+this.getMenuItemClass(),E=="s",E);}else{if(B){switch(E){case"n":this.focusMenuItem("."+this.getPopupMenuClass());break;case"s":this.focusMenuItem("."+this.getPopupMenuClass(),true);break;case"e":this.focusSubMenuItem(C);break;}}}}},getMenuBarItemClass:function(A){if(this.vertical){return"iceMnuBarVrtItem";}else{return"iceMnuBarItem";}},getSubMenuClass:function(A){if(this.vertical){return"iceMnuBarVrtSubMenu";}else{return"iceMnuBarSubMenu";}},getSubMenuIndClass:function(A){if(this.vertical){return"iceMnuBarVrtSubMenuInd";}else{return"iceMnuBarSubMenuInd";}},getRootClass:function(){if(this.vertical){return"iceMnuBarVrt";}else{return"iceMnuBar";}},getMenuItemClass:function(){return"iceMnuItm";},getPopupMenuClass:function(){return"iceMnuPopVrtItem";},hover:function(D,B,A){if(!A){if(Ice.Menu.currentHover&&Ice.Menu.currentHover==B.id){return ;}}Ice.Menu.currentHover=B.id;if(this.clicked){var C=$(B.id+"_sub");Ice.Menu.hideOrphanedMenusNotRelatedTo(B);if(this.vertical){Ice.Menu.show(this.component,C,B);}else{Ice.Menu.show(B,C,null);}}},mousedown:function(B,A){if(this.clicked){this.clicked=false;}else{this.clicked=true;this.hover(B,A,true);}},focus:function(B,A){this.hover(B,A);},configureRootItems:function(){var B=this.component.childNodes;for(i=0;i<B.length;i++){var C=B[i];if(C.tagName=="DIV"){if(Element.hasClassName(C,this.getMenuBarItemClass())){C.onmouseover=this.hover.bindAsEventListener(this,C);var A=C.firstChild;if(A.tagName=="A"){A.onfocus=this.focus.bindAsEventListener(this,C);}if(this.displayOnClick){C.onmousedown=this.mousedown.bindAsEventListener(this,C);this.clicked=false;}}}}},hideAll:function(C){element=Event.element(C);var A=element.up("."+this.getMenuBarItemClass());var B=C.element();if(B&&B.match("a[onclick]")){B=B.down();}if(B){B=B.up(".iceMnuItm a[onclick^='return false']");}if(!(A&&this.clicked)&&!B){Ice.Menu.hideAll();if(this.displayOnClick){this.clicked=false;}}C.stopPropagation();},hideAllDocument:function(A){if(this.displayOnClick){this.clicked=false;}Ice.Menu.hideAll();},showMenu:function(B){element=Event.element(B);var A=element.up("."+this.getMenuBarItemClass());if(A&&this.displayOnClick){this.mousedown(B);}}});
Ice.dataTable={};Ice.dataTable.DataTable=Class.create({initialize:function(A){this.id=A;this.resizeObserver=this.resize.bindAsEventListener(this);},resize:function(){var K=$(this.id);if(!K){return ;}var C=K.select("div.iceDatTblScrlSpr")[0];if(!C){return ;}var H=C.select("table > thead > tr > th:last-child > div")[0];var G=K.select("div.iceDatTblScrlSpr + div")[0];if(!G){return ;}var J=G.getStyle("borderLeftWidth");var A=G.getStyle("borderRightWidth");if(Prototype.Browser.IE&&G.scrollHeight>G.clientHeight){G.style.overflowX="hidden";G.style.overflowY="scroll";}var B=G.getWidth();var E=B-G.clientWidth;if(E==0){return ;}G.setStyle({borderLeftWidth:0,borderRightWidth:0});var F=G.select("table")[0];var I=C.select("table")[0];if(H){H.setStyle({width:E+"px"});}var F=G.select("table")[0];if(F){var D=F.getWidth();if(Prototype.Browser.IE){}}G.setStyle({borderLeftWidth:J,borderRightWidth:A});}});Ice.dataTable.DataTable.hash=$H();Ice.dataTable.onLoad=function(B){var A=Ice.dataTable.DataTable.hash.get(B);if(A){Event.stopObserving(window,"load",A.resizeObserver);Event.stopObserving(window,"resize",A.resizeObserver);}A=new Ice.dataTable.DataTable(B);A.resize();Event.observe(window,"load",A.resizeObserver);Event.observe(window,"resize",A.resizeObserver);Ice.dataTable.DataTable.hash.set(B,A);};
Ice.PanelConfirmation=Class.create({initialize:function(B,F,E,G,A,H,C,D){this.srcComp=B;this.event=F;this.panel=$(E);this.url=C;this.srcHandler=D;this.isAutoCentre=G;this.isDraggable=A;this.isAtMouse=H;Ice.PanelConfirmation.current=this;this.showPanel();},showPanel:function(){Ice.modal.start(this.panel.id,this.url);Ice.iFrameFix.start(this.panel.id,this.url);this.panel.style.display="";this.handleDraggableObject();Ice.autoPosition.stop(this.panel.id);if(this.isAtMouse){this.panel.style.left=parseInt(Event.pointerX(this.event))+"px";this.panel.style.top=parseInt(Event.pointerY(this.event))+"px";}else{Ice.autoCentre.start(this.panel.id);}if(!this.isAutoCentre){Ice.autoCentre.stop(this.panel.id);}this.setDefaultFocus();},accept:function(){this.close();setFocus(this.srcComp.id);this.srcHandler.call(this.srcComp,this.event);},cancel:function(){this.close();},close:function(){Ice.PanelConfirmation.current=null;this.panel.style.visibility="hidden";this.panel.style.display="none";Ice.modal.stop(this.panel.id);Ice.autoCentre.stop(this.panel.id);Draggable.removeMe(this.panel.id);Ice.Focus.setFocus(this.srcComp.id);},handleDraggableObject:function(){if(this.isDraggable){Ice.DnD.adjustPosition(this.panel.id);new Draggable(this.panel.id,{handle:this.panel.id+"-handle",dragGhost:false,dragCursor:false,ghosting:false,revert:false,mask:"1,2,3,4,5"});}},setDefaultFocus:function(){var A=$(this.panel.id+"-cancel");if(A){A.focus();}else{$(this.panel.id+"-accept").focus();}}});Ice.PanelConfirmation.current=null;
Ice.Calendar={};Ice.Calendar.listeners={};Ice.Calendar.addCloseListener=function(D,B,C,A){if(Ice.Calendar.listeners[D]){return ;}else{Ice.Calendar.listeners[D]=new Ice.Calendar.CloseListener(D,B,C,A);}};Ice.Calendar.CloseListener=Class.create({initialize:function(D,B,C,A){this.calendarId=D;this.formId=B;this.commandLinkId=C;this.hiddenFieldId=A;this.popupId=this.calendarId+"_ct";this.buttonId=this.calendarId+"_cb";this.handler=this.closePopupOnClickOutside.bindAsEventListener(this);Event.observe(document,"mousedown",this.handler);},closePopupOnClickOutside:function(A){if(this.getPopup()){if(this.isInPopup(A.element())){return ;}if(this.isWithin(this.getPopup(),A)){return ;}if(A.element()==this.getButton()){this.dispose();return ;}var B=A.element().id;if(B){setFocus(B);}else{setFocus("");}this.submit(A);this.dispose();}},isInPopup:function(A){if(A.id==this.popupId){return true;}if(A==undefined||A==document){return false;}return this.isInPopup(A.parentNode);},isWithin:function(A,B){return Position.within(A,Event.pointerX(B),Event.pointerY(B));},dispose:function(){Ice.Calendar.listeners[this.calendarId]=null;Event.stopObserving(document,"mousedown",this.handler);},submit:function(A){document.forms[this.formId][this.commandLinkId].value=this.getButton().id;document.forms[this.formId][this.hiddenFieldId].value="toggle";iceSubmitPartial(document.forms[this.formId],this.getButton(),A);},getPopup:function(){return $(this.popupId);},getButton:function(){return $(this.buttonId);}});
Ice.treeNavigator=Class.create();Ice.treeNavigator={handleFocus:function(F,B,A){var E=F.type;if(E=="click"){Ice.treeNavigator.reset();return ;}var G=Event.element(F);var C=F.keyCode;var D=null;if(G&&G.firstChild.getAttribute){D=G.firstChild.getAttribute("src");}if(!D){return ;}switch(C){case 37:if(D.indexOf("top_close_no_siblings")>0||D.indexOf("middle_close")>0||D.indexOf("bottom_close")>0){logger.info("LEFT_KEY: top_close_no_siblings FOUND, root Node opend close it and reinitialize index");G.onclick();Ice.treeNavigator.reset();return false;}break;case 39:if(D.indexOf("top_open_no_siblings")>0||D.indexOf("middle_open")>0||D.indexOf("bottom_open")>0){G.onclick();Ice.treeNavigator.reset();return false;}break;case 38:if(!Ice.treeNavigator.anchors){Ice.treeNavigator.updateAnchor(B,G,A);}if(D){if(D.indexOf("top_close_no_siblings")>0){Ice.treeNavigator.index=1;Ice.treeNavigator.anchors[Ice.treeNavigator.index].focus();}Ice.treeNavigator.focusPrevious();}else{Ice.treeNavigator.focusPrevious();}return false;case 40:logger.info("down");if(!Ice.treeNavigator.anchors){Ice.treeNavigator.updateAnchor(B,G,A);}Ice.treeNavigator.focusNext();return false;}},index:0,anchors:null,reset:function(){Ice.treeNavigator.index=0;Ice.treeNavigator.anchors=null;},focusNext:function(A){if(Ice.treeNavigator.index<(Ice.treeNavigator.anchors.length-1)){Ice.treeNavigator.index=Ice.treeNavigator.index+1;}Ice.treeNavigator.anchors[Ice.treeNavigator.index].focus();},focusPrevious:function(A){if(Ice.treeNavigator.index>0){Ice.treeNavigator.index=Ice.treeNavigator.index-1;}Ice.treeNavigator.anchors[Ice.treeNavigator.index].focus();},updateAnchor:function(B,D,A){var C=[];if(A){C=B.parentNode.getElementsByTagName("a");for(i=0;C.length>i;i++){if(D==C[i]){Ice.treeNavigator.index=i;}}}else{_anchors=B.parentNode.getElementsByTagName("a");j=0;for(i=0;_anchors.length>i;i++){if(_anchors[i].firstChild.src&&_anchors[i].firstChild.src.indexOf("tree_nav")>0){if(D==_anchors[i]){Ice.treeNavigator.index=j;}C[j++]=_anchors[i];}}}Ice.treeNavigator.anchors=C;}};
Ice.Menu=Class.create();Ice.Menu={menuContext:null,currentMenu:null,currentHover:null,openMenus:new Array(0),printOpenMenus:function(){var B="";for(var A=0;A<Ice.Menu.openMenus.length;A++){B=B+Ice.Menu.openMenus[A].id+" , ";}return B;},printHoverMenuAndOpenMenus:function(A){alert("hoverMenu=["+A.id+"]\nopenMenus=["+Ice.Menu.printOpenMenus()+"]");},printArray:function(C){var A="";for(var B=0;B<C.length;B++){A=A+C[B]+", ";}return A;},printArrayOfIds:function(C){var A="";for(var B=0;B<C.length;B++){A=A+C[B].id+", ";}return A;},hideAll:function(){for(var A=0;A<Ice.Menu.openMenus.length;A++){if(Ice.Menu.openMenus[A].iframe){Ice.Menu.openMenus[A].iframe.hide();}Ice.Menu.openMenus[A].style.display="none";}Ice.Menu.openMenus=new Array();Ice.Menu.currentMenu=null;Ice.Menu.menuContext=null;Ice.Menu.currentHover=null;},getPosition:function(C,B){var A=0;while(C!=null){A+=C["offset"+B];C=C.offsetParent;}return A;},show:function(H,A,D){if(A){var B=$(A);if(B&&B.style.display==""){return ;}Ice.Menu.showMenuWithId(A);var I=H.viewportOffset(),J=A.viewportOffset(),F=document.viewport,C=H.offsetWidth,L=A.offsetWidth,E=A.offsetHeight,K=H.offsetHeight;D=$(D);if(D){var G=D.offsetHeight;if(I.left+C+L<F.getWidth()){if(Prototype.Browser.IE){Ice.clonePositionIE(A,H,{setTop:false,setWidth:false,setHeight:false,offsetLeft:C},I);}else{A.clonePosition(H,{setTop:false,setWidth:false,setHeight:false,offsetLeft:C});}}else{if(Prototype.Browser.IE){Ice.clonePositionIE(A,H,{setTop:false,setWidth:false,setHeight:false,offsetLeft:-L},I);}else{A.clonePosition(H,{setTop:false,setWidth:false,setHeight:false,offsetLeft:-L});}}if(D.viewportOffset().top+E<F.getHeight()){if(Prototype.Browser.IE){Ice.clonePositionIE(A,D,{setLeft:false,setWidth:false,setHeight:false});}else{A.clonePosition(D,{setLeft:false,setWidth:false,setHeight:false});}}else{if(Prototype.Browser.IE){Ice.clonePositionIE(A,D,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-E+G});}else{A.clonePosition(D,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-E+G});}}}else{if(I.left+L<F.getWidth()){if(Prototype.Browser.IE){Ice.clonePositionIE(A,H,{setTop:false,setWidth:false,setHeight:false},I);}else{A.clonePosition(H,{setTop:false,setWidth:false,setHeight:false});}}else{if(Prototype.Browser.IE){Ice.clonePositionIE(A,H,{setTop:false,setWidth:false,setHeight:false,offsetLeft:F.getWidth()-I.left-L},I);}else{A.clonePosition(H,{setTop:false,setWidth:false,setHeight:false,offsetLeft:F.getWidth()-I.left-L});}}if(I.top+K+E<F.getHeight()){if(Prototype.Browser.IE){Ice.clonePositionIE(A,H,{setLeft:false,setWidth:false,setHeight:false,offsetTop:K},I);}else{A.clonePosition(H,{setLeft:false,setWidth:false,setHeight:false,offsetTop:K});}}else{if(Prototype.Browser.IE){Ice.clonePositionIE(A,H,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-E},I);}else{A.clonePosition(H,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-E});}}}if(J.top<0){if(Prototype.Browser.IE){Ice.clonePositionIE(A,A,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-J.top},J);}else{A.clonePosition(A,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-J.top});}}Ice.Menu.showIframe(A);}Ice.Menu.currentMenu=A;},showPopup:function(C,B,A){Ice.Menu.hideAll();A=$(A);if(A){Ice.Menu.showMenuWithId(A);var E=C+"px";A.style.left=E;var D=B+"px";A.style.top=D;Ice.Menu.showIframe(A);}Ice.Menu.currentMenu=A;},showIframe:function(C){if(!Prototype.Browser.IE){return ;}if(parseFloat(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))>=7){return ;}var B=C.iframe;if(!B){var A=Ice.ElementModel.Element.adaptToElement(C).findConnection().sendURI;var D=A.substring(0,A.indexOf("block/send-receive-updates"));var E=D+"xmlhttp/blank";C.iframe=B=new Element("iframe",{src:E,frameborder:"0",scrolling:"no"});B.setStyle({position:"absolute",opacity:0}).hide();C.insert({before:B});}if(Prototype.Browser.IE){Ice.clonePositionIE(B,C);}else{Element.clonePosition(B,C);}B.show();},contextMenuPopup:function(D,B,G){var F=$(B+"_dynamic");if(!D){D=window.event;}if(D){D.returnValue=false;D.cancelBubble=true;if(D.stopPropagation){D.stopPropagation();}var A=0;var H=0;if(D.pageX||D.pageY){A=D.pageX;H=D.pageY;}else{if(D.clientX||D.clientY){A=D.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;H=D.clientY+document.body.scrollTop+document.documentElement.scrollTop;}}if(F){F.value=A+", "+H+", "+B+", "+G;try{var C=Ice.util.findForm(F);iceSubmitPartial(C,F,D);}catch(E){logger.info("Form not found"+E);}return ;}Ice.Menu.showIt(A,H,B,G);}},showIt:function(A,D,B,C){Ice.Menu.showPopup(A,D,B.strip());Event.observe(document,"click",Ice.Menu.hidePopupMenu);Ice.Menu.setMenuContext(C.strip());},setMenuContext:function(A){if(Ice.Menu.menuContext==null){Ice.Menu.menuContext=A;}},hideOrphanedMenusNotRelatedTo:function(H){var I=new Array();var G=H.id.split(":");var A="";for(var F=0;F<G.length;F++){A=A+G[F];var B=new Array(A+"_sub");I=I.concat(B);A=A+":";}var E=Ice.Menu.openMenus.length;var J=new Array();for(var D=0;D<E;D++){var L=$(Ice.Menu.openMenus[D]);var K="false";for(var C=0;C<I.length;C++){if(L.id==I[C]){K="true";}}if(K!="true"){J[J.length]=L.id;if(L==Ice.Menu.currentMenu){Ice.Menu.currentMenu=null;}}}Ice.Menu.hideMenusWithIdsInArray(J);},hideSubmenu:function(C){var D=Ice.Menu.currentMenu;var A=C.id.substring(0,C.id.lastIndexOf(":"));var B=D.id.substring(0,D.id.lastIndexOf(":"));if(A==B){Ice.Menu.hideMenuWithId(Ice.Menu.currentMenu);}},hideMenusWithIdsInArray:function(B){if(B){for(var A=0;A<B.length;A++){Ice.Menu.hideMenuWithId(B[A]);}}},hideMenuWithId:function(A){A=$(A);if(A){if(A.iframe){A.iframe.hide();}A.style.display="none";Ice.Menu.removeFromOpenMenus(A);}return ;},removeFromOpenMenus:function(C){var B=new Array();for(var A=0;A<Ice.Menu.openMenus.length;A++){if(Ice.Menu.openMenus[A].id!=C.id){B=B.concat(new Array(Ice.Menu.openMenus[A]));}}Ice.Menu.openMenus=B;},showMenuWithId:function(A){if(A){A=$(A);A.style.display="";Ice.Menu.addToOpenMenus(A);}},addToOpenMenus:function(D){if(D){D=$(D);var C="false";for(var A=0;A<Ice.Menu.openMenus.length;A++){if(Ice.Menu.openMenus[A].id==D.id){C="true";break;}}if(C!="true"){var B=new Array(D);Ice.Menu.openMenus=Ice.Menu.openMenus.concat(B);}}},appendHoverClasses:function(C){var A=C.className.replace(/^\s+|\s+$/g,"").split(/\s+/);if(A[0]==""){return ;}for(var B=0;B<A.length;B++){if(A[B]=="portlet-menu-item-selected"){C.className+=" portlet-menu-item-hover-selected";}else{C.className+=" "+A[B]+"-hover";}}},removeHoverClasses:function(B){var C=B.className.replace(/^\s+|\s+$/g,"").split(/\s+/).length/2;var A=new RegExp("( portlet-menu-item-hover-selected| \\S+-hover){"+C+"}$");B.className=B.className.replace(A,"");},hidePopupMenu:function(){Ice.Menu.hideAll();Event.stopObserving(document,"click",Ice.Menu.hidePopupMenu);},hideOnMouseOut:function(C,B){if(!B){B=window.event;}if(B){var A;A=B.relatedTarget;if(!A){A=B.toElement;}if(A){if(!Ice.Menu.isInMenu(A,C)){Ice.Menu.hideAll();}}}},isInMenu:function(A,B){if(A.id==B){return true;}if(A==undefined||A==document){return false;}return Ice.Menu.isInMenu(A.parentNode,B);}};Ice.clonePositionIE=function(E,A,L,K){logger.info("Using clonePosition() optimized for IE");var L=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});E=$(E);var B=null;if(K){B=K;}else{B=A.viewportOffset();}var J=[0,0];var I=null;if(Element.getStyle(E,"position")=="absolute"){I=E.getOffsetParent();var H=Element.getStyle(I,"top");var C=Element.getStyle(I,"left");var F=document.documentElement.scrollTop;var D=document.documentElement.scrollLeft;var G=false;_viewportOffset=I._viewportOffset;if(!_viewportOffset){I._top=null;I._left=null;I._bodyScrollTop=F;I._bodyScrollLeft=D;G=true;}else{G=!((I._top==H&&I._left==C)&&(I._bodyScrollTop==F&&I._bodyScrollLeft==D));}I._top=H;I._left=C;I._bodyScrollTop=F;I._bodyScrollLeft=D;if(G){J=I.viewportOffset();I._viewportOffset=J;}else{J=I._viewportOffset;}}if(L.setLeft){E.style.left=(B[0]-J[0]+L.offsetLeft)+"px";}if(L.setTop){E.style.top=(B[1]-J[1]+L.offsetTop)+"px";}if(L.setWidth){E.style.width=A.offsetWidth+"px";}if(L.setHeight){E.style.height=A.offsetHeight+"px";}return E;};
